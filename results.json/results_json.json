{"check_type": "terraform", "results": {"passed_checks": [{"check_id": "CKV_AWS_7", "bc_check_id": null, "check_name": "Ensure rotation for customer created CMKs is enabled", "check_result": {"result": "PASSED", "evaluated_keys": ["enable_key_rotation"]}, "code_block": [[44, "resource \"aws_kms_key\" \"pass1\" {\n"], [45, "  description                        = \"pass1\"\n"], [46, "  deletion_window_in_days            = 7\n"], [47, "  key_usage                          = \"ENCRYPT_DECRYPT\"\n"], [48, "  customer_master_key_spec           = \"SYMMETRIC_DEFAULT\"\n"], [49, "  policy                             = data.aws_iam_policy_document.pass1.json\n"], [50, "  bypass_policy_lockout_safety_check = false\n"], [51, "  is_enabled                         = true\n"], [52, "  enable_key_rotation                = true\n"], [53, "}\n"]], "file_path": "/kms.tf", "file_abs_path": "/github/workspace/kms.tf", "repo_file_path": "/kms.tf", "file_line_range": [44, 53], "resource": "aws_kms_key.pass1", "evaluations": null, "check_class": "checkov.terraform.checks.resource.aws.KMSRotation", "fixed_definition": null, "entity_tags": null, "caller_file_path": null, "caller_file_line_range": null, "resource_address": null, "severity": null, "bc_category": null, "benchmarks": {}, "description": null, "short_description": null, "vulnerability_details": null, "connected_node": null, "guideline": null, "details": [], "check_len": null, "definition_context_file_path": "/github/workspace/kms.tf"}, {"check_id": "CKV_AWS_227", "bc_check_id": null, "check_name": "Ensure KMS key is enabled", "check_result": {"result": "PASSED", "evaluated_keys": ["is_enabled"]}, "code_block": [[44, "resource \"aws_kms_key\" \"pass1\" {\n"], [45, "  description                        = \"pass1\"\n"], [46, "  deletion_window_in_days            = 7\n"], [47, "  key_usage                          = \"ENCRYPT_DECRYPT\"\n"], [48, "  customer_master_key_spec           = \"SYMMETRIC_DEFAULT\"\n"], [49, "  policy                             = data.aws_iam_policy_document.pass1.json\n"], [50, "  bypass_policy_lockout_safety_check = false\n"], [51, "  is_enabled                         = true\n"], [52, "  enable_key_rotation                = true\n"], [53, "}\n"]], "file_path": "/kms.tf", "file_abs_path": "/github/workspace/kms.tf", "repo_file_path": "/kms.tf", "file_line_range": [44, 53], "resource": "aws_kms_key.pass1", "evaluations": null, "check_class": "checkov.terraform.checks.resource.aws.KMSKeyIsEnabled", "fixed_definition": null, "entity_tags": null, "caller_file_path": null, "caller_file_line_range": null, "resource_address": null, "severity": null, "bc_category": null, "benchmarks": {}, "description": null, "short_description": null, "vulnerability_details": null, "connected_node": null, "guideline": null, "details": [], "check_len": null, "definition_context_file_path": "/github/workspace/kms.tf"}, {"check_id": "CKV_AWS_33", "bc_check_id": null, "check_name": "Ensure KMS key policy does not contain wildcard (*) principal", "check_result": {"result": "PASSED", "evaluated_keys": ["policy"]}, "code_block": [[44, "resource \"aws_kms_key\" \"pass1\" {\n"], [45, "  description                        = \"pass1\"\n"], [46, "  deletion_window_in_days            = 7\n"], [47, "  key_usage                          = \"ENCRYPT_DECRYPT\"\n"], [48, "  customer_master_key_spec           = \"SYMMETRIC_DEFAULT\"\n"], [49, "  policy                             = data.aws_iam_policy_document.pass1.json\n"], [50, "  bypass_policy_lockout_safety_check = false\n"], [51, "  is_enabled                         = true\n"], [52, "  enable_key_rotation                = true\n"], [53, "}\n"]], "file_path": "/kms.tf", "file_abs_path": "/github/workspace/kms.tf", "repo_file_path": "/kms.tf", "file_line_range": [44, 53], "resource": "aws_kms_key.pass1", "evaluations": null, "check_class": "checkov.terraform.checks.resource.aws.KMSKeyWildcardPrincipal", "fixed_definition": null, "entity_tags": null, "caller_file_path": null, "caller_file_line_range": null, "resource_address": null, "severity": null, "bc_category": null, "benchmarks": {}, "description": null, "short_description": null, "vulnerability_details": null, "connected_node": null, "guideline": null, "details": [], "check_len": null, "definition_context_file_path": "/github/workspace/kms.tf"}, {"check_id": "CKV_AWS_227", "bc_check_id": null, "check_name": "Ensure KMS key is enabled", "check_result": {"result": "PASSED", "evaluated_keys": ["is_enabled"]}, "code_block": [[56, "resource \"aws_kms_key\" \"pass2\" {\n"], [57, "  description = \"fail5\"\n"], [58, "}\n"]], "file_path": "/kms.tf", "file_abs_path": "/github/workspace/kms.tf", "repo_file_path": "/kms.tf", "file_line_range": [56, 58], "resource": "aws_kms_key.pass2", "evaluations": null, "check_class": "checkov.terraform.checks.resource.aws.KMSKeyIsEnabled", "fixed_definition": null, "entity_tags": null, "caller_file_path": null, "caller_file_line_range": null, "resource_address": null, "severity": null, "bc_category": null, "benchmarks": {}, "description": null, "short_description": null, "vulnerability_details": null, "connected_node": null, "guideline": null, "details": [], "check_len": null, "definition_context_file_path": "/github/workspace/kms.tf"}, {"check_id": "CKV_AWS_33", "bc_check_id": null, "check_name": "Ensure KMS key policy does not contain wildcard (*) principal", "check_result": {"result": "PASSED", "evaluated_keys": []}, "code_block": [[56, "resource \"aws_kms_key\" \"pass2\" {\n"], [57, "  description = \"fail5\"\n"], [58, "}\n"]], "file_path": "/kms.tf", "file_abs_path": "/github/workspace/kms.tf", "repo_file_path": "/kms.tf", "file_line_range": [56, 58], "resource": "aws_kms_key.pass2", "evaluations": null, "check_class": "checkov.terraform.checks.resource.aws.KMSKeyWildcardPrincipal", "fixed_definition": null, "entity_tags": null, "caller_file_path": null, "caller_file_line_range": null, "resource_address": null, "severity": null, "bc_category": null, "benchmarks": {}, "description": null, "short_description": null, "vulnerability_details": null, "connected_node": null, "guideline": null, "details": [], "check_len": null, "definition_context_file_path": "/github/workspace/kms.tf"}, {"check_id": "CKV_AWS_7", "bc_check_id": null, "check_name": "Ensure rotation for customer created CMKs is enabled", "check_result": {"result": "PASSED", "evaluated_keys": ["enable_key_rotation"]}, "code_block": [[85, "resource \"aws_kms_key\" \"pass3\" {\n"], [86, "  description                        = \"pass3\"\n"], [87, "  deletion_window_in_days            = 7\n"], [88, "  key_usage                          = \"ENCRYPT_DECRYPT\"\n"], [89, "  customer_master_key_spec           = \"SYMMETRIC_DEFAULT\"\n"], [90, "  policy                             = <<POLICY\n"], [91, "{\n"], [92, "    \"Version\": \"2012-10-17\",\n"], [93, "    \"Statement\": [\n"], [94, "        {\n"], [95, "            \"Sid\": \"pass3\",\n"], [96, "            \"Effect\": \"Allow\",\n"], [97, "            \"Principal\": {\n"], [98, "                \"AWS\": \"*\"\n"], [99, "            },\n"], [100, "            \"Action\": [\n"], [101, "              \"kms:Update*\",\n"], [102, "              \"kms:UntagResource\",\n"], [103, "              \"kms:TagResource\",\n"], [104, "              \"kms:SynchronizeMultiRegionKey\",\n"], [105, "              \"kms:ScheduleKeyDeletion\",\n"], [106, "              \"kms:ReplicateKey\",\n"], [107, "              \"kms:PutKeyPolicy\",\n"], [108, "              \"kms:List*\",\n"], [109, "              \"kms:Get*\",\n"], [110, "              \"kms:Enable*\",\n"], [111, "              \"kms:Disable*\",\n"], [112, "              \"kms:Describe*\",\n"], [113, "              \"kms:DeleteAlias\",\n"], [114, "              \"kms:CreateAlias\",\n"], [115, "              \"kms:CancelKeyDeletion\"\n"], [116, "            ],\n"], [117, "            \"Resource\": \"*\",\n"], [118, "            \"Condition\": {\n"], [119, "                \"StringEquals\": {\n"], [120, "                    \"aws:PrincipalArn\": [\n"], [121, "                        \"${data.aws_iam_session_context.current.issuer_arn}\"\n"], [122, "                    ]\n"], [123, "                }\n"], [124, "            }\n"], [125, "        }\n"], [126, "    ]\n"], [127, "}\n"], [128, "POLICY\n"], [129, "  bypass_policy_lockout_safety_check = false\n"], [130, "  is_enabled                         = false\n"], [131, "  enable_key_rotation                = true\n"], [132, "\n"], [133, "}\n"]], "file_path": "/kms.tf", "file_abs_path": "/github/workspace/kms.tf", "repo_file_path": "/kms.tf", "file_line_range": [85, 133], "resource": "aws_kms_key.pass3", "evaluations": null, "check_class": "checkov.terraform.checks.resource.aws.KMSRotation", "fixed_definition": null, "entity_tags": null, "caller_file_path": null, "caller_file_line_range": null, "resource_address": null, "severity": null, "bc_category": null, "benchmarks": {}, "description": null, "short_description": null, "vulnerability_details": null, "connected_node": null, "guideline": null, "details": [], "check_len": null, "definition_context_file_path": "/github/workspace/kms.tf"}, {"check_id": "CKV_AWS_7", "bc_check_id": null, "check_name": "Ensure rotation for customer created CMKs is enabled", "check_result": {"result": "PASSED", "evaluated_keys": ["enable_key_rotation"]}, "code_block": [[155, "resource \"aws_kms_key\" \"fail1\" {\n"], [156, "  description                        = \"fail1\"\n"], [157, "  deletion_window_in_days            = 7\n"], [158, "  key_usage                          = \"ENCRYPT_DECRYPT\"\n"], [159, "  customer_master_key_spec           = \"SYMMETRIC_DEFAULT\"\n"], [160, "  policy                             = data.aws_iam_policy_document.fail1.json\n"], [161, "  bypass_policy_lockout_safety_check = false\n"], [162, "  is_enabled                         = true\n"], [163, "  enable_key_rotation                = true\n"], [164, "}\n"]], "file_path": "/kms.tf", "file_abs_path": "/github/workspace/kms.tf", "repo_file_path": "/kms.tf", "file_line_range": [155, 164], "resource": "aws_kms_key.fail1", "evaluations": null, "check_class": "checkov.terraform.checks.resource.aws.KMSRotation", "fixed_definition": null, "entity_tags": null, "caller_file_path": null, "caller_file_line_range": null, "resource_address": null, "severity": null, "bc_category": null, "benchmarks": {}, "description": null, "short_description": null, "vulnerability_details": null, "connected_node": null, "guideline": null, "details": [], "check_len": null, "definition_context_file_path": "/github/workspace/kms.tf"}, {"check_id": "CKV_AWS_227", "bc_check_id": null, "check_name": "Ensure KMS key is enabled", "check_result": {"result": "PASSED", "evaluated_keys": ["is_enabled"]}, "code_block": [[155, "resource \"aws_kms_key\" \"fail1\" {\n"], [156, "  description                        = \"fail1\"\n"], [157, "  deletion_window_in_days            = 7\n"], [158, "  key_usage                          = \"ENCRYPT_DECRYPT\"\n"], [159, "  customer_master_key_spec           = \"SYMMETRIC_DEFAULT\"\n"], [160, "  policy                             = data.aws_iam_policy_document.fail1.json\n"], [161, "  bypass_policy_lockout_safety_check = false\n"], [162, "  is_enabled                         = true\n"], [163, "  enable_key_rotation                = true\n"], [164, "}\n"]], "file_path": "/kms.tf", "file_abs_path": "/github/workspace/kms.tf", "repo_file_path": "/kms.tf", "file_line_range": [155, 164], "resource": "aws_kms_key.fail1", "evaluations": null, "check_class": "checkov.terraform.checks.resource.aws.KMSKeyIsEnabled", "fixed_definition": null, "entity_tags": null, "caller_file_path": null, "caller_file_line_range": null, "resource_address": null, "severity": null, "bc_category": null, "benchmarks": {}, "description": null, "short_description": null, "vulnerability_details": null, "connected_node": null, "guideline": null, "details": [], "check_len": null, "definition_context_file_path": "/github/workspace/kms.tf"}, {"check_id": "CKV_AWS_33", "bc_check_id": null, "check_name": "Ensure KMS key policy does not contain wildcard (*) principal", "check_result": {"result": "PASSED", "evaluated_keys": ["policy"]}, "code_block": [[155, "resource \"aws_kms_key\" \"fail1\" {\n"], [156, "  description                        = \"fail1\"\n"], [157, "  deletion_window_in_days            = 7\n"], [158, "  key_usage                          = \"ENCRYPT_DECRYPT\"\n"], [159, "  customer_master_key_spec           = \"SYMMETRIC_DEFAULT\"\n"], [160, "  policy                             = data.aws_iam_policy_document.fail1.json\n"], [161, "  bypass_policy_lockout_safety_check = false\n"], [162, "  is_enabled                         = true\n"], [163, "  enable_key_rotation                = true\n"], [164, "}\n"]], "file_path": "/kms.tf", "file_abs_path": "/github/workspace/kms.tf", "repo_file_path": "/kms.tf", "file_line_range": [155, 164], "resource": "aws_kms_key.fail1", "evaluations": null, "check_class": "checkov.terraform.checks.resource.aws.KMSKeyWildcardPrincipal", "fixed_definition": null, "entity_tags": null, "caller_file_path": null, "caller_file_line_range": null, "resource_address": null, "severity": null, "bc_category": null, "benchmarks": {}, "description": null, "short_description": null, "vulnerability_details": null, "connected_node": null, "guideline": null, "details": [], "check_len": null, "definition_context_file_path": "/github/workspace/kms.tf"}, {"check_id": "CKV_AWS_7", "bc_check_id": null, "check_name": "Ensure rotation for customer created CMKs is enabled", "check_result": {"result": "PASSED", "evaluated_keys": ["enable_key_rotation"]}, "code_block": [[251, "resource \"aws_kms_key\" \"fail3\" {\n"], [252, "  description             = \"fail3\"\n"], [253, "  deletion_window_in_days = 30\n"], [254, "  policy                  = <<EOF\n"], [255, "  {\n"], [256, "    \"Version\": \"2012-10-17\",\n"], [257, "    \"Statement\": [\n"], [258, "        {\n"], [259, "            \"Effect\": \"Allow\",\n"], [260, "            \"Principal\": {\n"], [261, "                \"AWS\": \"*\"\n"], [262, "            },\n"], [263, "            \"Action\": [\n"], [264, "                \"kms:*\"\n"], [265, "            ],\n"], [266, "            \"Resource\": \"*\"\n"], [267, "        },\n"], [268, "        {\n"], [269, "            \"Sid\": \"AdministrativePermissionsForRolethatCreatedKey\",\n"], [270, "            \"Effect\": \"Allow\",\n"], [271, "            \"Principal\": {\n"], [272, "                \"AWS\": \"arn:${data.aws_partition.current.partition}:iam::${data.aws_caller_identity.current.id}:root\"\n"], [273, "            },\n"], [274, "            \"Action\": [\n"], [275, "                \"kms:Update*\",\n"], [276, "                \"kms:UntagResource\",\n"], [277, "                \"kms:TagResource\",\n"], [278, "                \"kms:SynchronizeMultiRegionKey\",\n"], [279, "                \"kms:ScheduleKeyDeletion\",\n"], [280, "                \"kms:ReplicateKey\",\n"], [281, "                \"kms:PutKeyPolicy\",\n"], [282, "                \"kms:List*\",\n"], [283, "                \"kms:Get*\",\n"], [284, "                \"kms:Enable*\",\n"], [285, "                \"kms:Disable*\",\n"], [286, "                \"kms:Describe*\",\n"], [287, "                \"kms:DeleteAlias\",\n"], [288, "                \"kms:CreateAlias\",\n"], [289, "                \"kms:CancelKeyDeletion\"\n"], [290, "            ],\n"], [291, "            \"Resource\": \"*\",\n"], [292, "            \"Condition\": {\n"], [293, "                \"StringEquals\": {\n"], [294, "                    \"aws:PrincipalOrgID\": \"${data.aws_organizations_organization.current.id}\",\n"], [295, "                    \"aws:PrincipalArn\": \"${data.aws_iam_session_context.current.issuer_arn}\"\n"], [296, "                }\n"], [297, "            }\n"], [298, "        },\n"], [299, "        {\n"], [300, "            \"Sid\": \"RecoveryAndTDIRRolePermissions\",\n"], [301, "            \"Effect\": \"Allow\",\n"], [302, "            \"Principal\": {\n"], [303, "                \"AWS\": \"arn:${data.aws_partition.current.partition}:iam::${data.aws_caller_identity.current.id}:root\"\n"], [304, "            },\n"], [305, "            \"Action\": [\n"], [306, "                \"kms:Update*\",\n"], [307, "                \"kms:UntagResource\",\n"], [308, "                \"kms:TagResource\",\n"], [309, "                \"kms:SynchronizeMultiRegionKey\",\n"], [310, "                \"kms:ScheduleKeyDeletion\",\n"], [311, "                \"kms:ReplicateKey\",\n"], [312, "                \"kms:PutKeyPolicy\",\n"], [313, "                \"kms:List*\",\n"], [314, "                \"kms:Get*\",\n"], [315, "                \"kms:Enable*\",\n"], [316, "                \"kms:Disable*\",\n"], [317, "                \"kms:Describe*\",\n"], [318, "                \"kms:DeleteAlias\",\n"], [319, "                \"kms:CreateAlias\",\n"], [320, "                \"kms:CancelKeyDeletion\"\n"], [321, "            ],\n"], [322, "            \"Resource\": \"*\",\n"], [323, "            \"Condition\": {\n"], [324, "                \"StringEquals\": {\n"], [325, "                    \"kms:CallerAccount\": \"${data.aws_caller_identity.current.id}\",\n"], [326, "                    \"aws:PrincipalOrgID\": \"${data.aws_organizations_organization.current.id}\",\n"], [327, "                    \"aws:PrincipalArn\": [\n"], [328, "                        \"arn:${data.aws_partition.current.partition}:iam::${data.aws_caller_identity.current.id}:role/recoveryrole\",\n"], [329, "                        \"arn:${data.aws_partition.current.partition}:iam::${data.aws_caller_identity.current.id}:role/incident-response-role\"\n"], [330, "                    ]\n"], [331, "                }\n"], [332, "            }\n"], [333, "        },\n"], [334, "        {\n"], [335, "            \"Sid\": \"lambdadecryptvariables\",\n"], [336, "            \"Effect\": \"Allow\",\n"], [337, "            \"Principal\": {\n"], [338, "                \"AWS\": \"arn:${data.aws_partition.current.partition}:iam::${data.aws_caller_identity.current.id}:root\"\n"], [339, "            },\n"], [340, "            \"Action\": \"kms:CreateGrant\",\n"], [341, "            \"Resource\": \"*\",\n"], [342, "            \"Condition\": {\n"], [343, "                \"StringEquals\": {\n"], [344, "                    \"kms:EncryptionContext:${data.aws_partition.current.partition}:lambda:FunctionArn\": [\n"], [345, "                        \"arn:${data.aws_partition.current.partition}:lambda:${data.aws_region.current.id}:${data.aws_caller_identity.current.id}:function:tdir-format-eventbridge-input\",\n"], [346, "                        \"arn:${data.aws_partition.current.partition}:lambda:${data.aws_region.current.id}:${data.aws_caller_identity.current.id}:function:tdir-check-snapshots\",\n"], [347, "                        \"arn:${data.aws_partition.current.partition}:lambda:${data.aws_region.current.id}:${data.aws_caller_identity.current.id}:function:tdir-create-streaming-instance\",\n"], [348, "                        \"arn:${data.aws_partition.current.partition}:lambda:${data.aws_region.current.id}:${data.aws_caller_identity.current.id}:function:tdir-check-instance-managed\",\n"], [349, "                        \"arn:${data.aws_partition.current.partition}:lambda:${data.aws_region.current.id}:${data.aws_caller_identity.current.id}:function:tdir-run-command-stream-snapshot-to-s3\",\n"], [350, "                        \"arn:${data.aws_partition.current.partition}:lambda:${data.aws_region.current.id}:${data.aws_caller_identity.current.id}:function:tdir-wait-run-command\",\n"], [351, "                        \"arn:${data.aws_partition.current.partition}:lambda:${data.aws_region.current.id}:${data.aws_caller_identity.current.id}:function:tdir-create-sidecar-volume-instance\",\n"], [352, "                        \"arn:${data.aws_partition.current.partition}:lambda:${data.aws_region.current.id}:${data.aws_caller_identity.current.id}:function:tdir-run-command-stream-sidecar-volume-snapshot-to-ec2\",\n"], [353, "                        \"arn:${data.aws_partition.current.partition}:lambda:${data.aws_region.current.id}:${data.aws_caller_identity.current.id}:function:tdir-prepare-and-attach-volume\",\n"], [354, "                        \"arn:${data.aws_partition.current.partition}:lambda:${data.aws_region.current.id}:${data.aws_caller_identity.current.id}:function:tdir-run-command-stream-memory-capture-to-s3\"\n"], [355, "                    ],\n"], [356, "                    \"kms:GrantConstraintType\": \"EncryptionContextEquals\",\n"], [357, "                    \"kms:ViaService\": \"lambda.${data.aws_region.current.id}.amazonaws.com\"\n"], [358, "                },\n"], [359, "                \"ForAllValues:StringEquals\": {\n"], [360, "                    \"kms:GrantOperations\": [\n"], [361, "                        \"Decrypt\",\n"], [362, "                        \"RetireGrant\"\n"], [363, "                    ]\n"], [364, "                },\n"], [365, "                \"Bool\": {\n"], [366, "                    \"kms:GrantIsForAWSResource\": \"true\"\n"], [367, "                }\n"], [368, "            }\n"], [369, "        },\n"], [370, "        {\n"], [371, "            \"Sid\": \"pipelinevariablemanagement\",\n"], [372, "            \"Effect\": \"Allow\",\n"], [373, "            \"Principal\": {\n"], [374, "                \"AWS\": \"arn:${data.aws_partition.current.partition}:iam::${data.aws_caller_identity.current.id}:root\"\n"], [375, "            },\n"], [376, "            \"Action\": [\n"], [377, "                \"kms:Encrypt\",\n"], [378, "                \"kms:Decrypt\"\n"], [379, "            ],\n"], [380, "            \"Resource\": \"*\",\n"], [381, "            \"Condition\": {\n"], [382, "                \"StringEquals\": {\n"], [383, "                    \"kms:EncryptionContext:${data.aws_partition.current.partition}:lambda:FunctionArn\": [\n"], [384, "                        \"arn:${data.aws_partition.current.partition}:lambda:${data.aws_region.current.id}:${data.aws_caller_identity.current.id}:function:tdir-format-eventbridge-input\",\n"], [385, "                        \"arn:${data.aws_partition.current.partition}:lambda:${data.aws_region.current.id}:${data.aws_caller_identity.current.id}:function:tdir-check-snapshots\",\n"], [386, "                        \"arn:${data.aws_partition.current.partition}:lambda:${data.aws_region.current.id}:${data.aws_caller_identity.current.id}:function:tdir-create-streaming-instance\",\n"], [387, "                        \"arn:${data.aws_partition.current.partition}:lambda:${data.aws_region.current.id}:${data.aws_caller_identity.current.id}:function:tdir-check-instance-managed\",\n"], [388, "                        \"arn:${data.aws_partition.current.partition}:lambda:${data.aws_region.current.id}:${data.aws_caller_identity.current.id}:function:tdir-run-command-stream-snapshot-to-s3\",\n"], [389, "                        \"arn:${data.aws_partition.current.partition}:lambda:${data.aws_region.current.id}:${data.aws_caller_identity.current.id}:function:tdir-wait-run-command\",\n"], [390, "                        \"arn:${data.aws_partition.current.partition}:lambda:${data.aws_region.current.id}:${data.aws_caller_identity.current.id}:function:tdir-create-sidecar-volume-instance\",\n"], [391, "                        \"arn:${data.aws_partition.current.partition}:lambda:${data.aws_region.current.id}:${data.aws_caller_identity.current.id}:function:tdir-run-command-stream-sidecar-volume-snapshot-to-ec2\",\n"], [392, "                        \"arn:${data.aws_partition.current.partition}:lambda:${data.aws_region.current.id}:${data.aws_caller_identity.current.id}:function:tdir-prepare-and-attach-volume\",\n"], [393, "                        \"arn:${data.aws_partition.current.partition}:lambda:${data.aws_region.current.id}:${data.aws_caller_identity.current.id}:function:tdir-run-command-stream-memory-capture-to-s3\"\n"], [394, "                    ],\n"], [395, "                    \"aws:PrincipalArn\": \"arn:${data.aws_partition.current.partition}:iam::${data.aws_caller_identity.current.id}:role/admin\",\n"], [396, "                    \"kms:ViaService\": \"lambda.${data.aws_region.current.id}.amazonaws.com\"\n"], [397, "                }\n"], [398, "            }\n"], [399, "        },\n"], [400, "        {\n"], [401, "            \"Sid\": \"encryption-for-loggroups\",\n"], [402, "            \"Effect\": \"Allow\",\n"], [403, "            \"Principal\": {\n"], [404, "                \"Service\": \"logs.${data.aws_region.current.id}.amazonaws.com\"\n"], [405, "            },\n"], [406, "            \"Action\": [\n"], [407, "                \"kms:ReEncrypt*\",\n"], [408, "                \"kms:GenerateDataKey*\",\n"], [409, "                \"kms:Encrypt*\",\n"], [410, "                \"kms:Describe*\",\n"], [411, "                \"kms:Decrypt*\"\n"], [412, "            ],\n"], [413, "            \"Resource\": \"*\",\n"], [414, "            \"Condition\": {\n"], [415, "                \"StringEquals\": {\n"], [416, "                    \"kms:EncryptionContext:${data.aws_partition.current.partition}:logs:arn\": [\n"], [417, "                        \"arn:${data.aws_partition.current.partition}:logs:${data.aws_region.current.id}:${data.aws_caller_identity.current.id}:log-group:/aws/stepfunction/tdir\",\n"], [418, "                        \"arn:${data.aws_partition.current.partition}:logs:${data.aws_region.current.id}:${data.aws_caller_identity.current.id}:log-group:/aws/lambda/tdir-format-eventbridge\",\n"], [419, "                        \"arn:${data.aws_partition.current.partition}:logs:${data.aws_region.current.id}:${data.aws_caller_identity.current.id}:log-group:/aws/lambda/tdir-format-eventbridge-input\",\n"], [420, "                        \"arn:${data.aws_partition.current.partition}:logs:${data.aws_region.current.id}:${data.aws_caller_identity.current.id}:log-group:/aws/lambda/tdir-check-snapshots\",\n"], [421, "                        \"arn:${data.aws_partition.current.partition}:logs:${data.aws_region.current.id}:${data.aws_caller_identity.current.id}:log-group:/aws/lambda/tdir-create-streaming-instance\",\n"], [422, "                        \"arn:${data.aws_partition.current.partition}:logs:${data.aws_region.current.id}:${data.aws_caller_identity.current.id}:log-group:/aws/lambda/tdir-check-instance-managed\",\n"], [423, "                        \"arn:${data.aws_partition.current.partition}:logs:${data.aws_region.current.id}:${data.aws_caller_identity.current.id}:log-group:/aws/lambda/tdir-run-command-stream-snapshot-to-s3\",\n"], [424, "                        \"arn:${data.aws_partition.current.partition}:logs:${data.aws_region.current.id}:${data.aws_caller_identity.current.id}:log-group:/aws/lambda/tdir-wait-run-command\",\n"], [425, "                        \"arn:${data.aws_partition.current.partition}:logs:${data.aws_region.current.id}:${data.aws_caller_identity.current.id}:log-group:/aws/lambda/tdir-create-sidecar-volume-instance\",\n"], [426, "                        \"arn:${data.aws_partition.current.partition}:logs:${data.aws_region.current.id}:${data.aws_caller_identity.current.id}:log-group:/aws/lambda/tdir-run-command-stream-sidecar-volume-snapshot-to-ec2\",\n"], [427, "                        \"arn:${data.aws_partition.current.partition}:logs:${data.aws_region.current.id}:${data.aws_caller_identity.current.id}:log-group:/aws/lambda/tdir-prepare-and-attach-volume\",\n"], [428, "                        \"arn:${data.aws_partition.current.partition}:logs:${data.aws_region.current.id}:${data.aws_caller_identity.current.id}:log-group:/aws/lambda/tdir-run-command-stream-memory-capture-to-s3\"\n"], [429, "                    ],\n"], [430, "                    \"aws:SourceOrgID\": \"${data.aws_organizations_organization.current.id}\"\n"], [431, "                }\n"], [432, "            }\n"], [433, "        },\n"], [434, "        {\n"], [435, "            \"Sid\": \"ec2runinstances\",\n"], [436, "            \"Effect\": \"Allow\",\n"], [437, "            \"Principal\": {\n"], [438, "                \"AWS\": \"arn:${data.aws_partition.current.partition}:iam::${data.aws_caller_identity.current.id}:root\"\n"], [439, "            },\n"], [440, "            \"Action\": \"kms:GenerateDataKeyWithoutPlaintext\",\n"], [441, "            \"Resource\": \"*\",\n"], [442, "            \"Condition\": {\n"], [443, "                \"StringEquals\": {\n"], [444, "                    \"aws:PrincipalArn\": \"arn:${data.aws_partition.current.partition}:iam::${data.aws_caller_identity.current.id}:role/tdir-lambda\",\n"], [445, "                    \"kms:ViaService\": \"ec2.${data.aws_region.current.id}.amazonaws.com\"\n"], [446, "                }\n"], [447, "            }\n"], [448, "        },\n"], [449, "        {\n"], [450, "            \"Sid\": \"ec2ebsdecrypt\",\n"], [451, "            \"Effect\": \"Allow\",\n"], [452, "            \"Principal\": {\n"], [453, "                \"AWS\": \"arn:${data.aws_partition.current.partition}:iam::${data.aws_caller_identity.current.id}:root\"\n"], [454, "            },\n"], [455, "            \"Action\": \"kms:CreateGrant\",\n"], [456, "            \"Resource\": \"*\",\n"], [457, "            \"Condition\": {\n"], [458, "                \"StringEquals\": {\n"], [459, "                    \"kms:GrantConstraintType\": \"EncryptionContextSubset\",\n"], [460, "                    \"aws:PrincipalArn\": \"arn:${data.aws_partition.current.partition}:iam::${data.aws_caller_identity.current.id}:role/tdir-lambda\",\n"], [461, "                    \"kms:ViaService\": \"ec2.${data.aws_region.current.id}.amazonaws.com\"\n"], [462, "                },\n"], [463, "                \"StringLike\": {\n"], [464, "                    \"kms:EncryptionContext:${data.aws_partition.current.partition}:ebs:id\": \"vol-*\"\n"], [465, "                },\n"], [466, "                \"ForAllValues:StringEquals\": {\n"], [467, "                    \"kms:GrantOperations\": \"Decrypt\"\n"], [468, "                },\n"], [469, "                \"Bool\": {\n"], [470, "                    \"kms:GrantIsForAWSResource\": \"true\"\n"], [471, "                }\n"], [472, "            }\n"], [473, "        },\n"], [474, "        {\n"], [475, "            \"Sid\": \"AllowMacietoDecryptheKey\",\n"], [476, "            \"Effect\": \"Allow\",\n"], [477, "            \"Principal\": {\n"], [478, "                \"AWS\": \"arn:${data.aws_partition.current.partition}:iam::${data.aws_caller_identity.current.id}:root\"\n"], [479, "            },\n"], [480, "            \"Action\": [\n"], [481, "                \"kms:List*\",\n"], [482, "                \"kms:GetKeyRotationStatus\",\n"], [483, "                \"kms:GetKeyPolicy\",\n"], [484, "                \"kms:Describe*\",\n"], [485, "                \"kms:Decrypt\"\n"], [486, "            ],\n"], [487, "            \"Resource\": \"*\",\n"], [488, "            \"Condition\": {\n"], [489, "                \"StringEquals\": {\n"], [490, "                    \"aws:PrincipalArn\": \"arn:${data.aws_partition.current.partition}:iam::${data.aws_caller_identity.current.id}:role/aws-service-role/macie.amazonaws.com/AWSServiceRoleForAmazonMacie\"\n"], [491, "                }\n"], [492, "            }\n"], [493, "        },\n"], [494, "        {\n"], [495, "            \"Sid\": \"s3upload\",\n"], [496, "            \"Effect\": \"Allow\",\n"], [497, "            \"Principal\": {\n"], [498, "                \"AWS\": \"arn:${data.aws_partition.current.partition}:iam::${data.aws_caller_identity.current.id}:root\"\n"], [499, "            },\n"], [500, "            \"Action\": [\n"], [501, "                \"kms:GenerateDataKey\",\n"], [502, "                \"kms:Decrypt\"\n"], [503, "            ],\n"], [504, "            \"Resource\": \"*\",\n"], [505, "            \"Condition\": {\n"], [506, "                \"StringEquals\": {\n"], [507, "                    \"aws:PrincipalArn\": \"arn:${data.aws_partition.current.partition}:iam::${data.aws_caller_identity.current.id}:role/tdir-ec2-collection\",\n"], [508, "                    \"kms:EncryptionContext:${data.aws_partition.current.partition}:s3:arn\": \"arn:${data.aws_partition.current.partition}:s3:::tdir-${data.aws_caller_identity.current.id}-${data.aws_region.current.id}\",\n"], [509, "                    \"kms:ViaService\": \"s3.${data.aws_region.current.id}.amazonaws.com\"\n"], [510, "                }\n"], [511, "            }\n"], [512, "        },\n"], [513, "        {\n"], [514, "            \"Sid\": \"s3download\",\n"], [515, "            \"Effect\": \"Allow\",\n"], [516, "            \"Principal\": {\n"], [517, "                \"AWS\": \"arn:${data.aws_partition.current.partition}:iam::${data.aws_caller_identity.current.id}:root\"\n"], [518, "            },\n"], [519, "            \"Action\": \"kms:Decrypt\",\n"], [520, "            \"Resource\": \"*\",\n"], [521, "            \"Condition\": {\n"], [522, "                \"StringEquals\": {\n"], [523, "                    \"aws:PrincipalArn\": \"arn:${data.aws_partition.current.partition}:iam::${data.aws_caller_identity.current.id}:role/admin\",\n"], [524, "                    \"kms:EncryptionContext:${data.aws_partition.current.partition}:s3:arn\": \"arn:${data.aws_partition.current.partition}:s3:::tdir-${data.aws_caller_identity.current.id}-${data.aws_region.current.id}\",\n"], [525, "                    \"kms:ViaService\": \"s3.${data.aws_region.current.id}.amazonaws.com\"\n"], [526, "                }\n"], [527, "            }\n"], [528, "        },\n"], [529, "        {\n"], [530, "            \"Sid\": \"AllowConfigandAccessAnalyzertoReadKeyAttributes\",\n"], [531, "            \"Effect\": \"Allow\",\n"], [532, "            \"Principal\": {\n"], [533, "                \"AWS\": \"arn:${data.aws_partition.current.partition}:iam::${data.aws_caller_identity.current.id}:root\"\n"], [534, "            },\n"], [535, "            \"Action\": [\n"], [536, "                \"kms:List*\",\n"], [537, "                \"kms:GetKeyRotationStatus\",\n"], [538, "                \"kms:GetKeyPolicy\",\n"], [539, "                \"kms:Describe*\"\n"], [540, "            ],\n"], [541, "            \"Resource\": \"*\",\n"], [542, "            \"Condition\": {\n"], [543, "                \"StringEquals\": {\n"], [544, "                    \"aws:PrincipalArn\": [\n"], [545, "                        \"arn:${data.aws_partition.current.partition}:iam::${data.aws_caller_identity.current.id}:role/aws-service-role/access-analyzer.amazonaws.com/AWSServiceRoleForAccessAnalyzer\",\n"], [546, "                        \"arn:${data.aws_partition.current.partition}:iam::${data.aws_caller_identity.current.id}:role/aws-service-role/config.amazonaws.com/AWSServiceRoleForConfig\"\n"], [547, "                    ]\n"], [548, "                }\n"], [549, "            }\n"], [550, "        },\n"], [551, "        {\n"], [552, "            \"Sid\": \"DenyNonOrganizationalServiceEncryptionUse\",\n"], [553, "            \"Effect\": \"Deny\",\n"], [554, "            \"Principal\": {\n"], [555, "                \"AWS\": \"*\"\n"], [556, "            },\n"], [557, "            \"Action\": \"kms:*\",\n"], [558, "            \"Resource\": \"*\",\n"], [559, "            \"Condition\": {\n"], [560, "                \"StringNotEqualsIfExists\": {\n"], [561, "                    \"aws:SourceOrgID\": \"${data.aws_organizations_organization.current.id}\"\n"], [562, "                },\n"], [563, "                \"Null\": {\n"], [564, "                    \"aws:SourceOrgID\": \"false\"\n"], [565, "                },\n"], [566, "                \"BoolIfExists\": {\n"], [567, "                    \"aws:PrincipalIsAWSService\": \"true\"\n"], [568, "                }\n"], [569, "            }\n"], [570, "        },\n"], [571, "        {\n"], [572, "            \"Sid\": \"PreventNonOrganizationalAccess\",\n"], [573, "            \"Effect\": \"Deny\",\n"], [574, "            \"Principal\": {\n"], [575, "                \"AWS\": \"*\"\n"], [576, "            },\n"], [577, "            \"Action\": \"kms:*\",\n"], [578, "            \"Resource\": \"*\",\n"], [579, "            \"Condition\": {\n"], [580, "                \"StringNotEqualsIfExists\": {\n"], [581, "                    \"aws:PrincipalOrgID\": \"${data.aws_organizations_organization.current.id}\"\n"], [582, "                },\n"], [583, "                \"BoolIfExists\": {\n"], [584, "                    \"aws:PrincipalIsAWSService\": \"false\"\n"], [585, "                }\n"], [586, "            }\n"], [587, "        },\n"], [588, "        {\n"], [589, "            \"Sid\": \"MaxDeletionWindow\",\n"], [590, "            \"Effect\": \"Deny\",\n"], [591, "            \"Principal\": {\n"], [592, "                \"AWS\": \"*\"\n"], [593, "            },\n"], [594, "            \"Action\": \"kms:ScheduleKeyDeletion\",\n"], [595, "            \"Resource\": \"*\",\n"], [596, "            \"Condition\": {\n"], [597, "                \"NumericLessThan\": {\n"], [598, "                    \"kms:ScheduleKeyDeletionPendingWindowInDays\": \"30\"\n"], [599, "                }\n"], [600, "            }\n"], [601, "        },\n"], [602, "        {\n"], [603, "            \"Sid\": \"PreventSafetyLockoutBypass\",\n"], [604, "            \"Effect\": \"Deny\",\n"], [605, "            \"Principal\": {\n"], [606, "                \"AWS\": \"*\"\n"], [607, "            },\n"], [608, "            \"Action\": \"kms:PutKeyPolicy\",\n"], [609, "            \"Resource\": \"*\",\n"], [610, "            \"Condition\": {\n"], [611, "                \"Bool\": {\n"], [612, "                    \"kms:BypassPolicyLockoutSafetyCheck\": \"true\"\n"], [613, "                }\n"], [614, "            }\n"], [615, "        }\n"], [616, "    ]\n"], [617, "}\n"], [618, "EOF\n"], [619, "  enable_key_rotation     = true\n"], [620, "}\n"]], "file_path": "/kms.tf", "file_abs_path": "/github/workspace/kms.tf", "repo_file_path": "/kms.tf", "file_line_range": [251, 620], "resource": "aws_kms_key.fail3", "evaluations": null, "check_class": "checkov.terraform.checks.resource.aws.KMSRotation", "fixed_definition": null, "entity_tags": null, "caller_file_path": null, "caller_file_line_range": null, "resource_address": null, "severity": null, "bc_category": null, "benchmarks": {}, "description": null, "short_description": null, "vulnerability_details": null, "connected_node": null, "guideline": null, "details": [], "check_len": null, "definition_context_file_path": "/github/workspace/kms.tf"}, {"check_id": "CKV_AWS_227", "bc_check_id": null, "check_name": "Ensure KMS key is enabled", "check_result": {"result": "PASSED", "evaluated_keys": ["is_enabled"]}, "code_block": [[251, "resource \"aws_kms_key\" \"fail3\" {\n"], [252, "  description             = \"fail3\"\n"], [253, "  deletion_window_in_days = 30\n"], [254, "  policy                  = <<EOF\n"], [255, "  {\n"], [256, "    \"Version\": \"2012-10-17\",\n"], [257, "    \"Statement\": [\n"], [258, "        {\n"], [259, "            \"Effect\": \"Allow\",\n"], [260, "            \"Principal\": {\n"], [261, "                \"AWS\": \"*\"\n"], [262, "            },\n"], [263, "            \"Action\": [\n"], [264, "                \"kms:*\"\n"], [265, "            ],\n"], [266, "            \"Resource\": \"*\"\n"], [267, "        },\n"], [268, "        {\n"], [269, "            \"Sid\": \"AdministrativePermissionsForRolethatCreatedKey\",\n"], [270, "            \"Effect\": \"Allow\",\n"], [271, "            \"Principal\": {\n"], [272, "                \"AWS\": \"arn:${data.aws_partition.current.partition}:iam::${data.aws_caller_identity.current.id}:root\"\n"], [273, "            },\n"], [274, "            \"Action\": [\n"], [275, "                \"kms:Update*\",\n"], [276, "                \"kms:UntagResource\",\n"], [277, "                \"kms:TagResource\",\n"], [278, "                \"kms:SynchronizeMultiRegionKey\",\n"], [279, "                \"kms:ScheduleKeyDeletion\",\n"], [280, "                \"kms:ReplicateKey\",\n"], [281, "                \"kms:PutKeyPolicy\",\n"], [282, "                \"kms:List*\",\n"], [283, "                \"kms:Get*\",\n"], [284, "                \"kms:Enable*\",\n"], [285, "                \"kms:Disable*\",\n"], [286, "                \"kms:Describe*\",\n"], [287, "                \"kms:DeleteAlias\",\n"], [288, "                \"kms:CreateAlias\",\n"], [289, "                \"kms:CancelKeyDeletion\"\n"], [290, "            ],\n"], [291, "            \"Resource\": \"*\",\n"], [292, "            \"Condition\": {\n"], [293, "                \"StringEquals\": {\n"], [294, "                    \"aws:PrincipalOrgID\": \"${data.aws_organizations_organization.current.id}\",\n"], [295, "                    \"aws:PrincipalArn\": \"${data.aws_iam_session_context.current.issuer_arn}\"\n"], [296, "                }\n"], [297, "            }\n"], [298, "        },\n"], [299, "        {\n"], [300, "            \"Sid\": \"RecoveryAndTDIRRolePermissions\",\n"], [301, "            \"Effect\": \"Allow\",\n"], [302, "            \"Principal\": {\n"], [303, "                \"AWS\": \"arn:${data.aws_partition.current.partition}:iam::${data.aws_caller_identity.current.id}:root\"\n"], [304, "            },\n"], [305, "            \"Action\": [\n"], [306, "                \"kms:Update*\",\n"], [307, "                \"kms:UntagResource\",\n"], [308, "                \"kms:TagResource\",\n"], [309, "                \"kms:SynchronizeMultiRegionKey\",\n"], [310, "                \"kms:ScheduleKeyDeletion\",\n"], [311, "                \"kms:ReplicateKey\",\n"], [312, "                \"kms:PutKeyPolicy\",\n"], [313, "                \"kms:List*\",\n"], [314, "                \"kms:Get*\",\n"], [315, "                \"kms:Enable*\",\n"], [316, "                \"kms:Disable*\",\n"], [317, "                \"kms:Describe*\",\n"], [318, "                \"kms:DeleteAlias\",\n"], [319, "                \"kms:CreateAlias\",\n"], [320, "                \"kms:CancelKeyDeletion\"\n"], [321, "            ],\n"], [322, "            \"Resource\": \"*\",\n"], [323, "            \"Condition\": {\n"], [324, "                \"StringEquals\": {\n"], [325, "                    \"kms:CallerAccount\": \"${data.aws_caller_identity.current.id}\",\n"], [326, "                    \"aws:PrincipalOrgID\": \"${data.aws_organizations_organization.current.id}\",\n"], [327, "                    \"aws:PrincipalArn\": [\n"], [328, "                        \"arn:${data.aws_partition.current.partition}:iam::${data.aws_caller_identity.current.id}:role/recoveryrole\",\n"], [329, "                        \"arn:${data.aws_partition.current.partition}:iam::${data.aws_caller_identity.current.id}:role/incident-response-role\"\n"], [330, "                    ]\n"], [331, "                }\n"], [332, "            }\n"], [333, "        },\n"], [334, "        {\n"], [335, "            \"Sid\": \"lambdadecryptvariables\",\n"], [336, "            \"Effect\": \"Allow\",\n"], [337, "            \"Principal\": {\n"], [338, "                \"AWS\": \"arn:${data.aws_partition.current.partition}:iam::${data.aws_caller_identity.current.id}:root\"\n"], [339, "            },\n"], [340, "            \"Action\": \"kms:CreateGrant\",\n"], [341, "            \"Resource\": \"*\",\n"], [342, "            \"Condition\": {\n"], [343, "                \"StringEquals\": {\n"], [344, "                    \"kms:EncryptionContext:${data.aws_partition.current.partition}:lambda:FunctionArn\": [\n"], [345, "                        \"arn:${data.aws_partition.current.partition}:lambda:${data.aws_region.current.id}:${data.aws_caller_identity.current.id}:function:tdir-format-eventbridge-input\",\n"], [346, "                        \"arn:${data.aws_partition.current.partition}:lambda:${data.aws_region.current.id}:${data.aws_caller_identity.current.id}:function:tdir-check-snapshots\",\n"], [347, "                        \"arn:${data.aws_partition.current.partition}:lambda:${data.aws_region.current.id}:${data.aws_caller_identity.current.id}:function:tdir-create-streaming-instance\",\n"], [348, "                        \"arn:${data.aws_partition.current.partition}:lambda:${data.aws_region.current.id}:${data.aws_caller_identity.current.id}:function:tdir-check-instance-managed\",\n"], [349, "                        \"arn:${data.aws_partition.current.partition}:lambda:${data.aws_region.current.id}:${data.aws_caller_identity.current.id}:function:tdir-run-command-stream-snapshot-to-s3\",\n"], [350, "                        \"arn:${data.aws_partition.current.partition}:lambda:${data.aws_region.current.id}:${data.aws_caller_identity.current.id}:function:tdir-wait-run-command\",\n"], [351, "                        \"arn:${data.aws_partition.current.partition}:lambda:${data.aws_region.current.id}:${data.aws_caller_identity.current.id}:function:tdir-create-sidecar-volume-instance\",\n"], [352, "                        \"arn:${data.aws_partition.current.partition}:lambda:${data.aws_region.current.id}:${data.aws_caller_identity.current.id}:function:tdir-run-command-stream-sidecar-volume-snapshot-to-ec2\",\n"], [353, "                        \"arn:${data.aws_partition.current.partition}:lambda:${data.aws_region.current.id}:${data.aws_caller_identity.current.id}:function:tdir-prepare-and-attach-volume\",\n"], [354, "                        \"arn:${data.aws_partition.current.partition}:lambda:${data.aws_region.current.id}:${data.aws_caller_identity.current.id}:function:tdir-run-command-stream-memory-capture-to-s3\"\n"], [355, "                    ],\n"], [356, "                    \"kms:GrantConstraintType\": \"EncryptionContextEquals\",\n"], [357, "                    \"kms:ViaService\": \"lambda.${data.aws_region.current.id}.amazonaws.com\"\n"], [358, "                },\n"], [359, "                \"ForAllValues:StringEquals\": {\n"], [360, "                    \"kms:GrantOperations\": [\n"], [361, "                        \"Decrypt\",\n"], [362, "                        \"RetireGrant\"\n"], [363, "                    ]\n"], [364, "                },\n"], [365, "                \"Bool\": {\n"], [366, "                    \"kms:GrantIsForAWSResource\": \"true\"\n"], [367, "                }\n"], [368, "            }\n"], [369, "        },\n"], [370, "        {\n"], [371, "            \"Sid\": \"pipelinevariablemanagement\",\n"], [372, "            \"Effect\": \"Allow\",\n"], [373, "            \"Principal\": {\n"], [374, "                \"AWS\": \"arn:${data.aws_partition.current.partition}:iam::${data.aws_caller_identity.current.id}:root\"\n"], [375, "            },\n"], [376, "            \"Action\": [\n"], [377, "                \"kms:Encrypt\",\n"], [378, "                \"kms:Decrypt\"\n"], [379, "            ],\n"], [380, "            \"Resource\": \"*\",\n"], [381, "            \"Condition\": {\n"], [382, "                \"StringEquals\": {\n"], [383, "                    \"kms:EncryptionContext:${data.aws_partition.current.partition}:lambda:FunctionArn\": [\n"], [384, "                        \"arn:${data.aws_partition.current.partition}:lambda:${data.aws_region.current.id}:${data.aws_caller_identity.current.id}:function:tdir-format-eventbridge-input\",\n"], [385, "                        \"arn:${data.aws_partition.current.partition}:lambda:${data.aws_region.current.id}:${data.aws_caller_identity.current.id}:function:tdir-check-snapshots\",\n"], [386, "                        \"arn:${data.aws_partition.current.partition}:lambda:${data.aws_region.current.id}:${data.aws_caller_identity.current.id}:function:tdir-create-streaming-instance\",\n"], [387, "                        \"arn:${data.aws_partition.current.partition}:lambda:${data.aws_region.current.id}:${data.aws_caller_identity.current.id}:function:tdir-check-instance-managed\",\n"], [388, "                        \"arn:${data.aws_partition.current.partition}:lambda:${data.aws_region.current.id}:${data.aws_caller_identity.current.id}:function:tdir-run-command-stream-snapshot-to-s3\",\n"], [389, "                        \"arn:${data.aws_partition.current.partition}:lambda:${data.aws_region.current.id}:${data.aws_caller_identity.current.id}:function:tdir-wait-run-command\",\n"], [390, "                        \"arn:${data.aws_partition.current.partition}:lambda:${data.aws_region.current.id}:${data.aws_caller_identity.current.id}:function:tdir-create-sidecar-volume-instance\",\n"], [391, "                        \"arn:${data.aws_partition.current.partition}:lambda:${data.aws_region.current.id}:${data.aws_caller_identity.current.id}:function:tdir-run-command-stream-sidecar-volume-snapshot-to-ec2\",\n"], [392, "                        \"arn:${data.aws_partition.current.partition}:lambda:${data.aws_region.current.id}:${data.aws_caller_identity.current.id}:function:tdir-prepare-and-attach-volume\",\n"], [393, "                        \"arn:${data.aws_partition.current.partition}:lambda:${data.aws_region.current.id}:${data.aws_caller_identity.current.id}:function:tdir-run-command-stream-memory-capture-to-s3\"\n"], [394, "                    ],\n"], [395, "                    \"aws:PrincipalArn\": \"arn:${data.aws_partition.current.partition}:iam::${data.aws_caller_identity.current.id}:role/admin\",\n"], [396, "                    \"kms:ViaService\": \"lambda.${data.aws_region.current.id}.amazonaws.com\"\n"], [397, "                }\n"], [398, "            }\n"], [399, "        },\n"], [400, "        {\n"], [401, "            \"Sid\": \"encryption-for-loggroups\",\n"], [402, "            \"Effect\": \"Allow\",\n"], [403, "            \"Principal\": {\n"], [404, "                \"Service\": \"logs.${data.aws_region.current.id}.amazonaws.com\"\n"], [405, "            },\n"], [406, "            \"Action\": [\n"], [407, "                \"kms:ReEncrypt*\",\n"], [408, "                \"kms:GenerateDataKey*\",\n"], [409, "                \"kms:Encrypt*\",\n"], [410, "                \"kms:Describe*\",\n"], [411, "                \"kms:Decrypt*\"\n"], [412, "            ],\n"], [413, "            \"Resource\": \"*\",\n"], [414, "            \"Condition\": {\n"], [415, "                \"StringEquals\": {\n"], [416, "                    \"kms:EncryptionContext:${data.aws_partition.current.partition}:logs:arn\": [\n"], [417, "                        \"arn:${data.aws_partition.current.partition}:logs:${data.aws_region.current.id}:${data.aws_caller_identity.current.id}:log-group:/aws/stepfunction/tdir\",\n"], [418, "                        \"arn:${data.aws_partition.current.partition}:logs:${data.aws_region.current.id}:${data.aws_caller_identity.current.id}:log-group:/aws/lambda/tdir-format-eventbridge\",\n"], [419, "                        \"arn:${data.aws_partition.current.partition}:logs:${data.aws_region.current.id}:${data.aws_caller_identity.current.id}:log-group:/aws/lambda/tdir-format-eventbridge-input\",\n"], [420, "                        \"arn:${data.aws_partition.current.partition}:logs:${data.aws_region.current.id}:${data.aws_caller_identity.current.id}:log-group:/aws/lambda/tdir-check-snapshots\",\n"], [421, "                        \"arn:${data.aws_partition.current.partition}:logs:${data.aws_region.current.id}:${data.aws_caller_identity.current.id}:log-group:/aws/lambda/tdir-create-streaming-instance\",\n"], [422, "                        \"arn:${data.aws_partition.current.partition}:logs:${data.aws_region.current.id}:${data.aws_caller_identity.current.id}:log-group:/aws/lambda/tdir-check-instance-managed\",\n"], [423, "                        \"arn:${data.aws_partition.current.partition}:logs:${data.aws_region.current.id}:${data.aws_caller_identity.current.id}:log-group:/aws/lambda/tdir-run-command-stream-snapshot-to-s3\",\n"], [424, "                        \"arn:${data.aws_partition.current.partition}:logs:${data.aws_region.current.id}:${data.aws_caller_identity.current.id}:log-group:/aws/lambda/tdir-wait-run-command\",\n"], [425, "                        \"arn:${data.aws_partition.current.partition}:logs:${data.aws_region.current.id}:${data.aws_caller_identity.current.id}:log-group:/aws/lambda/tdir-create-sidecar-volume-instance\",\n"], [426, "                        \"arn:${data.aws_partition.current.partition}:logs:${data.aws_region.current.id}:${data.aws_caller_identity.current.id}:log-group:/aws/lambda/tdir-run-command-stream-sidecar-volume-snapshot-to-ec2\",\n"], [427, "                        \"arn:${data.aws_partition.current.partition}:logs:${data.aws_region.current.id}:${data.aws_caller_identity.current.id}:log-group:/aws/lambda/tdir-prepare-and-attach-volume\",\n"], [428, "                        \"arn:${data.aws_partition.current.partition}:logs:${data.aws_region.current.id}:${data.aws_caller_identity.current.id}:log-group:/aws/lambda/tdir-run-command-stream-memory-capture-to-s3\"\n"], [429, "                    ],\n"], [430, "                    \"aws:SourceOrgID\": \"${data.aws_organizations_organization.current.id}\"\n"], [431, "                }\n"], [432, "            }\n"], [433, "        },\n"], [434, "        {\n"], [435, "            \"Sid\": \"ec2runinstances\",\n"], [436, "            \"Effect\": \"Allow\",\n"], [437, "            \"Principal\": {\n"], [438, "                \"AWS\": \"arn:${data.aws_partition.current.partition}:iam::${data.aws_caller_identity.current.id}:root\"\n"], [439, "            },\n"], [440, "            \"Action\": \"kms:GenerateDataKeyWithoutPlaintext\",\n"], [441, "            \"Resource\": \"*\",\n"], [442, "            \"Condition\": {\n"], [443, "                \"StringEquals\": {\n"], [444, "                    \"aws:PrincipalArn\": \"arn:${data.aws_partition.current.partition}:iam::${data.aws_caller_identity.current.id}:role/tdir-lambda\",\n"], [445, "                    \"kms:ViaService\": \"ec2.${data.aws_region.current.id}.amazonaws.com\"\n"], [446, "                }\n"], [447, "            }\n"], [448, "        },\n"], [449, "        {\n"], [450, "            \"Sid\": \"ec2ebsdecrypt\",\n"], [451, "            \"Effect\": \"Allow\",\n"], [452, "            \"Principal\": {\n"], [453, "                \"AWS\": \"arn:${data.aws_partition.current.partition}:iam::${data.aws_caller_identity.current.id}:root\"\n"], [454, "            },\n"], [455, "            \"Action\": \"kms:CreateGrant\",\n"], [456, "            \"Resource\": \"*\",\n"], [457, "            \"Condition\": {\n"], [458, "                \"StringEquals\": {\n"], [459, "                    \"kms:GrantConstraintType\": \"EncryptionContextSubset\",\n"], [460, "                    \"aws:PrincipalArn\": \"arn:${data.aws_partition.current.partition}:iam::${data.aws_caller_identity.current.id}:role/tdir-lambda\",\n"], [461, "                    \"kms:ViaService\": \"ec2.${data.aws_region.current.id}.amazonaws.com\"\n"], [462, "                },\n"], [463, "                \"StringLike\": {\n"], [464, "                    \"kms:EncryptionContext:${data.aws_partition.current.partition}:ebs:id\": \"vol-*\"\n"], [465, "                },\n"], [466, "                \"ForAllValues:StringEquals\": {\n"], [467, "                    \"kms:GrantOperations\": \"Decrypt\"\n"], [468, "                },\n"], [469, "                \"Bool\": {\n"], [470, "                    \"kms:GrantIsForAWSResource\": \"true\"\n"], [471, "                }\n"], [472, "            }\n"], [473, "        },\n"], [474, "        {\n"], [475, "            \"Sid\": \"AllowMacietoDecryptheKey\",\n"], [476, "            \"Effect\": \"Allow\",\n"], [477, "            \"Principal\": {\n"], [478, "                \"AWS\": \"arn:${data.aws_partition.current.partition}:iam::${data.aws_caller_identity.current.id}:root\"\n"], [479, "            },\n"], [480, "            \"Action\": [\n"], [481, "                \"kms:List*\",\n"], [482, "                \"kms:GetKeyRotationStatus\",\n"], [483, "                \"kms:GetKeyPolicy\",\n"], [484, "                \"kms:Describe*\",\n"], [485, "                \"kms:Decrypt\"\n"], [486, "            ],\n"], [487, "            \"Resource\": \"*\",\n"], [488, "            \"Condition\": {\n"], [489, "                \"StringEquals\": {\n"], [490, "                    \"aws:PrincipalArn\": \"arn:${data.aws_partition.current.partition}:iam::${data.aws_caller_identity.current.id}:role/aws-service-role/macie.amazonaws.com/AWSServiceRoleForAmazonMacie\"\n"], [491, "                }\n"], [492, "            }\n"], [493, "        },\n"], [494, "        {\n"], [495, "            \"Sid\": \"s3upload\",\n"], [496, "            \"Effect\": \"Allow\",\n"], [497, "            \"Principal\": {\n"], [498, "                \"AWS\": \"arn:${data.aws_partition.current.partition}:iam::${data.aws_caller_identity.current.id}:root\"\n"], [499, "            },\n"], [500, "            \"Action\": [\n"], [501, "                \"kms:GenerateDataKey\",\n"], [502, "                \"kms:Decrypt\"\n"], [503, "            ],\n"], [504, "            \"Resource\": \"*\",\n"], [505, "            \"Condition\": {\n"], [506, "                \"StringEquals\": {\n"], [507, "                    \"aws:PrincipalArn\": \"arn:${data.aws_partition.current.partition}:iam::${data.aws_caller_identity.current.id}:role/tdir-ec2-collection\",\n"], [508, "                    \"kms:EncryptionContext:${data.aws_partition.current.partition}:s3:arn\": \"arn:${data.aws_partition.current.partition}:s3:::tdir-${data.aws_caller_identity.current.id}-${data.aws_region.current.id}\",\n"], [509, "                    \"kms:ViaService\": \"s3.${data.aws_region.current.id}.amazonaws.com\"\n"], [510, "                }\n"], [511, "            }\n"], [512, "        },\n"], [513, "        {\n"], [514, "            \"Sid\": \"s3download\",\n"], [515, "            \"Effect\": \"Allow\",\n"], [516, "            \"Principal\": {\n"], [517, "                \"AWS\": \"arn:${data.aws_partition.current.partition}:iam::${data.aws_caller_identity.current.id}:root\"\n"], [518, "            },\n"], [519, "            \"Action\": \"kms:Decrypt\",\n"], [520, "            \"Resource\": \"*\",\n"], [521, "            \"Condition\": {\n"], [522, "                \"StringEquals\": {\n"], [523, "                    \"aws:PrincipalArn\": \"arn:${data.aws_partition.current.partition}:iam::${data.aws_caller_identity.current.id}:role/admin\",\n"], [524, "                    \"kms:EncryptionContext:${data.aws_partition.current.partition}:s3:arn\": \"arn:${data.aws_partition.current.partition}:s3:::tdir-${data.aws_caller_identity.current.id}-${data.aws_region.current.id}\",\n"], [525, "                    \"kms:ViaService\": \"s3.${data.aws_region.current.id}.amazonaws.com\"\n"], [526, "                }\n"], [527, "            }\n"], [528, "        },\n"], [529, "        {\n"], [530, "            \"Sid\": \"AllowConfigandAccessAnalyzertoReadKeyAttributes\",\n"], [531, "            \"Effect\": \"Allow\",\n"], [532, "            \"Principal\": {\n"], [533, "                \"AWS\": \"arn:${data.aws_partition.current.partition}:iam::${data.aws_caller_identity.current.id}:root\"\n"], [534, "            },\n"], [535, "            \"Action\": [\n"], [536, "                \"kms:List*\",\n"], [537, "                \"kms:GetKeyRotationStatus\",\n"], [538, "                \"kms:GetKeyPolicy\",\n"], [539, "                \"kms:Describe*\"\n"], [540, "            ],\n"], [541, "            \"Resource\": \"*\",\n"], [542, "            \"Condition\": {\n"], [543, "                \"StringEquals\": {\n"], [544, "                    \"aws:PrincipalArn\": [\n"], [545, "                        \"arn:${data.aws_partition.current.partition}:iam::${data.aws_caller_identity.current.id}:role/aws-service-role/access-analyzer.amazonaws.com/AWSServiceRoleForAccessAnalyzer\",\n"], [546, "                        \"arn:${data.aws_partition.current.partition}:iam::${data.aws_caller_identity.current.id}:role/aws-service-role/config.amazonaws.com/AWSServiceRoleForConfig\"\n"], [547, "                    ]\n"], [548, "                }\n"], [549, "            }\n"], [550, "        },\n"], [551, "        {\n"], [552, "            \"Sid\": \"DenyNonOrganizationalServiceEncryptionUse\",\n"], [553, "            \"Effect\": \"Deny\",\n"], [554, "            \"Principal\": {\n"], [555, "                \"AWS\": \"*\"\n"], [556, "            },\n"], [557, "            \"Action\": \"kms:*\",\n"], [558, "            \"Resource\": \"*\",\n"], [559, "            \"Condition\": {\n"], [560, "                \"StringNotEqualsIfExists\": {\n"], [561, "                    \"aws:SourceOrgID\": \"${data.aws_organizations_organization.current.id}\"\n"], [562, "                },\n"], [563, "                \"Null\": {\n"], [564, "                    \"aws:SourceOrgID\": \"false\"\n"], [565, "                },\n"], [566, "                \"BoolIfExists\": {\n"], [567, "                    \"aws:PrincipalIsAWSService\": \"true\"\n"], [568, "                }\n"], [569, "            }\n"], [570, "        },\n"], [571, "        {\n"], [572, "            \"Sid\": \"PreventNonOrganizationalAccess\",\n"], [573, "            \"Effect\": \"Deny\",\n"], [574, "            \"Principal\": {\n"], [575, "                \"AWS\": \"*\"\n"], [576, "            },\n"], [577, "            \"Action\": \"kms:*\",\n"], [578, "            \"Resource\": \"*\",\n"], [579, "            \"Condition\": {\n"], [580, "                \"StringNotEqualsIfExists\": {\n"], [581, "                    \"aws:PrincipalOrgID\": \"${data.aws_organizations_organization.current.id}\"\n"], [582, "                },\n"], [583, "                \"BoolIfExists\": {\n"], [584, "                    \"aws:PrincipalIsAWSService\": \"false\"\n"], [585, "                }\n"], [586, "            }\n"], [587, "        },\n"], [588, "        {\n"], [589, "            \"Sid\": \"MaxDeletionWindow\",\n"], [590, "            \"Effect\": \"Deny\",\n"], [591, "            \"Principal\": {\n"], [592, "                \"AWS\": \"*\"\n"], [593, "            },\n"], [594, "            \"Action\": \"kms:ScheduleKeyDeletion\",\n"], [595, "            \"Resource\": \"*\",\n"], [596, "            \"Condition\": {\n"], [597, "                \"NumericLessThan\": {\n"], [598, "                    \"kms:ScheduleKeyDeletionPendingWindowInDays\": \"30\"\n"], [599, "                }\n"], [600, "            }\n"], [601, "        },\n"], [602, "        {\n"], [603, "            \"Sid\": \"PreventSafetyLockoutBypass\",\n"], [604, "            \"Effect\": \"Deny\",\n"], [605, "            \"Principal\": {\n"], [606, "                \"AWS\": \"*\"\n"], [607, "            },\n"], [608, "            \"Action\": \"kms:PutKeyPolicy\",\n"], [609, "            \"Resource\": \"*\",\n"], [610, "            \"Condition\": {\n"], [611, "                \"Bool\": {\n"], [612, "                    \"kms:BypassPolicyLockoutSafetyCheck\": \"true\"\n"], [613, "                }\n"], [614, "            }\n"], [615, "        }\n"], [616, "    ]\n"], [617, "}\n"], [618, "EOF\n"], [619, "  enable_key_rotation     = true\n"], [620, "}\n"]], "file_path": "/kms.tf", "file_abs_path": "/github/workspace/kms.tf", "repo_file_path": "/kms.tf", "file_line_range": [251, 620], "resource": "aws_kms_key.fail3", "evaluations": null, "check_class": "checkov.terraform.checks.resource.aws.KMSKeyIsEnabled", "fixed_definition": null, "entity_tags": null, "caller_file_path": null, "caller_file_line_range": null, "resource_address": null, "severity": null, "bc_category": null, "benchmarks": {}, "description": null, "short_description": null, "vulnerability_details": null, "connected_node": null, "guideline": null, "details": [], "check_len": null, "definition_context_file_path": "/github/workspace/kms.tf"}, {"check_id": "CKV_AWS_33", "bc_check_id": null, "check_name": "Ensure KMS key policy does not contain wildcard (*) principal", "check_result": {"result": "PASSED", "evaluated_keys": ["policy/[0]/Statement"]}, "code_block": [[251, "resource \"aws_kms_key\" \"fail3\" {\n"], [252, "  description             = \"fail3\"\n"], [253, "  deletion_window_in_days = 30\n"], [254, "  policy                  = <<EOF\n"], [255, "  {\n"], [256, "    \"Version\": \"2012-10-17\",\n"], [257, "    \"Statement\": [\n"], [258, "        {\n"], [259, "            \"Effect\": \"Allow\",\n"], [260, "            \"Principal\": {\n"], [261, "                \"AWS\": \"*\"\n"], [262, "            },\n"], [263, "            \"Action\": [\n"], [264, "                \"kms:*\"\n"], [265, "            ],\n"], [266, "            \"Resource\": \"*\"\n"], [267, "        },\n"], [268, "        {\n"], [269, "            \"Sid\": \"AdministrativePermissionsForRolethatCreatedKey\",\n"], [270, "            \"Effect\": \"Allow\",\n"], [271, "            \"Principal\": {\n"], [272, "                \"AWS\": \"arn:${data.aws_partition.current.partition}:iam::${data.aws_caller_identity.current.id}:root\"\n"], [273, "            },\n"], [274, "            \"Action\": [\n"], [275, "                \"kms:Update*\",\n"], [276, "                \"kms:UntagResource\",\n"], [277, "                \"kms:TagResource\",\n"], [278, "                \"kms:SynchronizeMultiRegionKey\",\n"], [279, "                \"kms:ScheduleKeyDeletion\",\n"], [280, "                \"kms:ReplicateKey\",\n"], [281, "                \"kms:PutKeyPolicy\",\n"], [282, "                \"kms:List*\",\n"], [283, "                \"kms:Get*\",\n"], [284, "                \"kms:Enable*\",\n"], [285, "                \"kms:Disable*\",\n"], [286, "                \"kms:Describe*\",\n"], [287, "                \"kms:DeleteAlias\",\n"], [288, "                \"kms:CreateAlias\",\n"], [289, "                \"kms:CancelKeyDeletion\"\n"], [290, "            ],\n"], [291, "            \"Resource\": \"*\",\n"], [292, "            \"Condition\": {\n"], [293, "                \"StringEquals\": {\n"], [294, "                    \"aws:PrincipalOrgID\": \"${data.aws_organizations_organization.current.id}\",\n"], [295, "                    \"aws:PrincipalArn\": \"${data.aws_iam_session_context.current.issuer_arn}\"\n"], [296, "                }\n"], [297, "            }\n"], [298, "        },\n"], [299, "        {\n"], [300, "            \"Sid\": \"RecoveryAndTDIRRolePermissions\",\n"], [301, "            \"Effect\": \"Allow\",\n"], [302, "            \"Principal\": {\n"], [303, "                \"AWS\": \"arn:${data.aws_partition.current.partition}:iam::${data.aws_caller_identity.current.id}:root\"\n"], [304, "            },\n"], [305, "            \"Action\": [\n"], [306, "                \"kms:Update*\",\n"], [307, "                \"kms:UntagResource\",\n"], [308, "                \"kms:TagResource\",\n"], [309, "                \"kms:SynchronizeMultiRegionKey\",\n"], [310, "                \"kms:ScheduleKeyDeletion\",\n"], [311, "                \"kms:ReplicateKey\",\n"], [312, "                \"kms:PutKeyPolicy\",\n"], [313, "                \"kms:List*\",\n"], [314, "                \"kms:Get*\",\n"], [315, "                \"kms:Enable*\",\n"], [316, "                \"kms:Disable*\",\n"], [317, "                \"kms:Describe*\",\n"], [318, "                \"kms:DeleteAlias\",\n"], [319, "                \"kms:CreateAlias\",\n"], [320, "                \"kms:CancelKeyDeletion\"\n"], [321, "            ],\n"], [322, "            \"Resource\": \"*\",\n"], [323, "            \"Condition\": {\n"], [324, "                \"StringEquals\": {\n"], [325, "                    \"kms:CallerAccount\": \"${data.aws_caller_identity.current.id}\",\n"], [326, "                    \"aws:PrincipalOrgID\": \"${data.aws_organizations_organization.current.id}\",\n"], [327, "                    \"aws:PrincipalArn\": [\n"], [328, "                        \"arn:${data.aws_partition.current.partition}:iam::${data.aws_caller_identity.current.id}:role/recoveryrole\",\n"], [329, "                        \"arn:${data.aws_partition.current.partition}:iam::${data.aws_caller_identity.current.id}:role/incident-response-role\"\n"], [330, "                    ]\n"], [331, "                }\n"], [332, "            }\n"], [333, "        },\n"], [334, "        {\n"], [335, "            \"Sid\": \"lambdadecryptvariables\",\n"], [336, "            \"Effect\": \"Allow\",\n"], [337, "            \"Principal\": {\n"], [338, "                \"AWS\": \"arn:${data.aws_partition.current.partition}:iam::${data.aws_caller_identity.current.id}:root\"\n"], [339, "            },\n"], [340, "            \"Action\": \"kms:CreateGrant\",\n"], [341, "            \"Resource\": \"*\",\n"], [342, "            \"Condition\": {\n"], [343, "                \"StringEquals\": {\n"], [344, "                    \"kms:EncryptionContext:${data.aws_partition.current.partition}:lambda:FunctionArn\": [\n"], [345, "                        \"arn:${data.aws_partition.current.partition}:lambda:${data.aws_region.current.id}:${data.aws_caller_identity.current.id}:function:tdir-format-eventbridge-input\",\n"], [346, "                        \"arn:${data.aws_partition.current.partition}:lambda:${data.aws_region.current.id}:${data.aws_caller_identity.current.id}:function:tdir-check-snapshots\",\n"], [347, "                        \"arn:${data.aws_partition.current.partition}:lambda:${data.aws_region.current.id}:${data.aws_caller_identity.current.id}:function:tdir-create-streaming-instance\",\n"], [348, "                        \"arn:${data.aws_partition.current.partition}:lambda:${data.aws_region.current.id}:${data.aws_caller_identity.current.id}:function:tdir-check-instance-managed\",\n"], [349, "                        \"arn:${data.aws_partition.current.partition}:lambda:${data.aws_region.current.id}:${data.aws_caller_identity.current.id}:function:tdir-run-command-stream-snapshot-to-s3\",\n"], [350, "                        \"arn:${data.aws_partition.current.partition}:lambda:${data.aws_region.current.id}:${data.aws_caller_identity.current.id}:function:tdir-wait-run-command\",\n"], [351, "                        \"arn:${data.aws_partition.current.partition}:lambda:${data.aws_region.current.id}:${data.aws_caller_identity.current.id}:function:tdir-create-sidecar-volume-instance\",\n"], [352, "                        \"arn:${data.aws_partition.current.partition}:lambda:${data.aws_region.current.id}:${data.aws_caller_identity.current.id}:function:tdir-run-command-stream-sidecar-volume-snapshot-to-ec2\",\n"], [353, "                        \"arn:${data.aws_partition.current.partition}:lambda:${data.aws_region.current.id}:${data.aws_caller_identity.current.id}:function:tdir-prepare-and-attach-volume\",\n"], [354, "                        \"arn:${data.aws_partition.current.partition}:lambda:${data.aws_region.current.id}:${data.aws_caller_identity.current.id}:function:tdir-run-command-stream-memory-capture-to-s3\"\n"], [355, "                    ],\n"], [356, "                    \"kms:GrantConstraintType\": \"EncryptionContextEquals\",\n"], [357, "                    \"kms:ViaService\": \"lambda.${data.aws_region.current.id}.amazonaws.com\"\n"], [358, "                },\n"], [359, "                \"ForAllValues:StringEquals\": {\n"], [360, "                    \"kms:GrantOperations\": [\n"], [361, "                        \"Decrypt\",\n"], [362, "                        \"RetireGrant\"\n"], [363, "                    ]\n"], [364, "                },\n"], [365, "                \"Bool\": {\n"], [366, "                    \"kms:GrantIsForAWSResource\": \"true\"\n"], [367, "                }\n"], [368, "            }\n"], [369, "        },\n"], [370, "        {\n"], [371, "            \"Sid\": \"pipelinevariablemanagement\",\n"], [372, "            \"Effect\": \"Allow\",\n"], [373, "            \"Principal\": {\n"], [374, "                \"AWS\": \"arn:${data.aws_partition.current.partition}:iam::${data.aws_caller_identity.current.id}:root\"\n"], [375, "            },\n"], [376, "            \"Action\": [\n"], [377, "                \"kms:Encrypt\",\n"], [378, "                \"kms:Decrypt\"\n"], [379, "            ],\n"], [380, "            \"Resource\": \"*\",\n"], [381, "            \"Condition\": {\n"], [382, "                \"StringEquals\": {\n"], [383, "                    \"kms:EncryptionContext:${data.aws_partition.current.partition}:lambda:FunctionArn\": [\n"], [384, "                        \"arn:${data.aws_partition.current.partition}:lambda:${data.aws_region.current.id}:${data.aws_caller_identity.current.id}:function:tdir-format-eventbridge-input\",\n"], [385, "                        \"arn:${data.aws_partition.current.partition}:lambda:${data.aws_region.current.id}:${data.aws_caller_identity.current.id}:function:tdir-check-snapshots\",\n"], [386, "                        \"arn:${data.aws_partition.current.partition}:lambda:${data.aws_region.current.id}:${data.aws_caller_identity.current.id}:function:tdir-create-streaming-instance\",\n"], [387, "                        \"arn:${data.aws_partition.current.partition}:lambda:${data.aws_region.current.id}:${data.aws_caller_identity.current.id}:function:tdir-check-instance-managed\",\n"], [388, "                        \"arn:${data.aws_partition.current.partition}:lambda:${data.aws_region.current.id}:${data.aws_caller_identity.current.id}:function:tdir-run-command-stream-snapshot-to-s3\",\n"], [389, "                        \"arn:${data.aws_partition.current.partition}:lambda:${data.aws_region.current.id}:${data.aws_caller_identity.current.id}:function:tdir-wait-run-command\",\n"], [390, "                        \"arn:${data.aws_partition.current.partition}:lambda:${data.aws_region.current.id}:${data.aws_caller_identity.current.id}:function:tdir-create-sidecar-volume-instance\",\n"], [391, "                        \"arn:${data.aws_partition.current.partition}:lambda:${data.aws_region.current.id}:${data.aws_caller_identity.current.id}:function:tdir-run-command-stream-sidecar-volume-snapshot-to-ec2\",\n"], [392, "                        \"arn:${data.aws_partition.current.partition}:lambda:${data.aws_region.current.id}:${data.aws_caller_identity.current.id}:function:tdir-prepare-and-attach-volume\",\n"], [393, "                        \"arn:${data.aws_partition.current.partition}:lambda:${data.aws_region.current.id}:${data.aws_caller_identity.current.id}:function:tdir-run-command-stream-memory-capture-to-s3\"\n"], [394, "                    ],\n"], [395, "                    \"aws:PrincipalArn\": \"arn:${data.aws_partition.current.partition}:iam::${data.aws_caller_identity.current.id}:role/admin\",\n"], [396, "                    \"kms:ViaService\": \"lambda.${data.aws_region.current.id}.amazonaws.com\"\n"], [397, "                }\n"], [398, "            }\n"], [399, "        },\n"], [400, "        {\n"], [401, "            \"Sid\": \"encryption-for-loggroups\",\n"], [402, "            \"Effect\": \"Allow\",\n"], [403, "            \"Principal\": {\n"], [404, "                \"Service\": \"logs.${data.aws_region.current.id}.amazonaws.com\"\n"], [405, "            },\n"], [406, "            \"Action\": [\n"], [407, "                \"kms:ReEncrypt*\",\n"], [408, "                \"kms:GenerateDataKey*\",\n"], [409, "                \"kms:Encrypt*\",\n"], [410, "                \"kms:Describe*\",\n"], [411, "                \"kms:Decrypt*\"\n"], [412, "            ],\n"], [413, "            \"Resource\": \"*\",\n"], [414, "            \"Condition\": {\n"], [415, "                \"StringEquals\": {\n"], [416, "                    \"kms:EncryptionContext:${data.aws_partition.current.partition}:logs:arn\": [\n"], [417, "                        \"arn:${data.aws_partition.current.partition}:logs:${data.aws_region.current.id}:${data.aws_caller_identity.current.id}:log-group:/aws/stepfunction/tdir\",\n"], [418, "                        \"arn:${data.aws_partition.current.partition}:logs:${data.aws_region.current.id}:${data.aws_caller_identity.current.id}:log-group:/aws/lambda/tdir-format-eventbridge\",\n"], [419, "                        \"arn:${data.aws_partition.current.partition}:logs:${data.aws_region.current.id}:${data.aws_caller_identity.current.id}:log-group:/aws/lambda/tdir-format-eventbridge-input\",\n"], [420, "                        \"arn:${data.aws_partition.current.partition}:logs:${data.aws_region.current.id}:${data.aws_caller_identity.current.id}:log-group:/aws/lambda/tdir-check-snapshots\",\n"], [421, "                        \"arn:${data.aws_partition.current.partition}:logs:${data.aws_region.current.id}:${data.aws_caller_identity.current.id}:log-group:/aws/lambda/tdir-create-streaming-instance\",\n"], [422, "                        \"arn:${data.aws_partition.current.partition}:logs:${data.aws_region.current.id}:${data.aws_caller_identity.current.id}:log-group:/aws/lambda/tdir-check-instance-managed\",\n"], [423, "                        \"arn:${data.aws_partition.current.partition}:logs:${data.aws_region.current.id}:${data.aws_caller_identity.current.id}:log-group:/aws/lambda/tdir-run-command-stream-snapshot-to-s3\",\n"], [424, "                        \"arn:${data.aws_partition.current.partition}:logs:${data.aws_region.current.id}:${data.aws_caller_identity.current.id}:log-group:/aws/lambda/tdir-wait-run-command\",\n"], [425, "                        \"arn:${data.aws_partition.current.partition}:logs:${data.aws_region.current.id}:${data.aws_caller_identity.current.id}:log-group:/aws/lambda/tdir-create-sidecar-volume-instance\",\n"], [426, "                        \"arn:${data.aws_partition.current.partition}:logs:${data.aws_region.current.id}:${data.aws_caller_identity.current.id}:log-group:/aws/lambda/tdir-run-command-stream-sidecar-volume-snapshot-to-ec2\",\n"], [427, "                        \"arn:${data.aws_partition.current.partition}:logs:${data.aws_region.current.id}:${data.aws_caller_identity.current.id}:log-group:/aws/lambda/tdir-prepare-and-attach-volume\",\n"], [428, "                        \"arn:${data.aws_partition.current.partition}:logs:${data.aws_region.current.id}:${data.aws_caller_identity.current.id}:log-group:/aws/lambda/tdir-run-command-stream-memory-capture-to-s3\"\n"], [429, "                    ],\n"], [430, "                    \"aws:SourceOrgID\": \"${data.aws_organizations_organization.current.id}\"\n"], [431, "                }\n"], [432, "            }\n"], [433, "        },\n"], [434, "        {\n"], [435, "            \"Sid\": \"ec2runinstances\",\n"], [436, "            \"Effect\": \"Allow\",\n"], [437, "            \"Principal\": {\n"], [438, "                \"AWS\": \"arn:${data.aws_partition.current.partition}:iam::${data.aws_caller_identity.current.id}:root\"\n"], [439, "            },\n"], [440, "            \"Action\": \"kms:GenerateDataKeyWithoutPlaintext\",\n"], [441, "            \"Resource\": \"*\",\n"], [442, "            \"Condition\": {\n"], [443, "                \"StringEquals\": {\n"], [444, "                    \"aws:PrincipalArn\": \"arn:${data.aws_partition.current.partition}:iam::${data.aws_caller_identity.current.id}:role/tdir-lambda\",\n"], [445, "                    \"kms:ViaService\": \"ec2.${data.aws_region.current.id}.amazonaws.com\"\n"], [446, "                }\n"], [447, "            }\n"], [448, "        },\n"], [449, "        {\n"], [450, "            \"Sid\": \"ec2ebsdecrypt\",\n"], [451, "            \"Effect\": \"Allow\",\n"], [452, "            \"Principal\": {\n"], [453, "                \"AWS\": \"arn:${data.aws_partition.current.partition}:iam::${data.aws_caller_identity.current.id}:root\"\n"], [454, "            },\n"], [455, "            \"Action\": \"kms:CreateGrant\",\n"], [456, "            \"Resource\": \"*\",\n"], [457, "            \"Condition\": {\n"], [458, "                \"StringEquals\": {\n"], [459, "                    \"kms:GrantConstraintType\": \"EncryptionContextSubset\",\n"], [460, "                    \"aws:PrincipalArn\": \"arn:${data.aws_partition.current.partition}:iam::${data.aws_caller_identity.current.id}:role/tdir-lambda\",\n"], [461, "                    \"kms:ViaService\": \"ec2.${data.aws_region.current.id}.amazonaws.com\"\n"], [462, "                },\n"], [463, "                \"StringLike\": {\n"], [464, "                    \"kms:EncryptionContext:${data.aws_partition.current.partition}:ebs:id\": \"vol-*\"\n"], [465, "                },\n"], [466, "                \"ForAllValues:StringEquals\": {\n"], [467, "                    \"kms:GrantOperations\": \"Decrypt\"\n"], [468, "                },\n"], [469, "                \"Bool\": {\n"], [470, "                    \"kms:GrantIsForAWSResource\": \"true\"\n"], [471, "                }\n"], [472, "            }\n"], [473, "        },\n"], [474, "        {\n"], [475, "            \"Sid\": \"AllowMacietoDecryptheKey\",\n"], [476, "            \"Effect\": \"Allow\",\n"], [477, "            \"Principal\": {\n"], [478, "                \"AWS\": \"arn:${data.aws_partition.current.partition}:iam::${data.aws_caller_identity.current.id}:root\"\n"], [479, "            },\n"], [480, "            \"Action\": [\n"], [481, "                \"kms:List*\",\n"], [482, "                \"kms:GetKeyRotationStatus\",\n"], [483, "                \"kms:GetKeyPolicy\",\n"], [484, "                \"kms:Describe*\",\n"], [485, "                \"kms:Decrypt\"\n"], [486, "            ],\n"], [487, "            \"Resource\": \"*\",\n"], [488, "            \"Condition\": {\n"], [489, "                \"StringEquals\": {\n"], [490, "                    \"aws:PrincipalArn\": \"arn:${data.aws_partition.current.partition}:iam::${data.aws_caller_identity.current.id}:role/aws-service-role/macie.amazonaws.com/AWSServiceRoleForAmazonMacie\"\n"], [491, "                }\n"], [492, "            }\n"], [493, "        },\n"], [494, "        {\n"], [495, "            \"Sid\": \"s3upload\",\n"], [496, "            \"Effect\": \"Allow\",\n"], [497, "            \"Principal\": {\n"], [498, "                \"AWS\": \"arn:${data.aws_partition.current.partition}:iam::${data.aws_caller_identity.current.id}:root\"\n"], [499, "            },\n"], [500, "            \"Action\": [\n"], [501, "                \"kms:GenerateDataKey\",\n"], [502, "                \"kms:Decrypt\"\n"], [503, "            ],\n"], [504, "            \"Resource\": \"*\",\n"], [505, "            \"Condition\": {\n"], [506, "                \"StringEquals\": {\n"], [507, "                    \"aws:PrincipalArn\": \"arn:${data.aws_partition.current.partition}:iam::${data.aws_caller_identity.current.id}:role/tdir-ec2-collection\",\n"], [508, "                    \"kms:EncryptionContext:${data.aws_partition.current.partition}:s3:arn\": \"arn:${data.aws_partition.current.partition}:s3:::tdir-${data.aws_caller_identity.current.id}-${data.aws_region.current.id}\",\n"], [509, "                    \"kms:ViaService\": \"s3.${data.aws_region.current.id}.amazonaws.com\"\n"], [510, "                }\n"], [511, "            }\n"], [512, "        },\n"], [513, "        {\n"], [514, "            \"Sid\": \"s3download\",\n"], [515, "            \"Effect\": \"Allow\",\n"], [516, "            \"Principal\": {\n"], [517, "                \"AWS\": \"arn:${data.aws_partition.current.partition}:iam::${data.aws_caller_identity.current.id}:root\"\n"], [518, "            },\n"], [519, "            \"Action\": \"kms:Decrypt\",\n"], [520, "            \"Resource\": \"*\",\n"], [521, "            \"Condition\": {\n"], [522, "                \"StringEquals\": {\n"], [523, "                    \"aws:PrincipalArn\": \"arn:${data.aws_partition.current.partition}:iam::${data.aws_caller_identity.current.id}:role/admin\",\n"], [524, "                    \"kms:EncryptionContext:${data.aws_partition.current.partition}:s3:arn\": \"arn:${data.aws_partition.current.partition}:s3:::tdir-${data.aws_caller_identity.current.id}-${data.aws_region.current.id}\",\n"], [525, "                    \"kms:ViaService\": \"s3.${data.aws_region.current.id}.amazonaws.com\"\n"], [526, "                }\n"], [527, "            }\n"], [528, "        },\n"], [529, "        {\n"], [530, "            \"Sid\": \"AllowConfigandAccessAnalyzertoReadKeyAttributes\",\n"], [531, "            \"Effect\": \"Allow\",\n"], [532, "            \"Principal\": {\n"], [533, "                \"AWS\": \"arn:${data.aws_partition.current.partition}:iam::${data.aws_caller_identity.current.id}:root\"\n"], [534, "            },\n"], [535, "            \"Action\": [\n"], [536, "                \"kms:List*\",\n"], [537, "                \"kms:GetKeyRotationStatus\",\n"], [538, "                \"kms:GetKeyPolicy\",\n"], [539, "                \"kms:Describe*\"\n"], [540, "            ],\n"], [541, "            \"Resource\": \"*\",\n"], [542, "            \"Condition\": {\n"], [543, "                \"StringEquals\": {\n"], [544, "                    \"aws:PrincipalArn\": [\n"], [545, "                        \"arn:${data.aws_partition.current.partition}:iam::${data.aws_caller_identity.current.id}:role/aws-service-role/access-analyzer.amazonaws.com/AWSServiceRoleForAccessAnalyzer\",\n"], [546, "                        \"arn:${data.aws_partition.current.partition}:iam::${data.aws_caller_identity.current.id}:role/aws-service-role/config.amazonaws.com/AWSServiceRoleForConfig\"\n"], [547, "                    ]\n"], [548, "                }\n"], [549, "            }\n"], [550, "        },\n"], [551, "        {\n"], [552, "            \"Sid\": \"DenyNonOrganizationalServiceEncryptionUse\",\n"], [553, "            \"Effect\": \"Deny\",\n"], [554, "            \"Principal\": {\n"], [555, "                \"AWS\": \"*\"\n"], [556, "            },\n"], [557, "            \"Action\": \"kms:*\",\n"], [558, "            \"Resource\": \"*\",\n"], [559, "            \"Condition\": {\n"], [560, "                \"StringNotEqualsIfExists\": {\n"], [561, "                    \"aws:SourceOrgID\": \"${data.aws_organizations_organization.current.id}\"\n"], [562, "                },\n"], [563, "                \"Null\": {\n"], [564, "                    \"aws:SourceOrgID\": \"false\"\n"], [565, "                },\n"], [566, "                \"BoolIfExists\": {\n"], [567, "                    \"aws:PrincipalIsAWSService\": \"true\"\n"], [568, "                }\n"], [569, "            }\n"], [570, "        },\n"], [571, "        {\n"], [572, "            \"Sid\": \"PreventNonOrganizationalAccess\",\n"], [573, "            \"Effect\": \"Deny\",\n"], [574, "            \"Principal\": {\n"], [575, "                \"AWS\": \"*\"\n"], [576, "            },\n"], [577, "            \"Action\": \"kms:*\",\n"], [578, "            \"Resource\": \"*\",\n"], [579, "            \"Condition\": {\n"], [580, "                \"StringNotEqualsIfExists\": {\n"], [581, "                    \"aws:PrincipalOrgID\": \"${data.aws_organizations_organization.current.id}\"\n"], [582, "                },\n"], [583, "                \"BoolIfExists\": {\n"], [584, "                    \"aws:PrincipalIsAWSService\": \"false\"\n"], [585, "                }\n"], [586, "            }\n"], [587, "        },\n"], [588, "        {\n"], [589, "            \"Sid\": \"MaxDeletionWindow\",\n"], [590, "            \"Effect\": \"Deny\",\n"], [591, "            \"Principal\": {\n"], [592, "                \"AWS\": \"*\"\n"], [593, "            },\n"], [594, "            \"Action\": \"kms:ScheduleKeyDeletion\",\n"], [595, "            \"Resource\": \"*\",\n"], [596, "            \"Condition\": {\n"], [597, "                \"NumericLessThan\": {\n"], [598, "                    \"kms:ScheduleKeyDeletionPendingWindowInDays\": \"30\"\n"], [599, "                }\n"], [600, "            }\n"], [601, "        },\n"], [602, "        {\n"], [603, "            \"Sid\": \"PreventSafetyLockoutBypass\",\n"], [604, "            \"Effect\": \"Deny\",\n"], [605, "            \"Principal\": {\n"], [606, "                \"AWS\": \"*\"\n"], [607, "            },\n"], [608, "            \"Action\": \"kms:PutKeyPolicy\",\n"], [609, "            \"Resource\": \"*\",\n"], [610, "            \"Condition\": {\n"], [611, "                \"Bool\": {\n"], [612, "                    \"kms:BypassPolicyLockoutSafetyCheck\": \"true\"\n"], [613, "                }\n"], [614, "            }\n"], [615, "        }\n"], [616, "    ]\n"], [617, "}\n"], [618, "EOF\n"], [619, "  enable_key_rotation     = true\n"], [620, "}\n"]], "file_path": "/kms.tf", "file_abs_path": "/github/workspace/kms.tf", "repo_file_path": "/kms.tf", "file_line_range": [251, 620], "resource": "aws_kms_key.fail3", "evaluations": null, "check_class": "checkov.terraform.checks.resource.aws.KMSKeyWildcardPrincipal", "fixed_definition": null, "entity_tags": null, "caller_file_path": null, "caller_file_line_range": null, "resource_address": null, "severity": null, "bc_category": null, "benchmarks": {}, "description": null, "short_description": null, "vulnerability_details": null, "connected_node": null, "guideline": null, "details": [], "check_len": null, "definition_context_file_path": "/github/workspace/kms.tf"}, {"check_id": "CKV_AWS_7", "bc_check_id": null, "check_name": "Ensure rotation for customer created CMKs is enabled", "check_result": {"result": "PASSED", "evaluated_keys": ["enable_key_rotation"]}, "code_block": [[622, "resource \"aws_kms_key\" \"fail4\" {\n"], [623, "  description             = \"fail4\"\n"], [624, "  deletion_window_in_days = 30\n"], [625, "  policy = templatefile(\"${path.module}/templates/kms-fail-4.json\", {\n"], [626, "    \"accountid\"    = \"${data.aws_caller_identity.current.id}\",\n"], [627, "    \"orgid\"        = \"${data.aws_caller_identity.current.id}\",\n"], [628, "    \"partition\"    = \"${data.aws_partition.current.partition}\",\n"], [629, "    \"principalarn\" = \"${data.aws_iam_session_context.current.issuer_arn}\",\n"], [630, "    \"region\"       = \"${data.aws_iam_session_context.current.issuer_arn}\"\n"], [631, "  })\n"], [632, "  enable_key_rotation = true\n"], [633, "}\n"]], "file_path": "/kms.tf", "file_abs_path": "/github/workspace/kms.tf", "repo_file_path": "/kms.tf", "file_line_range": [622, 633], "resource": "aws_kms_key.fail4", "evaluations": null, "check_class": "checkov.terraform.checks.resource.aws.KMSRotation", "fixed_definition": null, "entity_tags": null, "caller_file_path": null, "caller_file_line_range": null, "resource_address": null, "severity": null, "bc_category": null, "benchmarks": {}, "description": null, "short_description": null, "vulnerability_details": null, "connected_node": null, "guideline": null, "details": [], "check_len": null, "definition_context_file_path": "/github/workspace/kms.tf"}, {"check_id": "CKV_AWS_227", "bc_check_id": null, "check_name": "Ensure KMS key is enabled", "check_result": {"result": "PASSED", "evaluated_keys": ["is_enabled"]}, "code_block": [[622, "resource \"aws_kms_key\" \"fail4\" {\n"], [623, "  description             = \"fail4\"\n"], [624, "  deletion_window_in_days = 30\n"], [625, "  policy = templatefile(\"${path.module}/templates/kms-fail-4.json\", {\n"], [626, "    \"accountid\"    = \"${data.aws_caller_identity.current.id}\",\n"], [627, "    \"orgid\"        = \"${data.aws_caller_identity.current.id}\",\n"], [628, "    \"partition\"    = \"${data.aws_partition.current.partition}\",\n"], [629, "    \"principalarn\" = \"${data.aws_iam_session_context.current.issuer_arn}\",\n"], [630, "    \"region\"       = \"${data.aws_iam_session_context.current.issuer_arn}\"\n"], [631, "  })\n"], [632, "  enable_key_rotation = true\n"], [633, "}\n"]], "file_path": "/kms.tf", "file_abs_path": "/github/workspace/kms.tf", "repo_file_path": "/kms.tf", "file_line_range": [622, 633], "resource": "aws_kms_key.fail4", "evaluations": null, "check_class": "checkov.terraform.checks.resource.aws.KMSKeyIsEnabled", "fixed_definition": null, "entity_tags": null, "caller_file_path": null, "caller_file_line_range": null, "resource_address": null, "severity": null, "bc_category": null, "benchmarks": {}, "description": null, "short_description": null, "vulnerability_details": null, "connected_node": null, "guideline": null, "details": [], "check_len": null, "definition_context_file_path": "/github/workspace/kms.tf"}, {"check_id": "CKV_AWS_33", "bc_check_id": null, "check_name": "Ensure KMS key policy does not contain wildcard (*) principal", "check_result": {"result": "PASSED", "evaluated_keys": ["policy"]}, "code_block": [[622, "resource \"aws_kms_key\" \"fail4\" {\n"], [623, "  description             = \"fail4\"\n"], [624, "  deletion_window_in_days = 30\n"], [625, "  policy = templatefile(\"${path.module}/templates/kms-fail-4.json\", {\n"], [626, "    \"accountid\"    = \"${data.aws_caller_identity.current.id}\",\n"], [627, "    \"orgid\"        = \"${data.aws_caller_identity.current.id}\",\n"], [628, "    \"partition\"    = \"${data.aws_partition.current.partition}\",\n"], [629, "    \"principalarn\" = \"${data.aws_iam_session_context.current.issuer_arn}\",\n"], [630, "    \"region\"       = \"${data.aws_iam_session_context.current.issuer_arn}\"\n"], [631, "  })\n"], [632, "  enable_key_rotation = true\n"], [633, "}\n"]], "file_path": "/kms.tf", "file_abs_path": "/github/workspace/kms.tf", "repo_file_path": "/kms.tf", "file_line_range": [622, 633], "resource": "aws_kms_key.fail4", "evaluations": null, "check_class": "checkov.terraform.checks.resource.aws.KMSKeyWildcardPrincipal", "fixed_definition": null, "entity_tags": null, "caller_file_path": null, "caller_file_line_range": null, "resource_address": null, "severity": null, "bc_category": null, "benchmarks": {}, "description": null, "short_description": null, "vulnerability_details": null, "connected_node": null, "guideline": null, "details": [], "check_len": null, "definition_context_file_path": "/github/workspace/kms.tf"}, {"check_id": "CKV_AWS_227", "bc_check_id": null, "check_name": "Ensure KMS key is enabled", "check_result": {"result": "PASSED", "evaluated_keys": ["is_enabled"]}, "code_block": [[635, "resource \"aws_kms_key\" \"fail5\" {\n"], [636, "  description = \"fail5\"\n"], [637, "}\n"]], "file_path": "/kms.tf", "file_abs_path": "/github/workspace/kms.tf", "repo_file_path": "/kms.tf", "file_line_range": [635, 637], "resource": "aws_kms_key.fail5", "evaluations": null, "check_class": "checkov.terraform.checks.resource.aws.KMSKeyIsEnabled", "fixed_definition": null, "entity_tags": null, "caller_file_path": null, "caller_file_line_range": null, "resource_address": null, "severity": null, "bc_category": null, "benchmarks": {}, "description": null, "short_description": null, "vulnerability_details": null, "connected_node": null, "guideline": null, "details": [], "check_len": null, "definition_context_file_path": "/github/workspace/kms.tf"}, {"check_id": "CKV_AWS_33", "bc_check_id": null, "check_name": "Ensure KMS key policy does not contain wildcard (*) principal", "check_result": {"result": "PASSED", "evaluated_keys": []}, "code_block": [[635, "resource \"aws_kms_key\" \"fail5\" {\n"], [636, "  description = \"fail5\"\n"], [637, "}\n"]], "file_path": "/kms.tf", "file_abs_path": "/github/workspace/kms.tf", "repo_file_path": "/kms.tf", "file_line_range": [635, 637], "resource": "aws_kms_key.fail5", "evaluations": null, "check_class": "checkov.terraform.checks.resource.aws.KMSKeyWildcardPrincipal", "fixed_definition": null, "entity_tags": null, "caller_file_path": null, "caller_file_line_range": null, "resource_address": null, "severity": null, "bc_category": null, "benchmarks": {}, "description": null, "short_description": null, "vulnerability_details": null, "connected_node": null, "guideline": null, "details": [], "check_len": null, "definition_context_file_path": "/github/workspace/kms.tf"}, {"check_id": "CKV_AWS_109", "bc_check_id": null, "check_name": "Ensure IAM policies does not allow permissions management / resource exposure without constraints", "check_result": {"result": "PASSED", "evaluated_keys": []}, "code_block": [[1, "data \"aws_iam_policy_document\" \"pass1\" {\n"], [2, "\n"], [3, "  statement {\n"], [4, "    principals {\n"], [5, "      type = \"AWS\"\n"], [6, "      identifiers = [\n"], [7, "        \"*\"\n"], [8, "      ]\n"], [9, "    }\n"], [10, "    effect = \"Allow\"\n"], [11, "    actions = [\n"], [12, "      \"kms:Update*\",\n"], [13, "      \"kms:UntagResource\",\n"], [14, "      \"kms:TagResource\",\n"], [15, "      \"kms:SynchronizeMultiRegionKey\",\n"], [16, "      \"kms:ScheduleKeyDeletion\",\n"], [17, "      \"kms:ReplicateKey\",\n"], [18, "      \"kms:PutKeyPolicy\",\n"], [19, "      \"kms:List*\",\n"], [20, "      \"kms:Get*\",\n"], [21, "      \"kms:Enable*\",\n"], [22, "      \"kms:Disable*\",\n"], [23, "      \"kms:Describe*\",\n"], [24, "      \"kms:DeleteAlias\",\n"], [25, "      \"kms:CreateAlias\",\n"], [26, "      \"kms:CancelKeyDeletion\"\n"], [27, "    ]\n"], [28, "    resources = [\n"], [29, "      \"*\",\n"], [30, "    ]\n"], [31, "    condition {\n"], [32, "      test     = \"StringEquals\"\n"], [33, "      variable = \"aws:PrincipalOrgID\"\n"], [34, "      values   = [\"${data.aws_organizations_organization.current.id}\"]\n"], [35, "    }\n"], [36, "    condition {\n"], [37, "      test     = \"StringEquals\"\n"], [38, "      variable = \"aws:PrincipalArn\"\n"], [39, "      values   = [\"${data.aws_iam_session_context.current.issuer_arn}\"]\n"], [40, "    }\n"], [41, "  }\n"], [42, "}\n"]], "file_path": "/kms.tf", "file_abs_path": "/github/workspace/kms.tf", "repo_file_path": "/kms.tf", "file_line_range": [1, 42], "resource": "aws_iam_policy_document.pass1", "evaluations": null, "check_class": "checkov.terraform.checks.data.aws.IAMPermissionsManagement", "fixed_definition": null, "entity_tags": null, "caller_file_path": null, "caller_file_line_range": null, "resource_address": null, "severity": null, "bc_category": null, "benchmarks": {}, "description": null, "short_description": null, "vulnerability_details": null, "connected_node": null, "guideline": null, "details": [], "check_len": null, "definition_context_file_path": "/github/workspace/kms.tf"}, {"check_id": "CKV_AWS_358", "bc_check_id": null, "check_name": "Ensure GitHub Actions OIDC trust policies only allows actions from a specific known organization", "check_result": {"result": "PASSED", "evaluated_keys": []}, "code_block": [[1, "data \"aws_iam_policy_document\" \"pass1\" {\n"], [2, "\n"], [3, "  statement {\n"], [4, "    principals {\n"], [5, "      type = \"AWS\"\n"], [6, "      identifiers = [\n"], [7, "        \"*\"\n"], [8, "      ]\n"], [9, "    }\n"], [10, "    effect = \"Allow\"\n"], [11, "    actions = [\n"], [12, "      \"kms:Update*\",\n"], [13, "      \"kms:UntagResource\",\n"], [14, "      \"kms:TagResource\",\n"], [15, "      \"kms:SynchronizeMultiRegionKey\",\n"], [16, "      \"kms:ScheduleKeyDeletion\",\n"], [17, "      \"kms:ReplicateKey\",\n"], [18, "      \"kms:PutKeyPolicy\",\n"], [19, "      \"kms:List*\",\n"], [20, "      \"kms:Get*\",\n"], [21, "      \"kms:Enable*\",\n"], [22, "      \"kms:Disable*\",\n"], [23, "      \"kms:Describe*\",\n"], [24, "      \"kms:DeleteAlias\",\n"], [25, "      \"kms:CreateAlias\",\n"], [26, "      \"kms:CancelKeyDeletion\"\n"], [27, "    ]\n"], [28, "    resources = [\n"], [29, "      \"*\",\n"], [30, "    ]\n"], [31, "    condition {\n"], [32, "      test     = \"StringEquals\"\n"], [33, "      variable = \"aws:PrincipalOrgID\"\n"], [34, "      values   = [\"${data.aws_organizations_organization.current.id}\"]\n"], [35, "    }\n"], [36, "    condition {\n"], [37, "      test     = \"StringEquals\"\n"], [38, "      variable = \"aws:PrincipalArn\"\n"], [39, "      values   = [\"${data.aws_iam_session_context.current.issuer_arn}\"]\n"], [40, "    }\n"], [41, "  }\n"], [42, "}\n"]], "file_path": "/kms.tf", "file_abs_path": "/github/workspace/kms.tf", "repo_file_path": "/kms.tf", "file_line_range": [1, 42], "resource": "aws_iam_policy_document.pass1", "evaluations": null, "check_class": "checkov.terraform.checks.data.aws.GithubActionsOIDCTrustPolicy", "fixed_definition": null, "entity_tags": null, "caller_file_path": null, "caller_file_line_range": null, "resource_address": null, "severity": null, "bc_category": null, "benchmarks": {}, "description": null, "short_description": null, "vulnerability_details": null, "connected_node": null, "guideline": null, "details": [], "check_len": null, "definition_context_file_path": "/github/workspace/kms.tf"}, {"check_id": "CKV_AWS_283", "bc_check_id": null, "check_name": "Ensure no IAM policies documents allow ALL or any AWS principal permissions to the resource", "check_result": {"result": "PASSED", "evaluated_keys": []}, "code_block": [[1, "data \"aws_iam_policy_document\" \"pass1\" {\n"], [2, "\n"], [3, "  statement {\n"], [4, "    principals {\n"], [5, "      type = \"AWS\"\n"], [6, "      identifiers = [\n"], [7, "        \"*\"\n"], [8, "      ]\n"], [9, "    }\n"], [10, "    effect = \"Allow\"\n"], [11, "    actions = [\n"], [12, "      \"kms:Update*\",\n"], [13, "      \"kms:UntagResource\",\n"], [14, "      \"kms:TagResource\",\n"], [15, "      \"kms:SynchronizeMultiRegionKey\",\n"], [16, "      \"kms:ScheduleKeyDeletion\",\n"], [17, "      \"kms:ReplicateKey\",\n"], [18, "      \"kms:PutKeyPolicy\",\n"], [19, "      \"kms:List*\",\n"], [20, "      \"kms:Get*\",\n"], [21, "      \"kms:Enable*\",\n"], [22, "      \"kms:Disable*\",\n"], [23, "      \"kms:Describe*\",\n"], [24, "      \"kms:DeleteAlias\",\n"], [25, "      \"kms:CreateAlias\",\n"], [26, "      \"kms:CancelKeyDeletion\"\n"], [27, "    ]\n"], [28, "    resources = [\n"], [29, "      \"*\",\n"], [30, "    ]\n"], [31, "    condition {\n"], [32, "      test     = \"StringEquals\"\n"], [33, "      variable = \"aws:PrincipalOrgID\"\n"], [34, "      values   = [\"${data.aws_organizations_organization.current.id}\"]\n"], [35, "    }\n"], [36, "    condition {\n"], [37, "      test     = \"StringEquals\"\n"], [38, "      variable = \"aws:PrincipalArn\"\n"], [39, "      values   = [\"${data.aws_iam_session_context.current.issuer_arn}\"]\n"], [40, "    }\n"], [41, "  }\n"], [42, "}\n"]], "file_path": "/kms.tf", "file_abs_path": "/github/workspace/kms.tf", "repo_file_path": "/kms.tf", "file_line_range": [1, 42], "resource": "aws_iam_policy_document.pass1", "evaluations": null, "check_class": "checkov.terraform.checks.data.aws.IAMPublicActionsPolicy", "fixed_definition": null, "entity_tags": null, "caller_file_path": null, "caller_file_line_range": null, "resource_address": null, "severity": null, "bc_category": null, "benchmarks": {}, "description": null, "short_description": null, "vulnerability_details": null, "connected_node": null, "guideline": null, "details": [], "check_len": null, "definition_context_file_path": "/github/workspace/kms.tf"}, {"check_id": "CKV_AWS_356", "bc_check_id": null, "check_name": "Ensure no IAM policies documents allow \"*\" as a statement's resource for restrictable actions", "check_result": {"result": "PASSED", "evaluated_keys": []}, "code_block": [[1, "data \"aws_iam_policy_document\" \"pass1\" {\n"], [2, "\n"], [3, "  statement {\n"], [4, "    principals {\n"], [5, "      type = \"AWS\"\n"], [6, "      identifiers = [\n"], [7, "        \"*\"\n"], [8, "      ]\n"], [9, "    }\n"], [10, "    effect = \"Allow\"\n"], [11, "    actions = [\n"], [12, "      \"kms:Update*\",\n"], [13, "      \"kms:UntagResource\",\n"], [14, "      \"kms:TagResource\",\n"], [15, "      \"kms:SynchronizeMultiRegionKey\",\n"], [16, "      \"kms:ScheduleKeyDeletion\",\n"], [17, "      \"kms:ReplicateKey\",\n"], [18, "      \"kms:PutKeyPolicy\",\n"], [19, "      \"kms:List*\",\n"], [20, "      \"kms:Get*\",\n"], [21, "      \"kms:Enable*\",\n"], [22, "      \"kms:Disable*\",\n"], [23, "      \"kms:Describe*\",\n"], [24, "      \"kms:DeleteAlias\",\n"], [25, "      \"kms:CreateAlias\",\n"], [26, "      \"kms:CancelKeyDeletion\"\n"], [27, "    ]\n"], [28, "    resources = [\n"], [29, "      \"*\",\n"], [30, "    ]\n"], [31, "    condition {\n"], [32, "      test     = \"StringEquals\"\n"], [33, "      variable = \"aws:PrincipalOrgID\"\n"], [34, "      values   = [\"${data.aws_organizations_organization.current.id}\"]\n"], [35, "    }\n"], [36, "    condition {\n"], [37, "      test     = \"StringEquals\"\n"], [38, "      variable = \"aws:PrincipalArn\"\n"], [39, "      values   = [\"${data.aws_iam_session_context.current.issuer_arn}\"]\n"], [40, "    }\n"], [41, "  }\n"], [42, "}\n"]], "file_path": "/kms.tf", "file_abs_path": "/github/workspace/kms.tf", "repo_file_path": "/kms.tf", "file_line_range": [1, 42], "resource": "aws_iam_policy_document.pass1", "evaluations": null, "check_class": "checkov.terraform.checks.data.aws.ResourcePolicyDocument", "fixed_definition": null, "entity_tags": null, "caller_file_path": null, "caller_file_line_range": null, "resource_address": null, "severity": null, "bc_category": null, "benchmarks": {}, "description": null, "short_description": null, "vulnerability_details": null, "connected_node": null, "guideline": null, "details": [], "check_len": null, "definition_context_file_path": "/github/workspace/kms.tf"}, {"check_id": "CKV_AWS_1", "bc_check_id": null, "check_name": "Ensure IAM policies that allow full \"*-*\" administrative privileges are not created", "check_result": {"result": "PASSED", "evaluated_keys": []}, "code_block": [[1, "data \"aws_iam_policy_document\" \"pass1\" {\n"], [2, "\n"], [3, "  statement {\n"], [4, "    principals {\n"], [5, "      type = \"AWS\"\n"], [6, "      identifiers = [\n"], [7, "        \"*\"\n"], [8, "      ]\n"], [9, "    }\n"], [10, "    effect = \"Allow\"\n"], [11, "    actions = [\n"], [12, "      \"kms:Update*\",\n"], [13, "      \"kms:UntagResource\",\n"], [14, "      \"kms:TagResource\",\n"], [15, "      \"kms:SynchronizeMultiRegionKey\",\n"], [16, "      \"kms:ScheduleKeyDeletion\",\n"], [17, "      \"kms:ReplicateKey\",\n"], [18, "      \"kms:PutKeyPolicy\",\n"], [19, "      \"kms:List*\",\n"], [20, "      \"kms:Get*\",\n"], [21, "      \"kms:Enable*\",\n"], [22, "      \"kms:Disable*\",\n"], [23, "      \"kms:Describe*\",\n"], [24, "      \"kms:DeleteAlias\",\n"], [25, "      \"kms:CreateAlias\",\n"], [26, "      \"kms:CancelKeyDeletion\"\n"], [27, "    ]\n"], [28, "    resources = [\n"], [29, "      \"*\",\n"], [30, "    ]\n"], [31, "    condition {\n"], [32, "      test     = \"StringEquals\"\n"], [33, "      variable = \"aws:PrincipalOrgID\"\n"], [34, "      values   = [\"${data.aws_organizations_organization.current.id}\"]\n"], [35, "    }\n"], [36, "    condition {\n"], [37, "      test     = \"StringEquals\"\n"], [38, "      variable = \"aws:PrincipalArn\"\n"], [39, "      values   = [\"${data.aws_iam_session_context.current.issuer_arn}\"]\n"], [40, "    }\n"], [41, "  }\n"], [42, "}\n"]], "file_path": "/kms.tf", "file_abs_path": "/github/workspace/kms.tf", "repo_file_path": "/kms.tf", "file_line_range": [1, 42], "resource": "aws_iam_policy_document.pass1", "evaluations": null, "check_class": "checkov.terraform.checks.data.aws.AdminPolicyDocument", "fixed_definition": null, "entity_tags": null, "caller_file_path": null, "caller_file_line_range": null, "resource_address": null, "severity": null, "bc_category": null, "benchmarks": {}, "description": null, "short_description": null, "vulnerability_details": null, "connected_node": null, "guideline": null, "details": [], "check_len": null, "definition_context_file_path": "/github/workspace/kms.tf"}, {"check_id": "CKV_AWS_108", "bc_check_id": null, "check_name": "Ensure IAM policies does not allow data exfiltration", "check_result": {"result": "PASSED", "evaluated_keys": []}, "code_block": [[1, "data \"aws_iam_policy_document\" \"pass1\" {\n"], [2, "\n"], [3, "  statement {\n"], [4, "    principals {\n"], [5, "      type = \"AWS\"\n"], [6, "      identifiers = [\n"], [7, "        \"*\"\n"], [8, "      ]\n"], [9, "    }\n"], [10, "    effect = \"Allow\"\n"], [11, "    actions = [\n"], [12, "      \"kms:Update*\",\n"], [13, "      \"kms:UntagResource\",\n"], [14, "      \"kms:TagResource\",\n"], [15, "      \"kms:SynchronizeMultiRegionKey\",\n"], [16, "      \"kms:ScheduleKeyDeletion\",\n"], [17, "      \"kms:ReplicateKey\",\n"], [18, "      \"kms:PutKeyPolicy\",\n"], [19, "      \"kms:List*\",\n"], [20, "      \"kms:Get*\",\n"], [21, "      \"kms:Enable*\",\n"], [22, "      \"kms:Disable*\",\n"], [23, "      \"kms:Describe*\",\n"], [24, "      \"kms:DeleteAlias\",\n"], [25, "      \"kms:CreateAlias\",\n"], [26, "      \"kms:CancelKeyDeletion\"\n"], [27, "    ]\n"], [28, "    resources = [\n"], [29, "      \"*\",\n"], [30, "    ]\n"], [31, "    condition {\n"], [32, "      test     = \"StringEquals\"\n"], [33, "      variable = \"aws:PrincipalOrgID\"\n"], [34, "      values   = [\"${data.aws_organizations_organization.current.id}\"]\n"], [35, "    }\n"], [36, "    condition {\n"], [37, "      test     = \"StringEquals\"\n"], [38, "      variable = \"aws:PrincipalArn\"\n"], [39, "      values   = [\"${data.aws_iam_session_context.current.issuer_arn}\"]\n"], [40, "    }\n"], [41, "  }\n"], [42, "}\n"]], "file_path": "/kms.tf", "file_abs_path": "/github/workspace/kms.tf", "repo_file_path": "/kms.tf", "file_line_range": [1, 42], "resource": "aws_iam_policy_document.pass1", "evaluations": null, "check_class": "checkov.terraform.checks.data.aws.IAMDataExfiltration", "fixed_definition": null, "entity_tags": null, "caller_file_path": null, "caller_file_line_range": null, "resource_address": null, "severity": null, "bc_category": null, "benchmarks": {}, "description": null, "short_description": null, "vulnerability_details": null, "connected_node": null, "guideline": null, "details": [], "check_len": null, "definition_context_file_path": "/github/workspace/kms.tf"}, {"check_id": "CKV_AWS_111", "bc_check_id": null, "check_name": "Ensure IAM policies does not allow write access without constraints", "check_result": {"result": "PASSED", "evaluated_keys": []}, "code_block": [[1, "data \"aws_iam_policy_document\" \"pass1\" {\n"], [2, "\n"], [3, "  statement {\n"], [4, "    principals {\n"], [5, "      type = \"AWS\"\n"], [6, "      identifiers = [\n"], [7, "        \"*\"\n"], [8, "      ]\n"], [9, "    }\n"], [10, "    effect = \"Allow\"\n"], [11, "    actions = [\n"], [12, "      \"kms:Update*\",\n"], [13, "      \"kms:UntagResource\",\n"], [14, "      \"kms:TagResource\",\n"], [15, "      \"kms:SynchronizeMultiRegionKey\",\n"], [16, "      \"kms:ScheduleKeyDeletion\",\n"], [17, "      \"kms:ReplicateKey\",\n"], [18, "      \"kms:PutKeyPolicy\",\n"], [19, "      \"kms:List*\",\n"], [20, "      \"kms:Get*\",\n"], [21, "      \"kms:Enable*\",\n"], [22, "      \"kms:Disable*\",\n"], [23, "      \"kms:Describe*\",\n"], [24, "      \"kms:DeleteAlias\",\n"], [25, "      \"kms:CreateAlias\",\n"], [26, "      \"kms:CancelKeyDeletion\"\n"], [27, "    ]\n"], [28, "    resources = [\n"], [29, "      \"*\",\n"], [30, "    ]\n"], [31, "    condition {\n"], [32, "      test     = \"StringEquals\"\n"], [33, "      variable = \"aws:PrincipalOrgID\"\n"], [34, "      values   = [\"${data.aws_organizations_organization.current.id}\"]\n"], [35, "    }\n"], [36, "    condition {\n"], [37, "      test     = \"StringEquals\"\n"], [38, "      variable = \"aws:PrincipalArn\"\n"], [39, "      values   = [\"${data.aws_iam_session_context.current.issuer_arn}\"]\n"], [40, "    }\n"], [41, "  }\n"], [42, "}\n"]], "file_path": "/kms.tf", "file_abs_path": "/github/workspace/kms.tf", "repo_file_path": "/kms.tf", "file_line_range": [1, 42], "resource": "aws_iam_policy_document.pass1", "evaluations": null, "check_class": "checkov.terraform.checks.data.aws.IAMWriteAccess", "fixed_definition": null, "entity_tags": null, "caller_file_path": null, "caller_file_line_range": null, "resource_address": null, "severity": null, "bc_category": null, "benchmarks": {}, "description": null, "short_description": null, "vulnerability_details": null, "connected_node": null, "guideline": null, "details": [], "check_len": null, "definition_context_file_path": "/github/workspace/kms.tf"}, {"check_id": "CKV_AWS_110", "bc_check_id": null, "check_name": "Ensure IAM policies does not allow privilege escalation", "check_result": {"result": "PASSED", "evaluated_keys": []}, "code_block": [[1, "data \"aws_iam_policy_document\" \"pass1\" {\n"], [2, "\n"], [3, "  statement {\n"], [4, "    principals {\n"], [5, "      type = \"AWS\"\n"], [6, "      identifiers = [\n"], [7, "        \"*\"\n"], [8, "      ]\n"], [9, "    }\n"], [10, "    effect = \"Allow\"\n"], [11, "    actions = [\n"], [12, "      \"kms:Update*\",\n"], [13, "      \"kms:UntagResource\",\n"], [14, "      \"kms:TagResource\",\n"], [15, "      \"kms:SynchronizeMultiRegionKey\",\n"], [16, "      \"kms:ScheduleKeyDeletion\",\n"], [17, "      \"kms:ReplicateKey\",\n"], [18, "      \"kms:PutKeyPolicy\",\n"], [19, "      \"kms:List*\",\n"], [20, "      \"kms:Get*\",\n"], [21, "      \"kms:Enable*\",\n"], [22, "      \"kms:Disable*\",\n"], [23, "      \"kms:Describe*\",\n"], [24, "      \"kms:DeleteAlias\",\n"], [25, "      \"kms:CreateAlias\",\n"], [26, "      \"kms:CancelKeyDeletion\"\n"], [27, "    ]\n"], [28, "    resources = [\n"], [29, "      \"*\",\n"], [30, "    ]\n"], [31, "    condition {\n"], [32, "      test     = \"StringEquals\"\n"], [33, "      variable = \"aws:PrincipalOrgID\"\n"], [34, "      values   = [\"${data.aws_organizations_organization.current.id}\"]\n"], [35, "    }\n"], [36, "    condition {\n"], [37, "      test     = \"StringEquals\"\n"], [38, "      variable = \"aws:PrincipalArn\"\n"], [39, "      values   = [\"${data.aws_iam_session_context.current.issuer_arn}\"]\n"], [40, "    }\n"], [41, "  }\n"], [42, "}\n"]], "file_path": "/kms.tf", "file_abs_path": "/github/workspace/kms.tf", "repo_file_path": "/kms.tf", "file_line_range": [1, 42], "resource": "aws_iam_policy_document.pass1", "evaluations": null, "check_class": "checkov.terraform.checks.data.aws.IAMPrivilegeEscalation", "fixed_definition": null, "entity_tags": null, "caller_file_path": null, "caller_file_line_range": null, "resource_address": null, "severity": null, "bc_category": null, "benchmarks": {}, "description": null, "short_description": null, "vulnerability_details": null, "connected_node": null, "guideline": null, "details": [], "check_len": null, "definition_context_file_path": "/github/workspace/kms.tf"}, {"check_id": "CKV_AWS_49", "bc_check_id": null, "check_name": "Ensure no IAM policies documents allow \"*\" as a statement's actions", "check_result": {"result": "PASSED", "evaluated_keys": []}, "code_block": [[1, "data \"aws_iam_policy_document\" \"pass1\" {\n"], [2, "\n"], [3, "  statement {\n"], [4, "    principals {\n"], [5, "      type = \"AWS\"\n"], [6, "      identifiers = [\n"], [7, "        \"*\"\n"], [8, "      ]\n"], [9, "    }\n"], [10, "    effect = \"Allow\"\n"], [11, "    actions = [\n"], [12, "      \"kms:Update*\",\n"], [13, "      \"kms:UntagResource\",\n"], [14, "      \"kms:TagResource\",\n"], [15, "      \"kms:SynchronizeMultiRegionKey\",\n"], [16, "      \"kms:ScheduleKeyDeletion\",\n"], [17, "      \"kms:ReplicateKey\",\n"], [18, "      \"kms:PutKeyPolicy\",\n"], [19, "      \"kms:List*\",\n"], [20, "      \"kms:Get*\",\n"], [21, "      \"kms:Enable*\",\n"], [22, "      \"kms:Disable*\",\n"], [23, "      \"kms:Describe*\",\n"], [24, "      \"kms:DeleteAlias\",\n"], [25, "      \"kms:CreateAlias\",\n"], [26, "      \"kms:CancelKeyDeletion\"\n"], [27, "    ]\n"], [28, "    resources = [\n"], [29, "      \"*\",\n"], [30, "    ]\n"], [31, "    condition {\n"], [32, "      test     = \"StringEquals\"\n"], [33, "      variable = \"aws:PrincipalOrgID\"\n"], [34, "      values   = [\"${data.aws_organizations_organization.current.id}\"]\n"], [35, "    }\n"], [36, "    condition {\n"], [37, "      test     = \"StringEquals\"\n"], [38, "      variable = \"aws:PrincipalArn\"\n"], [39, "      values   = [\"${data.aws_iam_session_context.current.issuer_arn}\"]\n"], [40, "    }\n"], [41, "  }\n"], [42, "}\n"]], "file_path": "/kms.tf", "file_abs_path": "/github/workspace/kms.tf", "repo_file_path": "/kms.tf", "file_line_range": [1, 42], "resource": "aws_iam_policy_document.pass1", "evaluations": null, "check_class": "checkov.terraform.checks.data.aws.StarActionPolicyDocument", "fixed_definition": null, "entity_tags": null, "caller_file_path": null, "caller_file_line_range": null, "resource_address": null, "severity": null, "bc_category": null, "benchmarks": {}, "description": null, "short_description": null, "vulnerability_details": null, "connected_node": null, "guideline": null, "details": [], "check_len": null, "definition_context_file_path": "/github/workspace/kms.tf"}, {"check_id": "CKV_AWS_107", "bc_check_id": null, "check_name": "Ensure IAM policies does not allow credentials exposure", "check_result": {"result": "PASSED", "evaluated_keys": []}, "code_block": [[1, "data \"aws_iam_policy_document\" \"pass1\" {\n"], [2, "\n"], [3, "  statement {\n"], [4, "    principals {\n"], [5, "      type = \"AWS\"\n"], [6, "      identifiers = [\n"], [7, "        \"*\"\n"], [8, "      ]\n"], [9, "    }\n"], [10, "    effect = \"Allow\"\n"], [11, "    actions = [\n"], [12, "      \"kms:Update*\",\n"], [13, "      \"kms:UntagResource\",\n"], [14, "      \"kms:TagResource\",\n"], [15, "      \"kms:SynchronizeMultiRegionKey\",\n"], [16, "      \"kms:ScheduleKeyDeletion\",\n"], [17, "      \"kms:ReplicateKey\",\n"], [18, "      \"kms:PutKeyPolicy\",\n"], [19, "      \"kms:List*\",\n"], [20, "      \"kms:Get*\",\n"], [21, "      \"kms:Enable*\",\n"], [22, "      \"kms:Disable*\",\n"], [23, "      \"kms:Describe*\",\n"], [24, "      \"kms:DeleteAlias\",\n"], [25, "      \"kms:CreateAlias\",\n"], [26, "      \"kms:CancelKeyDeletion\"\n"], [27, "    ]\n"], [28, "    resources = [\n"], [29, "      \"*\",\n"], [30, "    ]\n"], [31, "    condition {\n"], [32, "      test     = \"StringEquals\"\n"], [33, "      variable = \"aws:PrincipalOrgID\"\n"], [34, "      values   = [\"${data.aws_organizations_organization.current.id}\"]\n"], [35, "    }\n"], [36, "    condition {\n"], [37, "      test     = \"StringEquals\"\n"], [38, "      variable = \"aws:PrincipalArn\"\n"], [39, "      values   = [\"${data.aws_iam_session_context.current.issuer_arn}\"]\n"], [40, "    }\n"], [41, "  }\n"], [42, "}\n"]], "file_path": "/kms.tf", "file_abs_path": "/github/workspace/kms.tf", "repo_file_path": "/kms.tf", "file_line_range": [1, 42], "resource": "aws_iam_policy_document.pass1", "evaluations": null, "check_class": "checkov.terraform.checks.data.aws.IAMCredentialsExposure", "fixed_definition": null, "entity_tags": null, "caller_file_path": null, "caller_file_line_range": null, "resource_address": null, "severity": null, "bc_category": null, "benchmarks": {}, "description": null, "short_description": null, "vulnerability_details": null, "connected_node": null, "guideline": null, "details": [], "check_len": null, "definition_context_file_path": "/github/workspace/kms.tf"}, {"check_id": "CKV_AWS_358", "bc_check_id": null, "check_name": "Ensure GitHub Actions OIDC trust policies only allows actions from a specific known organization", "check_result": {"result": "PASSED", "evaluated_keys": []}, "code_block": [[135, "data \"aws_iam_policy_document\" \"fail1\" {\n"], [136, "\n"], [137, "  statement {\n"], [138, "    principals {\n"], [139, "      type = \"AWS\"\n"], [140, "      identifiers = [\n"], [141, "        \"*\"\n"], [142, "      ]\n"], [143, "    }\n"], [144, "    effect = \"Allow\"\n"], [145, "    actions = [\n"], [146, "      \"kms:*\"\n"], [147, "    ]\n"], [148, "    resources = [\n"], [149, "      \"*\",\n"], [150, "    ]\n"], [151, "  }\n"], [152, "\n"], [153, "}\n"]], "file_path": "/kms.tf", "file_abs_path": "/github/workspace/kms.tf", "repo_file_path": "/kms.tf", "file_line_range": [135, 153], "resource": "aws_iam_policy_document.fail1", "evaluations": null, "check_class": "checkov.terraform.checks.data.aws.GithubActionsOIDCTrustPolicy", "fixed_definition": null, "entity_tags": null, "caller_file_path": null, "caller_file_line_range": null, "resource_address": null, "severity": null, "bc_category": null, "benchmarks": {}, "description": null, "short_description": null, "vulnerability_details": null, "connected_node": null, "guideline": null, "details": [], "check_len": null, "definition_context_file_path": "/github/workspace/kms.tf"}, {"check_id": "CKV_AWS_1", "bc_check_id": null, "check_name": "Ensure IAM policies that allow full \"*-*\" administrative privileges are not created", "check_result": {"result": "PASSED", "evaluated_keys": []}, "code_block": [[135, "data \"aws_iam_policy_document\" \"fail1\" {\n"], [136, "\n"], [137, "  statement {\n"], [138, "    principals {\n"], [139, "      type = \"AWS\"\n"], [140, "      identifiers = [\n"], [141, "        \"*\"\n"], [142, "      ]\n"], [143, "    }\n"], [144, "    effect = \"Allow\"\n"], [145, "    actions = [\n"], [146, "      \"kms:*\"\n"], [147, "    ]\n"], [148, "    resources = [\n"], [149, "      \"*\",\n"], [150, "    ]\n"], [151, "  }\n"], [152, "\n"], [153, "}\n"]], "file_path": "/kms.tf", "file_abs_path": "/github/workspace/kms.tf", "repo_file_path": "/kms.tf", "file_line_range": [135, 153], "resource": "aws_iam_policy_document.fail1", "evaluations": null, "check_class": "checkov.terraform.checks.data.aws.AdminPolicyDocument", "fixed_definition": null, "entity_tags": null, "caller_file_path": null, "caller_file_line_range": null, "resource_address": null, "severity": null, "bc_category": null, "benchmarks": {}, "description": null, "short_description": null, "vulnerability_details": null, "connected_node": null, "guideline": null, "details": [], "check_len": null, "definition_context_file_path": "/github/workspace/kms.tf"}, {"check_id": "CKV_AWS_108", "bc_check_id": null, "check_name": "Ensure IAM policies does not allow data exfiltration", "check_result": {"result": "PASSED", "evaluated_keys": []}, "code_block": [[135, "data \"aws_iam_policy_document\" \"fail1\" {\n"], [136, "\n"], [137, "  statement {\n"], [138, "    principals {\n"], [139, "      type = \"AWS\"\n"], [140, "      identifiers = [\n"], [141, "        \"*\"\n"], [142, "      ]\n"], [143, "    }\n"], [144, "    effect = \"Allow\"\n"], [145, "    actions = [\n"], [146, "      \"kms:*\"\n"], [147, "    ]\n"], [148, "    resources = [\n"], [149, "      \"*\",\n"], [150, "    ]\n"], [151, "  }\n"], [152, "\n"], [153, "}\n"]], "file_path": "/kms.tf", "file_abs_path": "/github/workspace/kms.tf", "repo_file_path": "/kms.tf", "file_line_range": [135, 153], "resource": "aws_iam_policy_document.fail1", "evaluations": null, "check_class": "checkov.terraform.checks.data.aws.IAMDataExfiltration", "fixed_definition": null, "entity_tags": null, "caller_file_path": null, "caller_file_line_range": null, "resource_address": null, "severity": null, "bc_category": null, "benchmarks": {}, "description": null, "short_description": null, "vulnerability_details": null, "connected_node": null, "guideline": null, "details": [], "check_len": null, "definition_context_file_path": "/github/workspace/kms.tf"}, {"check_id": "CKV_AWS_110", "bc_check_id": null, "check_name": "Ensure IAM policies does not allow privilege escalation", "check_result": {"result": "PASSED", "evaluated_keys": []}, "code_block": [[135, "data \"aws_iam_policy_document\" \"fail1\" {\n"], [136, "\n"], [137, "  statement {\n"], [138, "    principals {\n"], [139, "      type = \"AWS\"\n"], [140, "      identifiers = [\n"], [141, "        \"*\"\n"], [142, "      ]\n"], [143, "    }\n"], [144, "    effect = \"Allow\"\n"], [145, "    actions = [\n"], [146, "      \"kms:*\"\n"], [147, "    ]\n"], [148, "    resources = [\n"], [149, "      \"*\",\n"], [150, "    ]\n"], [151, "  }\n"], [152, "\n"], [153, "}\n"]], "file_path": "/kms.tf", "file_abs_path": "/github/workspace/kms.tf", "repo_file_path": "/kms.tf", "file_line_range": [135, 153], "resource": "aws_iam_policy_document.fail1", "evaluations": null, "check_class": "checkov.terraform.checks.data.aws.IAMPrivilegeEscalation", "fixed_definition": null, "entity_tags": null, "caller_file_path": null, "caller_file_line_range": null, "resource_address": null, "severity": null, "bc_category": null, "benchmarks": {}, "description": null, "short_description": null, "vulnerability_details": null, "connected_node": null, "guideline": null, "details": [], "check_len": null, "definition_context_file_path": "/github/workspace/kms.tf"}, {"check_id": "CKV_AWS_49", "bc_check_id": null, "check_name": "Ensure no IAM policies documents allow \"*\" as a statement's actions", "check_result": {"result": "PASSED", "evaluated_keys": []}, "code_block": [[135, "data \"aws_iam_policy_document\" \"fail1\" {\n"], [136, "\n"], [137, "  statement {\n"], [138, "    principals {\n"], [139, "      type = \"AWS\"\n"], [140, "      identifiers = [\n"], [141, "        \"*\"\n"], [142, "      ]\n"], [143, "    }\n"], [144, "    effect = \"Allow\"\n"], [145, "    actions = [\n"], [146, "      \"kms:*\"\n"], [147, "    ]\n"], [148, "    resources = [\n"], [149, "      \"*\",\n"], [150, "    ]\n"], [151, "  }\n"], [152, "\n"], [153, "}\n"]], "file_path": "/kms.tf", "file_abs_path": "/github/workspace/kms.tf", "repo_file_path": "/kms.tf", "file_line_range": [135, 153], "resource": "aws_iam_policy_document.fail1", "evaluations": null, "check_class": "checkov.terraform.checks.data.aws.StarActionPolicyDocument", "fixed_definition": null, "entity_tags": null, "caller_file_path": null, "caller_file_line_range": null, "resource_address": null, "severity": null, "bc_category": null, "benchmarks": {}, "description": null, "short_description": null, "vulnerability_details": null, "connected_node": null, "guideline": null, "details": [], "check_len": null, "definition_context_file_path": "/github/workspace/kms.tf"}, {"check_id": "CKV_AWS_107", "bc_check_id": null, "check_name": "Ensure IAM policies does not allow credentials exposure", "check_result": {"result": "PASSED", "evaluated_keys": []}, "code_block": [[135, "data \"aws_iam_policy_document\" \"fail1\" {\n"], [136, "\n"], [137, "  statement {\n"], [138, "    principals {\n"], [139, "      type = \"AWS\"\n"], [140, "      identifiers = [\n"], [141, "        \"*\"\n"], [142, "      ]\n"], [143, "    }\n"], [144, "    effect = \"Allow\"\n"], [145, "    actions = [\n"], [146, "      \"kms:*\"\n"], [147, "    ]\n"], [148, "    resources = [\n"], [149, "      \"*\",\n"], [150, "    ]\n"], [151, "  }\n"], [152, "\n"], [153, "}\n"]], "file_path": "/kms.tf", "file_abs_path": "/github/workspace/kms.tf", "repo_file_path": "/kms.tf", "file_line_range": [135, 153], "resource": "aws_iam_policy_document.fail1", "evaluations": null, "check_class": "checkov.terraform.checks.data.aws.IAMCredentialsExposure", "fixed_definition": null, "entity_tags": null, "caller_file_path": null, "caller_file_line_range": null, "resource_address": null, "severity": null, "bc_category": null, "benchmarks": {}, "description": null, "short_description": null, "vulnerability_details": null, "connected_node": null, "guideline": null, "details": [], "check_len": null, "definition_context_file_path": "/github/workspace/kms.tf"}, {"check_id": "CKV_AWS_41", "bc_check_id": null, "check_name": "Ensure no hard coded AWS access key and secret key exists in provider", "check_result": {"result": "PASSED", "evaluated_keys": []}, "code_block": [[1, "provider \"aws\" {\n"], [2, "  region = \"us-east-1\"\n"], [3, "}"]], "file_path": "/main.tf", "file_abs_path": "/github/workspace/main.tf", "repo_file_path": "/main.tf", "file_line_range": [1, 3], "resource": "aws.default", "evaluations": null, "check_class": "checkov.terraform.checks.provider.aws.credentials", "fixed_definition": null, "entity_tags": null, "caller_file_path": null, "caller_file_line_range": null, "resource_address": null, "severity": null, "bc_category": null, "benchmarks": {}, "description": null, "short_description": null, "vulnerability_details": null, "connected_node": null, "guideline": null, "details": [], "check_len": null, "definition_context_file_path": "/github/workspace/main.tf"}, {"check_id": "CKV2_AWS_64", "bc_check_id": null, "check_name": "Ensure KMS key Policy is defined", "check_result": {"result": "PASSED", "entity": {"aws_kms_key": {"pass1": {"__end_line__": 53, "__start_line__": 44, "bypass_policy_lockout_safety_check": [false], "customer_master_key_spec": ["SYMMETRIC_DEFAULT"], "deletion_window_in_days": [7], "description": ["pass1"], "enable_key_rotation": [true], "is_enabled": [true], "key_usage": ["ENCRYPT_DECRYPT"], "policy": ["data.aws_iam_policy_document.pass1.json"], "__address__": "aws_kms_key.pass1"}}}, "evaluated_keys": ["policy", "resource_type"]}, "code_block": [[44, "resource \"aws_kms_key\" \"pass1\" {\n"], [45, "  description                        = \"pass1\"\n"], [46, "  deletion_window_in_days            = 7\n"], [47, "  key_usage                          = \"ENCRYPT_DECRYPT\"\n"], [48, "  customer_master_key_spec           = \"SYMMETRIC_DEFAULT\"\n"], [49, "  policy                             = data.aws_iam_policy_document.pass1.json\n"], [50, "  bypass_policy_lockout_safety_check = false\n"], [51, "  is_enabled                         = true\n"], [52, "  enable_key_rotation                = true\n"], [53, "}\n"]], "file_path": "/kms.tf", "file_abs_path": "/github/workspace/kms.tf", "repo_file_path": "/kms.tf", "file_line_range": [44, 53], "resource": "aws_kms_key.pass1", "evaluations": null, "check_class": "checkov.common.graph.checks_infra.base_check", "fixed_definition": null, "entity_tags": {}, "caller_file_path": null, "caller_file_line_range": null, "resource_address": null, "severity": null, "bc_category": null, "benchmarks": {}, "description": null, "short_description": null, "vulnerability_details": null, "connected_node": null, "guideline": null, "details": [], "check_len": null, "definition_context_file_path": "/github/workspace/kms.tf"}, {"check_id": "CKV2_AWS_64", "bc_check_id": null, "check_name": "Ensure KMS key Policy is defined", "check_result": {"result": "PASSED", "entity": {"aws_kms_key": {"pass3": {"__end_line__": 133, "__start_line__": 85, "bypass_policy_lockout_safety_check": [false], "customer_master_key_spec": ["SYMMETRIC_DEFAULT"], "deletion_window_in_days": [7], "description": ["pass3"], "enable_key_rotation": [true], "is_enabled": [false], "key_usage": ["ENCRYPT_DECRYPT"], "policy": [{"Version": "2012-10-17", "Statement": [{"Sid": "pass3", "Effect": "Allow", "Principal": {"AWS": "*"}, "Action": ["kms:Update*", "kms:UntagResource", "kms:TagResource", "kms:SynchronizeMultiRegionKey", "kms:ScheduleKeyDeletion", "kms:ReplicateKey", "kms:PutKeyPolicy", "kms:List*", "kms:Get*", "kms:Enable*", "kms:Disable*", "kms:Describe*", "kms:DeleteAlias", "kms:CreateAlias", "kms:CancelKeyDeletion"], "Resource": "*", "Condition": {"StringEquals": {"aws:PrincipalArn": ["${data.aws_iam_session_context.current.issuer_arn}"]}}}]}], "__address__": "aws_kms_key.pass3"}}}, "evaluated_keys": ["policy", "resource_type"]}, "code_block": [[85, "resource \"aws_kms_key\" \"pass3\" {\n"], [86, "  description                        = \"pass3\"\n"], [87, "  deletion_window_in_days            = 7\n"], [88, "  key_usage                          = \"ENCRYPT_DECRYPT\"\n"], [89, "  customer_master_key_spec           = \"SYMMETRIC_DEFAULT\"\n"], [90, "  policy                             = <<POLICY\n"], [91, "{\n"], [92, "    \"Version\": \"2012-10-17\",\n"], [93, "    \"Statement\": [\n"], [94, "        {\n"], [95, "            \"Sid\": \"pass3\",\n"], [96, "            \"Effect\": \"Allow\",\n"], [97, "            \"Principal\": {\n"], [98, "                \"AWS\": \"*\"\n"], [99, "            },\n"], [100, "            \"Action\": [\n"], [101, "              \"kms:Update*\",\n"], [102, "              \"kms:UntagResource\",\n"], [103, "              \"kms:TagResource\",\n"], [104, "              \"kms:SynchronizeMultiRegionKey\",\n"], [105, "              \"kms:ScheduleKeyDeletion\",\n"], [106, "              \"kms:ReplicateKey\",\n"], [107, "              \"kms:PutKeyPolicy\",\n"], [108, "              \"kms:List*\",\n"], [109, "              \"kms:Get*\",\n"], [110, "              \"kms:Enable*\",\n"], [111, "              \"kms:Disable*\",\n"], [112, "              \"kms:Describe*\",\n"], [113, "              \"kms:DeleteAlias\",\n"], [114, "              \"kms:CreateAlias\",\n"], [115, "              \"kms:CancelKeyDeletion\"\n"], [116, "            ],\n"], [117, "            \"Resource\": \"*\",\n"], [118, "            \"Condition\": {\n"], [119, "                \"StringEquals\": {\n"], [120, "                    \"aws:PrincipalArn\": [\n"], [121, "                        \"${data.aws_iam_session_context.current.issuer_arn}\"\n"], [122, "                    ]\n"], [123, "                }\n"], [124, "            }\n"], [125, "        }\n"], [126, "    ]\n"], [127, "}\n"], [128, "POLICY\n"], [129, "  bypass_policy_lockout_safety_check = false\n"], [130, "  is_enabled                         = false\n"], [131, "  enable_key_rotation                = true\n"], [132, "\n"], [133, "}\n"]], "file_path": "/kms.tf", "file_abs_path": "/github/workspace/kms.tf", "repo_file_path": "/kms.tf", "file_line_range": [85, 133], "resource": "aws_kms_key.pass3", "evaluations": null, "check_class": "checkov.common.graph.checks_infra.base_check", "fixed_definition": null, "entity_tags": {}, "caller_file_path": null, "caller_file_line_range": null, "resource_address": null, "severity": null, "bc_category": null, "benchmarks": {}, "description": null, "short_description": null, "vulnerability_details": null, "connected_node": null, "guideline": null, "details": [], "check_len": null, "definition_context_file_path": "/github/workspace/kms.tf"}, {"check_id": "CKV2_AWS_64", "bc_check_id": null, "check_name": "Ensure KMS key Policy is defined", "check_result": {"result": "PASSED", "entity": {"aws_kms_key": {"fail1": {"__end_line__": 164, "__start_line__": 155, "bypass_policy_lockout_safety_check": [false], "customer_master_key_spec": ["SYMMETRIC_DEFAULT"], "deletion_window_in_days": [7], "description": ["fail1"], "enable_key_rotation": [true], "is_enabled": [true], "key_usage": ["ENCRYPT_DECRYPT"], "policy": ["data.aws_iam_policy_document.fail1.json"], "__address__": "aws_kms_key.fail1"}}}, "evaluated_keys": ["policy", "resource_type"]}, "code_block": [[155, "resource \"aws_kms_key\" \"fail1\" {\n"], [156, "  description                        = \"fail1\"\n"], [157, "  deletion_window_in_days            = 7\n"], [158, "  key_usage                          = \"ENCRYPT_DECRYPT\"\n"], [159, "  customer_master_key_spec           = \"SYMMETRIC_DEFAULT\"\n"], [160, "  policy                             = data.aws_iam_policy_document.fail1.json\n"], [161, "  bypass_policy_lockout_safety_check = false\n"], [162, "  is_enabled                         = true\n"], [163, "  enable_key_rotation                = true\n"], [164, "}\n"]], "file_path": "/kms.tf", "file_abs_path": "/github/workspace/kms.tf", "repo_file_path": "/kms.tf", "file_line_range": [155, 164], "resource": "aws_kms_key.fail1", "evaluations": null, "check_class": "checkov.common.graph.checks_infra.base_check", "fixed_definition": null, "entity_tags": {}, "caller_file_path": null, "caller_file_line_range": null, "resource_address": null, "severity": null, "bc_category": null, "benchmarks": {}, "description": null, "short_description": null, "vulnerability_details": null, "connected_node": null, "guideline": null, "details": [], "check_len": null, "definition_context_file_path": "/github/workspace/kms.tf"}, {"check_id": "CKV2_AWS_64", "bc_check_id": null, "check_name": "Ensure KMS key Policy is defined", "check_result": {"result": "PASSED", "entity": {"aws_kms_key": {"fail2": {"__end_line__": 249, "__start_line__": 166, "bypass_policy_lockout_safety_check": [false], "customer_master_key_spec": ["SYMMETRIC_DEFAULT"], "deletion_window_in_days": [7], "description": ["fail2"], "enable_key_rotation": [false], "is_enabled": [false], "key_usage": ["ENCRYPT_DECRYPT"], "policy": [{"Version": "2012-10-17", "Statement": [{"Sid": "ABasicBadPolicyExampleTest", "Effect": "Allow", "Principal": {"AWS": "*"}, "Action": ["kms:Update*", "kms:UntagResource", "kms:TagResource", "kms:SynchronizeMultiRegionKey", "kms:ScheduleKeyDeletion", "kms:ReplicateKey", "kms:PutKeyPolicy", "kms:List*", "kms:Get*", "kms:Enable*", "kms:Disable*", "kms:Describe*", "kms:DeleteAlias", "kms:CreateAlias", "kms:CancelKeyDeletion"], "Resource": "*"}, {"Sid": "AllowMacietoDecryptheKey", "Effect": "Allow", "Principal": {"AWS": "arn:aws:iam::398930073421:root"}, "Action": ["kms:List*", "kms:GetKeyRotationStatus", "kms:GetKeyPolicy", "kms:Describe*", "kms:Decrypt"], "Resource": "*", "Condition": {"StringEquals": {"aws:PrincipalArn": "arn:aws:iam::398930073421:role/aws-service-role/macie.amazonaws.com/AWSServiceRoleForAmazonMacie"}}}, {"Sid": "AllowConfigandAccessAnalyzertoReadKeyAttributes", "Effect": "Allow", "Principal": {"AWS": "arn:aws:iam::398930073421:root"}, "Action": ["kms:List*", "kms:GetKeyRotationStatus", "kms:GetKeyPolicy", "kms:Describe*"], "Resource": "*", "Condition": {"StringEquals": {"aws:PrincipalArn": ["arn:aws:iam::398930073421:role/aws-service-role/access-analyzer.amazonaws.com/AWSServiceRoleForAccessAnalyzer", "arn:aws:iam::398930073421:role/aws-service-role/config.amazonaws.com/AWSServiceRoleForConfig"]}}}]}], "__address__": "aws_kms_key.fail2"}}}, "evaluated_keys": ["policy", "resource_type"]}, "code_block": [[166, "resource \"aws_kms_key\" \"fail2\" {\n"], [167, "  description                        = \"fail2\"\n"], [168, "  deletion_window_in_days            = 7\n"], [169, "  key_usage                          = \"ENCRYPT_DECRYPT\"\n"], [170, "  customer_master_key_spec           = \"SYMMETRIC_DEFAULT\"\n"], [171, "  policy                             = <<POLICY\n"], [172, "{\n"], [173, "    \"Version\": \"2012-10-17\",\n"], [174, "    \"Statement\": [\n"], [175, "        {\n"], [176, "            \"Sid\": \"ABasicBadPolicyExampleTest\",\n"], [177, "            \"Effect\": \"Allow\",\n"], [178, "            \"Principal\": {\n"], [179, "                \"AWS\": \"*\"\n"], [180, "            },\n"], [181, "            \"Action\": [\n"], [182, "                \"kms:Update*\",\n"], [183, "                \"kms:UntagResource\",\n"], [184, "                \"kms:TagResource\",\n"], [185, "                \"kms:SynchronizeMultiRegionKey\",\n"], [186, "                \"kms:ScheduleKeyDeletion\",\n"], [187, "                \"kms:ReplicateKey\",\n"], [188, "                \"kms:PutKeyPolicy\",\n"], [189, "                \"kms:List*\",\n"], [190, "                \"kms:Get*\",\n"], [191, "                \"kms:Enable*\",\n"], [192, "                \"kms:Disable*\",\n"], [193, "                \"kms:Describe*\",\n"], [194, "                \"kms:DeleteAlias\",\n"], [195, "                \"kms:CreateAlias\",\n"], [196, "                \"kms:CancelKeyDeletion\"\n"], [197, "            ],\n"], [198, "            \"Resource\": \"*\"\n"], [199, "        },\n"], [200, "        {\n"], [201, "            \"Sid\": \"AllowMacietoDecryptheKey\",\n"], [202, "            \"Effect\": \"Allow\",\n"], [203, "            \"Principal\": {\n"], [204, "                \"AWS\": \"arn:aws:iam::398930073421:root\"\n"], [205, "            },\n"], [206, "            \"Action\": [\n"], [207, "                \"kms:List*\",\n"], [208, "                \"kms:GetKeyRotationStatus\",\n"], [209, "                \"kms:GetKeyPolicy\",\n"], [210, "                \"kms:Describe*\",\n"], [211, "                \"kms:Decrypt\"\n"], [212, "            ],\n"], [213, "            \"Resource\": \"*\",\n"], [214, "            \"Condition\": {\n"], [215, "                \"StringEquals\": {\n"], [216, "                    \"aws:PrincipalArn\": \"arn:aws:iam::398930073421:role/aws-service-role/macie.amazonaws.com/AWSServiceRoleForAmazonMacie\"\n"], [217, "                }\n"], [218, "            }\n"], [219, "        },\n"], [220, "        {\n"], [221, "            \"Sid\": \"AllowConfigandAccessAnalyzertoReadKeyAttributes\",\n"], [222, "            \"Effect\": \"Allow\",\n"], [223, "            \"Principal\": {\n"], [224, "                \"AWS\": \"arn:aws:iam::398930073421:root\"\n"], [225, "            },\n"], [226, "            \"Action\": [\n"], [227, "                \"kms:List*\",\n"], [228, "                \"kms:GetKeyRotationStatus\",\n"], [229, "                \"kms:GetKeyPolicy\",\n"], [230, "                \"kms:Describe*\"\n"], [231, "            ],\n"], [232, "            \"Resource\": \"*\",\n"], [233, "            \"Condition\": {\n"], [234, "                \"StringEquals\": {\n"], [235, "                    \"aws:PrincipalArn\": [\n"], [236, "                        \"arn:aws:iam::398930073421:role/aws-service-role/access-analyzer.amazonaws.com/AWSServiceRoleForAccessAnalyzer\",\n"], [237, "                        \"arn:aws:iam::398930073421:role/aws-service-role/config.amazonaws.com/AWSServiceRoleForConfig\"\n"], [238, "                    ]\n"], [239, "                }\n"], [240, "            }\n"], [241, "        }\n"], [242, "    ]\n"], [243, "}\n"], [244, "POLICY\n"], [245, "  bypass_policy_lockout_safety_check = false\n"], [246, "  is_enabled                         = false\n"], [247, "  enable_key_rotation                = false\n"], [248, "\n"], [249, "}\n"]], "file_path": "/kms.tf", "file_abs_path": "/github/workspace/kms.tf", "repo_file_path": "/kms.tf", "file_line_range": [166, 249], "resource": "aws_kms_key.fail2", "evaluations": null, "check_class": "checkov.common.graph.checks_infra.base_check", "fixed_definition": null, "entity_tags": {}, "caller_file_path": null, "caller_file_line_range": null, "resource_address": null, "severity": null, "bc_category": null, "benchmarks": {}, "description": null, "short_description": null, "vulnerability_details": null, "connected_node": null, "guideline": null, "details": [], "check_len": null, "definition_context_file_path": "/github/workspace/kms.tf"}, {"check_id": "CKV2_AWS_64", "bc_check_id": null, "check_name": "Ensure KMS key Policy is defined", "check_result": {"result": "PASSED", "entity": {"aws_kms_key": {"fail3": {"__end_line__": 620, "__start_line__": 251, "deletion_window_in_days": [30], "description": ["fail3"], "enable_key_rotation": [true], "policy": ["  {\n    \"Version\": \"2012-10-17\",\n    \"Statement\": [\n        {\n            \"Effect\": \"Allow\",\n            \"Principal\": {\n                \"AWS\": \"*\"\n            },\n            \"Action\": [\n                \"kms:*\"\n            ],\n            \"Resource\": \"*\"\n        },\n        {\n            \"Sid\": \"AdministrativePermissionsForRolethatCreatedKey\",\n            \"Effect\": \"Allow\",\n            \"Principal\": {\n                \"AWS\": \"arn:${data.aws_partition.current.partition}:iam::${data.aws_caller_identity.current.id}:root\"\n            },\n            \"Action\": [\n                \"kms:Update*\",\n                \"kms:UntagResource\",\n                \"kms:TagResource\",\n                \"kms:SynchronizeMultiRegionKey\",\n                \"kms:ScheduleKeyDeletion\",\n                \"kms:ReplicateKey\",\n                \"kms:PutKeyPolicy\",\n                \"kms:List*\",\n                \"kms:Get*\",\n                \"kms:Enable*\",\n                \"kms:Disable*\",\n                \"kms:Describe*\",\n                \"kms:DeleteAlias\",\n                \"kms:CreateAlias\",\n                \"kms:CancelKeyDeletion\"\n            ],\n            \"Resource\": \"*\",\n            \"Condition\": {\n                \"StringEquals\": {\n                    \"aws:PrincipalOrgID\": \"${data.aws_organizations_organization.current.id}\",\n                    \"aws:PrincipalArn\": \"${data.aws_iam_session_context.current.issuer_arn}\"\n                }\n            }\n        },\n        {\n            \"Sid\": \"RecoveryAndTDIRRolePermissions\",\n            \"Effect\": \"Allow\",\n            \"Principal\": {\n                \"AWS\": \"arn:${data.aws_partition.current.partition}:iam::${data.aws_caller_identity.current.id}:root\"\n            },\n            \"Action\": [\n                \"kms:Update*\",\n                \"kms:UntagResource\",\n                \"kms:TagResource\",\n                \"kms:SynchronizeMultiRegionKey\",\n                \"kms:ScheduleKeyDeletion\",\n                \"kms:ReplicateKey\",\n                \"kms:PutKeyPolicy\",\n                \"kms:List*\",\n                \"kms:Get*\",\n                \"kms:Enable*\",\n                \"kms:Disable*\",\n                \"kms:Describe*\",\n                \"kms:DeleteAlias\",\n                \"kms:CreateAlias\",\n                \"kms:CancelKeyDeletion\"\n            ],\n            \"Resource\": \"*\",\n            \"Condition\": {\n                \"StringEquals\": {\n                    \"kms:CallerAccount\": \"${data.aws_caller_identity.current.id}\",\n                    \"aws:PrincipalOrgID\": \"${data.aws_organizations_organization.current.id}\",\n                    \"aws:PrincipalArn\": [\n                        \"arn:${data.aws_partition.current.partition}:iam::${data.aws_caller_identity.current.id}:role/recoveryrole\",\n                        \"arn:${data.aws_partition.current.partition}:iam::${data.aws_caller_identity.current.id}:role/incident-response-role\"\n                    ]\n                }\n            }\n        },\n        {\n            \"Sid\": \"lambdadecryptvariables\",\n            \"Effect\": \"Allow\",\n            \"Principal\": {\n                \"AWS\": \"arn:${data.aws_partition.current.partition}:iam::${data.aws_caller_identity.current.id}:root\"\n            },\n            \"Action\": \"kms:CreateGrant\",\n            \"Resource\": \"*\",\n            \"Condition\": {\n                \"StringEquals\": {\n                    \"kms:EncryptionContext:${data.aws_partition.current.partition}:lambda:FunctionArn\": [\n                        \"arn:${data.aws_partition.current.partition}:lambda:${data.aws_region.current.id}:${data.aws_caller_identity.current.id}:function:tdir-format-eventbridge-input\",\n                        \"arn:${data.aws_partition.current.partition}:lambda:${data.aws_region.current.id}:${data.aws_caller_identity.current.id}:function:tdir-check-snapshots\",\n                        \"arn:${data.aws_partition.current.partition}:lambda:${data.aws_region.current.id}:${data.aws_caller_identity.current.id}:function:tdir-create-streaming-instance\",\n                        \"arn:${data.aws_partition.current.partition}:lambda:${data.aws_region.current.id}:${data.aws_caller_identity.current.id}:function:tdir-check-instance-managed\",\n                        \"arn:${data.aws_partition.current.partition}:lambda:${data.aws_region.current.id}:${data.aws_caller_identity.current.id}:function:tdir-run-command-stream-snapshot-to-s3\",\n                        \"arn:${data.aws_partition.current.partition}:lambda:${data.aws_region.current.id}:${data.aws_caller_identity.current.id}:function:tdir-wait-run-command\",\n                        \"arn:${data.aws_partition.current.partition}:lambda:${data.aws_region.current.id}:${data.aws_caller_identity.current.id}:function:tdir-create-sidecar-volume-instance\",\n                        \"arn:${data.aws_partition.current.partition}:lambda:${data.aws_region.current.id}:${data.aws_caller_identity.current.id}:function:tdir-run-command-stream-sidecar-volume-snapshot-to-ec2\",\n                        \"arn:${data.aws_partition.current.partition}:lambda:${data.aws_region.current.id}:${data.aws_caller_identity.current.id}:function:tdir-prepare-and-attach-volume\",\n                        \"arn:${data.aws_partition.current.partition}:lambda:${data.aws_region.current.id}:${data.aws_caller_identity.current.id}:function:tdir-run-command-stream-memory-capture-to-s3\"\n                    ],\n                    \"kms:GrantConstraintType\": \"EncryptionContextEquals\",\n                    \"kms:ViaService\": \"lambda.${data.aws_region.current.id}.amazonaws.com\"\n                },\n                \"ForAllValues:StringEquals\": {\n                    \"kms:GrantOperations\": [\n                        \"Decrypt\",\n                        \"RetireGrant\"\n                    ]\n                },\n                \"Bool\": {\n                    \"kms:GrantIsForAWSResource\": \"true\"\n                }\n            }\n        },\n        {\n            \"Sid\": \"pipelinevariablemanagement\",\n            \"Effect\": \"Allow\",\n            \"Principal\": {\n                \"AWS\": \"arn:${data.aws_partition.current.partition}:iam::${data.aws_caller_identity.current.id}:root\"\n            },\n            \"Action\": [\n                \"kms:Encrypt\",\n                \"kms:Decrypt\"\n            ],\n            \"Resource\": \"*\",\n            \"Condition\": {\n                \"StringEquals\": {\n                    \"kms:EncryptionContext:${data.aws_partition.current.partition}:lambda:FunctionArn\": [\n                        \"arn:${data.aws_partition.current.partition}:lambda:${data.aws_region.current.id}:${data.aws_caller_identity.current.id}:function:tdir-format-eventbridge-input\",\n                        \"arn:${data.aws_partition.current.partition}:lambda:${data.aws_region.current.id}:${data.aws_caller_identity.current.id}:function:tdir-check-snapshots\",\n                        \"arn:${data.aws_partition.current.partition}:lambda:${data.aws_region.current.id}:${data.aws_caller_identity.current.id}:function:tdir-create-streaming-instance\",\n                        \"arn:${data.aws_partition.current.partition}:lambda:${data.aws_region.current.id}:${data.aws_caller_identity.current.id}:function:tdir-check-instance-managed\",\n                        \"arn:${data.aws_partition.current.partition}:lambda:${data.aws_region.current.id}:${data.aws_caller_identity.current.id}:function:tdir-run-command-stream-snapshot-to-s3\",\n                        \"arn:${data.aws_partition.current.partition}:lambda:${data.aws_region.current.id}:${data.aws_caller_identity.current.id}:function:tdir-wait-run-command\",\n                        \"arn:${data.aws_partition.current.partition}:lambda:${data.aws_region.current.id}:${data.aws_caller_identity.current.id}:function:tdir-create-sidecar-volume-instance\",\n                        \"arn:${data.aws_partition.current.partition}:lambda:${data.aws_region.current.id}:${data.aws_caller_identity.current.id}:function:tdir-run-command-stream-sidecar-volume-snapshot-to-ec2\",\n                        \"arn:${data.aws_partition.current.partition}:lambda:${data.aws_region.current.id}:${data.aws_caller_identity.current.id}:function:tdir-prepare-and-attach-volume\",\n                        \"arn:${data.aws_partition.current.partition}:lambda:${data.aws_region.current.id}:${data.aws_caller_identity.current.id}:function:tdir-run-command-stream-memory-capture-to-s3\"\n                    ],\n                    \"aws:PrincipalArn\": \"arn:${data.aws_partition.current.partition}:iam::${data.aws_caller_identity.current.id}:role/admin\",\n                    \"kms:ViaService\": \"lambda.${data.aws_region.current.id}.amazonaws.com\"\n                }\n            }\n        },\n        {\n            \"Sid\": \"encryption-for-loggroups\",\n            \"Effect\": \"Allow\",\n            \"Principal\": {\n                \"Service\": \"logs.${data.aws_region.current.id}.amazonaws.com\"\n            },\n            \"Action\": [\n                \"kms:ReEncrypt*\",\n                \"kms:GenerateDataKey*\",\n                \"kms:Encrypt*\",\n                \"kms:Describe*\",\n                \"kms:Decrypt*\"\n            ],\n            \"Resource\": \"*\",\n            \"Condition\": {\n                \"StringEquals\": {\n                    \"kms:EncryptionContext:${data.aws_partition.current.partition}:logs:arn\": [\n                        \"arn:${data.aws_partition.current.partition}:logs:${data.aws_region.current.id}:${data.aws_caller_identity.current.id}:log-group:/aws/stepfunction/tdir\",\n                        \"arn:${data.aws_partition.current.partition}:logs:${data.aws_region.current.id}:${data.aws_caller_identity.current.id}:log-group:/aws/lambda/tdir-format-eventbridge\",\n                        \"arn:${data.aws_partition.current.partition}:logs:${data.aws_region.current.id}:${data.aws_caller_identity.current.id}:log-group:/aws/lambda/tdir-format-eventbridge-input\",\n                        \"arn:${data.aws_partition.current.partition}:logs:${data.aws_region.current.id}:${data.aws_caller_identity.current.id}:log-group:/aws/lambda/tdir-check-snapshots\",\n                        \"arn:${data.aws_partition.current.partition}:logs:${data.aws_region.current.id}:${data.aws_caller_identity.current.id}:log-group:/aws/lambda/tdir-create-streaming-instance\",\n                        \"arn:${data.aws_partition.current.partition}:logs:${data.aws_region.current.id}:${data.aws_caller_identity.current.id}:log-group:/aws/lambda/tdir-check-instance-managed\",\n                        \"arn:${data.aws_partition.current.partition}:logs:${data.aws_region.current.id}:${data.aws_caller_identity.current.id}:log-group:/aws/lambda/tdir-run-command-stream-snapshot-to-s3\",\n                        \"arn:${data.aws_partition.current.partition}:logs:${data.aws_region.current.id}:${data.aws_caller_identity.current.id}:log-group:/aws/lambda/tdir-wait-run-command\",\n                        \"arn:${data.aws_partition.current.partition}:logs:${data.aws_region.current.id}:${data.aws_caller_identity.current.id}:log-group:/aws/lambda/tdir-create-sidecar-volume-instance\",\n                        \"arn:${data.aws_partition.current.partition}:logs:${data.aws_region.current.id}:${data.aws_caller_identity.current.id}:log-group:/aws/lambda/tdir-run-command-stream-sidecar-volume-snapshot-to-ec2\",\n                        \"arn:${data.aws_partition.current.partition}:logs:${data.aws_region.current.id}:${data.aws_caller_identity.current.id}:log-group:/aws/lambda/tdir-prepare-and-attach-volume\",\n                        \"arn:${data.aws_partition.current.partition}:logs:${data.aws_region.current.id}:${data.aws_caller_identity.current.id}:log-group:/aws/lambda/tdir-run-command-stream-memory-capture-to-s3\"\n                    ],\n                    \"aws:SourceOrgID\": \"${data.aws_organizations_organization.current.id}\"\n                }\n            }\n        },\n        {\n            \"Sid\": \"ec2runinstances\",\n            \"Effect\": \"Allow\",\n            \"Principal\": {\n                \"AWS\": \"arn:${data.aws_partition.current.partition}:iam::${data.aws_caller_identity.current.id}:root\"\n            },\n            \"Action\": \"kms:GenerateDataKeyWithoutPlaintext\",\n            \"Resource\": \"*\",\n            \"Condition\": {\n                \"StringEquals\": {\n                    \"aws:PrincipalArn\": \"arn:${data.aws_partition.current.partition}:iam::${data.aws_caller_identity.current.id}:role/tdir-lambda\",\n                    \"kms:ViaService\": \"ec2.${data.aws_region.current.id}.amazonaws.com\"\n                }\n            }\n        },\n        {\n            \"Sid\": \"ec2ebsdecrypt\",\n            \"Effect\": \"Allow\",\n            \"Principal\": {\n                \"AWS\": \"arn:${data.aws_partition.current.partition}:iam::${data.aws_caller_identity.current.id}:root\"\n            },\n            \"Action\": \"kms:CreateGrant\",\n            \"Resource\": \"*\",\n            \"Condition\": {\n                \"StringEquals\": {\n                    \"kms:GrantConstraintType\": \"EncryptionContextSubset\",\n                    \"aws:PrincipalArn\": \"arn:${data.aws_partition.current.partition}:iam::${data.aws_caller_identity.current.id}:role/tdir-lambda\",\n                    \"kms:ViaService\": \"ec2.${data.aws_region.current.id}.amazonaws.com\"\n                },\n                \"StringLike\": {\n                    \"kms:EncryptionContext:${data.aws_partition.current.partition}:ebs:id\": \"vol-*\"\n                },\n                \"ForAllValues:StringEquals\": {\n                    \"kms:GrantOperations\": \"Decrypt\"\n                },\n                \"Bool\": {\n                    \"kms:GrantIsForAWSResource\": \"true\"\n                }\n            }\n        },\n        {\n            \"Sid\": \"AllowMacietoDecryptheKey\",\n            \"Effect\": \"Allow\",\n            \"Principal\": {\n                \"AWS\": \"arn:${data.aws_partition.current.partition}:iam::${data.aws_caller_identity.current.id}:root\"\n            },\n            \"Action\": [\n                \"kms:List*\",\n                \"kms:GetKeyRotationStatus\",\n                \"kms:GetKeyPolicy\",\n                \"kms:Describe*\",\n                \"kms:Decrypt\"\n            ],\n            \"Resource\": \"*\",\n            \"Condition\": {\n                \"StringEquals\": {\n                    \"aws:PrincipalArn\": \"arn:${data.aws_partition.current.partition}:iam::${data.aws_caller_identity.current.id}:role/aws-service-role/macie.amazonaws.com/AWSServiceRoleForAmazonMacie\"\n                }\n            }\n        },\n        {\n            \"Sid\": \"s3upload\",\n            \"Effect\": \"Allow\",\n            \"Principal\": {\n                \"AWS\": \"arn:${data.aws_partition.current.partition}:iam::${data.aws_caller_identity.current.id}:root\"\n            },\n            \"Action\": [\n                \"kms:GenerateDataKey\",\n                \"kms:Decrypt\"\n            ],\n            \"Resource\": \"*\",\n            \"Condition\": {\n                \"StringEquals\": {\n                    \"aws:PrincipalArn\": \"arn:${data.aws_partition.current.partition}:iam::${data.aws_caller_identity.current.id}:role/tdir-ec2-collection\",\n                    \"kms:EncryptionContext:${data.aws_partition.current.partition}:s3:arn\": \"arn:${data.aws_partition.current.partition}:s3:::tdir-${data.aws_caller_identity.current.id}-${data.aws_region.current.id}\",\n                    \"kms:ViaService\": \"s3.${data.aws_region.current.id}.amazonaws.com\"\n                }\n            }\n        },\n        {\n            \"Sid\": \"s3download\",\n            \"Effect\": \"Allow\",\n            \"Principal\": {\n                \"AWS\": \"arn:${data.aws_partition.current.partition}:iam::${data.aws_caller_identity.current.id}:root\"\n            },\n            \"Action\": \"kms:Decrypt\",\n            \"Resource\": \"*\",\n            \"Condition\": {\n                \"StringEquals\": {\n                    \"aws:PrincipalArn\": \"arn:${data.aws_partition.current.partition}:iam::${data.aws_caller_identity.current.id}:role/admin\",\n                    \"kms:EncryptionContext:${data.aws_partition.current.partition}:s3:arn\": \"arn:${data.aws_partition.current.partition}:s3:::tdir-${data.aws_caller_identity.current.id}-${data.aws_region.current.id}\",\n                    \"kms:ViaService\": \"s3.${data.aws_region.current.id}.amazonaws.com\"\n                }\n            }\n        },\n        {\n            \"Sid\": \"AllowConfigandAccessAnalyzertoReadKeyAttributes\",\n            \"Effect\": \"Allow\",\n            \"Principal\": {\n                \"AWS\": \"arn:${data.aws_partition.current.partition}:iam::${data.aws_caller_identity.current.id}:root\"\n            },\n            \"Action\": [\n                \"kms:List*\",\n                \"kms:GetKeyRotationStatus\",\n                \"kms:GetKeyPolicy\",\n                \"kms:Describe*\"\n            ],\n            \"Resource\": \"*\",\n            \"Condition\": {\n                \"StringEquals\": {\n                    \"aws:PrincipalArn\": [\n                        \"arn:${data.aws_partition.current.partition}:iam::${data.aws_caller_identity.current.id}:role/aws-service-role/access-analyzer.amazonaws.com/AWSServiceRoleForAccessAnalyzer\",\n                        \"arn:${data.aws_partition.current.partition}:iam::${data.aws_caller_identity.current.id}:role/aws-service-role/config.amazonaws.com/AWSServiceRoleForConfig\"\n                    ]\n                }\n            }\n        },\n        {\n            \"Sid\": \"DenyNonOrganizationalServiceEncryptionUse\",\n            \"Effect\": \"Deny\",\n            \"Principal\": {\n                \"AWS\": \"*\"\n            },\n            \"Action\": \"kms:*\",\n            \"Resource\": \"*\",\n            \"Condition\": {\n                \"StringNotEqualsIfExists\": {\n                    \"aws:SourceOrgID\": \"${data.aws_organizations_organization.current.id}\"\n                },\n                \"Null\": {\n                    \"aws:SourceOrgID\": \"false\"\n                },\n                \"BoolIfExists\": {\n                    \"aws:PrincipalIsAWSService\": \"true\"\n                }\n            }\n        },\n        {\n            \"Sid\": \"PreventNonOrganizationalAccess\",\n            \"Effect\": \"Deny\",\n            \"Principal\": {\n                \"AWS\": \"*\"\n            },\n            \"Action\": \"kms:*\",\n            \"Resource\": \"*\",\n            \"Condition\": {\n                \"StringNotEqualsIfExists\": {\n                    \"aws:PrincipalOrgID\": \"${data.aws_organizations_organization.current.id}\"\n                },\n                \"BoolIfExists\": {\n                    \"aws:PrincipalIsAWSService\": \"false\"\n                }\n            }\n        },\n        {\n            \"Sid\": \"MaxDeletionWindow\",\n            \"Effect\": \"Deny\",\n            \"Principal\": {\n                \"AWS\": \"*\"\n            },\n            \"Action\": \"kms:ScheduleKeyDeletion\",\n            \"Resource\": \"*\",\n            \"Condition\": {\n                \"NumericLessThan\": {\n                    \"kms:ScheduleKeyDeletionPendingWindowInDays\": \"30\"\n                }\n            }\n        },\n        {\n            \"Sid\": \"PreventSafetyLockoutBypass\",\n            \"Effect\": \"Deny\",\n            \"Principal\": {\n                \"AWS\": \"*\"\n            },\n            \"Action\": \"kms:PutKeyPolicy\",\n            \"Resource\": \"*\",\n            \"Condition\": {\n                \"Bool\": {\n                    \"kms:BypassPolicyLockoutSafetyCheck\": \"true\"\n                }\n            }\n        }\n    ]\n}"], "__address__": "aws_kms_key.fail3"}}}, "evaluated_keys": ["policy", "resource_type"]}, "code_block": [[251, "resource \"aws_kms_key\" \"fail3\" {\n"], [252, "  description             = \"fail3\"\n"], [253, "  deletion_window_in_days = 30\n"], [254, "  policy                  = <<EOF\n"], [255, "  {\n"], [256, "    \"Version\": \"2012-10-17\",\n"], [257, "    \"Statement\": [\n"], [258, "        {\n"], [259, "            \"Effect\": \"Allow\",\n"], [260, "            \"Principal\": {\n"], [261, "                \"AWS\": \"*\"\n"], [262, "            },\n"], [263, "            \"Action\": [\n"], [264, "                \"kms:*\"\n"], [265, "            ],\n"], [266, "            \"Resource\": \"*\"\n"], [267, "        },\n"], [268, "        {\n"], [269, "            \"Sid\": \"AdministrativePermissionsForRolethatCreatedKey\",\n"], [270, "            \"Effect\": \"Allow\",\n"], [271, "            \"Principal\": {\n"], [272, "                \"AWS\": \"arn:${data.aws_partition.current.partition}:iam::${data.aws_caller_identity.current.id}:root\"\n"], [273, "            },\n"], [274, "            \"Action\": [\n"], [275, "                \"kms:Update*\",\n"], [276, "                \"kms:UntagResource\",\n"], [277, "                \"kms:TagResource\",\n"], [278, "                \"kms:SynchronizeMultiRegionKey\",\n"], [279, "                \"kms:ScheduleKeyDeletion\",\n"], [280, "                \"kms:ReplicateKey\",\n"], [281, "                \"kms:PutKeyPolicy\",\n"], [282, "                \"kms:List*\",\n"], [283, "                \"kms:Get*\",\n"], [284, "                \"kms:Enable*\",\n"], [285, "                \"kms:Disable*\",\n"], [286, "                \"kms:Describe*\",\n"], [287, "                \"kms:DeleteAlias\",\n"], [288, "                \"kms:CreateAlias\",\n"], [289, "                \"kms:CancelKeyDeletion\"\n"], [290, "            ],\n"], [291, "            \"Resource\": \"*\",\n"], [292, "            \"Condition\": {\n"], [293, "                \"StringEquals\": {\n"], [294, "                    \"aws:PrincipalOrgID\": \"${data.aws_organizations_organization.current.id}\",\n"], [295, "                    \"aws:PrincipalArn\": \"${data.aws_iam_session_context.current.issuer_arn}\"\n"], [296, "                }\n"], [297, "            }\n"], [298, "        },\n"], [299, "        {\n"], [300, "            \"Sid\": \"RecoveryAndTDIRRolePermissions\",\n"], [301, "            \"Effect\": \"Allow\",\n"], [302, "            \"Principal\": {\n"], [303, "                \"AWS\": \"arn:${data.aws_partition.current.partition}:iam::${data.aws_caller_identity.current.id}:root\"\n"], [304, "            },\n"], [305, "            \"Action\": [\n"], [306, "                \"kms:Update*\",\n"], [307, "                \"kms:UntagResource\",\n"], [308, "                \"kms:TagResource\",\n"], [309, "                \"kms:SynchronizeMultiRegionKey\",\n"], [310, "                \"kms:ScheduleKeyDeletion\",\n"], [311, "                \"kms:ReplicateKey\",\n"], [312, "                \"kms:PutKeyPolicy\",\n"], [313, "                \"kms:List*\",\n"], [314, "                \"kms:Get*\",\n"], [315, "                \"kms:Enable*\",\n"], [316, "                \"kms:Disable*\",\n"], [317, "                \"kms:Describe*\",\n"], [318, "                \"kms:DeleteAlias\",\n"], [319, "                \"kms:CreateAlias\",\n"], [320, "                \"kms:CancelKeyDeletion\"\n"], [321, "            ],\n"], [322, "            \"Resource\": \"*\",\n"], [323, "            \"Condition\": {\n"], [324, "                \"StringEquals\": {\n"], [325, "                    \"kms:CallerAccount\": \"${data.aws_caller_identity.current.id}\",\n"], [326, "                    \"aws:PrincipalOrgID\": \"${data.aws_organizations_organization.current.id}\",\n"], [327, "                    \"aws:PrincipalArn\": [\n"], [328, "                        \"arn:${data.aws_partition.current.partition}:iam::${data.aws_caller_identity.current.id}:role/recoveryrole\",\n"], [329, "                        \"arn:${data.aws_partition.current.partition}:iam::${data.aws_caller_identity.current.id}:role/incident-response-role\"\n"], [330, "                    ]\n"], [331, "                }\n"], [332, "            }\n"], [333, "        },\n"], [334, "        {\n"], [335, "            \"Sid\": \"lambdadecryptvariables\",\n"], [336, "            \"Effect\": \"Allow\",\n"], [337, "            \"Principal\": {\n"], [338, "                \"AWS\": \"arn:${data.aws_partition.current.partition}:iam::${data.aws_caller_identity.current.id}:root\"\n"], [339, "            },\n"], [340, "            \"Action\": \"kms:CreateGrant\",\n"], [341, "            \"Resource\": \"*\",\n"], [342, "            \"Condition\": {\n"], [343, "                \"StringEquals\": {\n"], [344, "                    \"kms:EncryptionContext:${data.aws_partition.current.partition}:lambda:FunctionArn\": [\n"], [345, "                        \"arn:${data.aws_partition.current.partition}:lambda:${data.aws_region.current.id}:${data.aws_caller_identity.current.id}:function:tdir-format-eventbridge-input\",\n"], [346, "                        \"arn:${data.aws_partition.current.partition}:lambda:${data.aws_region.current.id}:${data.aws_caller_identity.current.id}:function:tdir-check-snapshots\",\n"], [347, "                        \"arn:${data.aws_partition.current.partition}:lambda:${data.aws_region.current.id}:${data.aws_caller_identity.current.id}:function:tdir-create-streaming-instance\",\n"], [348, "                        \"arn:${data.aws_partition.current.partition}:lambda:${data.aws_region.current.id}:${data.aws_caller_identity.current.id}:function:tdir-check-instance-managed\",\n"], [349, "                        \"arn:${data.aws_partition.current.partition}:lambda:${data.aws_region.current.id}:${data.aws_caller_identity.current.id}:function:tdir-run-command-stream-snapshot-to-s3\",\n"], [350, "                        \"arn:${data.aws_partition.current.partition}:lambda:${data.aws_region.current.id}:${data.aws_caller_identity.current.id}:function:tdir-wait-run-command\",\n"], [351, "                        \"arn:${data.aws_partition.current.partition}:lambda:${data.aws_region.current.id}:${data.aws_caller_identity.current.id}:function:tdir-create-sidecar-volume-instance\",\n"], [352, "                        \"arn:${data.aws_partition.current.partition}:lambda:${data.aws_region.current.id}:${data.aws_caller_identity.current.id}:function:tdir-run-command-stream-sidecar-volume-snapshot-to-ec2\",\n"], [353, "                        \"arn:${data.aws_partition.current.partition}:lambda:${data.aws_region.current.id}:${data.aws_caller_identity.current.id}:function:tdir-prepare-and-attach-volume\",\n"], [354, "                        \"arn:${data.aws_partition.current.partition}:lambda:${data.aws_region.current.id}:${data.aws_caller_identity.current.id}:function:tdir-run-command-stream-memory-capture-to-s3\"\n"], [355, "                    ],\n"], [356, "                    \"kms:GrantConstraintType\": \"EncryptionContextEquals\",\n"], [357, "                    \"kms:ViaService\": \"lambda.${data.aws_region.current.id}.amazonaws.com\"\n"], [358, "                },\n"], [359, "                \"ForAllValues:StringEquals\": {\n"], [360, "                    \"kms:GrantOperations\": [\n"], [361, "                        \"Decrypt\",\n"], [362, "                        \"RetireGrant\"\n"], [363, "                    ]\n"], [364, "                },\n"], [365, "                \"Bool\": {\n"], [366, "                    \"kms:GrantIsForAWSResource\": \"true\"\n"], [367, "                }\n"], [368, "            }\n"], [369, "        },\n"], [370, "        {\n"], [371, "            \"Sid\": \"pipelinevariablemanagement\",\n"], [372, "            \"Effect\": \"Allow\",\n"], [373, "            \"Principal\": {\n"], [374, "                \"AWS\": \"arn:${data.aws_partition.current.partition}:iam::${data.aws_caller_identity.current.id}:root\"\n"], [375, "            },\n"], [376, "            \"Action\": [\n"], [377, "                \"kms:Encrypt\",\n"], [378, "                \"kms:Decrypt\"\n"], [379, "            ],\n"], [380, "            \"Resource\": \"*\",\n"], [381, "            \"Condition\": {\n"], [382, "                \"StringEquals\": {\n"], [383, "                    \"kms:EncryptionContext:${data.aws_partition.current.partition}:lambda:FunctionArn\": [\n"], [384, "                        \"arn:${data.aws_partition.current.partition}:lambda:${data.aws_region.current.id}:${data.aws_caller_identity.current.id}:function:tdir-format-eventbridge-input\",\n"], [385, "                        \"arn:${data.aws_partition.current.partition}:lambda:${data.aws_region.current.id}:${data.aws_caller_identity.current.id}:function:tdir-check-snapshots\",\n"], [386, "                        \"arn:${data.aws_partition.current.partition}:lambda:${data.aws_region.current.id}:${data.aws_caller_identity.current.id}:function:tdir-create-streaming-instance\",\n"], [387, "                        \"arn:${data.aws_partition.current.partition}:lambda:${data.aws_region.current.id}:${data.aws_caller_identity.current.id}:function:tdir-check-instance-managed\",\n"], [388, "                        \"arn:${data.aws_partition.current.partition}:lambda:${data.aws_region.current.id}:${data.aws_caller_identity.current.id}:function:tdir-run-command-stream-snapshot-to-s3\",\n"], [389, "                        \"arn:${data.aws_partition.current.partition}:lambda:${data.aws_region.current.id}:${data.aws_caller_identity.current.id}:function:tdir-wait-run-command\",\n"], [390, "                        \"arn:${data.aws_partition.current.partition}:lambda:${data.aws_region.current.id}:${data.aws_caller_identity.current.id}:function:tdir-create-sidecar-volume-instance\",\n"], [391, "                        \"arn:${data.aws_partition.current.partition}:lambda:${data.aws_region.current.id}:${data.aws_caller_identity.current.id}:function:tdir-run-command-stream-sidecar-volume-snapshot-to-ec2\",\n"], [392, "                        \"arn:${data.aws_partition.current.partition}:lambda:${data.aws_region.current.id}:${data.aws_caller_identity.current.id}:function:tdir-prepare-and-attach-volume\",\n"], [393, "                        \"arn:${data.aws_partition.current.partition}:lambda:${data.aws_region.current.id}:${data.aws_caller_identity.current.id}:function:tdir-run-command-stream-memory-capture-to-s3\"\n"], [394, "                    ],\n"], [395, "                    \"aws:PrincipalArn\": \"arn:${data.aws_partition.current.partition}:iam::${data.aws_caller_identity.current.id}:role/admin\",\n"], [396, "                    \"kms:ViaService\": \"lambda.${data.aws_region.current.id}.amazonaws.com\"\n"], [397, "                }\n"], [398, "            }\n"], [399, "        },\n"], [400, "        {\n"], [401, "            \"Sid\": \"encryption-for-loggroups\",\n"], [402, "            \"Effect\": \"Allow\",\n"], [403, "            \"Principal\": {\n"], [404, "                \"Service\": \"logs.${data.aws_region.current.id}.amazonaws.com\"\n"], [405, "            },\n"], [406, "            \"Action\": [\n"], [407, "                \"kms:ReEncrypt*\",\n"], [408, "                \"kms:GenerateDataKey*\",\n"], [409, "                \"kms:Encrypt*\",\n"], [410, "                \"kms:Describe*\",\n"], [411, "                \"kms:Decrypt*\"\n"], [412, "            ],\n"], [413, "            \"Resource\": \"*\",\n"], [414, "            \"Condition\": {\n"], [415, "                \"StringEquals\": {\n"], [416, "                    \"kms:EncryptionContext:${data.aws_partition.current.partition}:logs:arn\": [\n"], [417, "                        \"arn:${data.aws_partition.current.partition}:logs:${data.aws_region.current.id}:${data.aws_caller_identity.current.id}:log-group:/aws/stepfunction/tdir\",\n"], [418, "                        \"arn:${data.aws_partition.current.partition}:logs:${data.aws_region.current.id}:${data.aws_caller_identity.current.id}:log-group:/aws/lambda/tdir-format-eventbridge\",\n"], [419, "                        \"arn:${data.aws_partition.current.partition}:logs:${data.aws_region.current.id}:${data.aws_caller_identity.current.id}:log-group:/aws/lambda/tdir-format-eventbridge-input\",\n"], [420, "                        \"arn:${data.aws_partition.current.partition}:logs:${data.aws_region.current.id}:${data.aws_caller_identity.current.id}:log-group:/aws/lambda/tdir-check-snapshots\",\n"], [421, "                        \"arn:${data.aws_partition.current.partition}:logs:${data.aws_region.current.id}:${data.aws_caller_identity.current.id}:log-group:/aws/lambda/tdir-create-streaming-instance\",\n"], [422, "                        \"arn:${data.aws_partition.current.partition}:logs:${data.aws_region.current.id}:${data.aws_caller_identity.current.id}:log-group:/aws/lambda/tdir-check-instance-managed\",\n"], [423, "                        \"arn:${data.aws_partition.current.partition}:logs:${data.aws_region.current.id}:${data.aws_caller_identity.current.id}:log-group:/aws/lambda/tdir-run-command-stream-snapshot-to-s3\",\n"], [424, "                        \"arn:${data.aws_partition.current.partition}:logs:${data.aws_region.current.id}:${data.aws_caller_identity.current.id}:log-group:/aws/lambda/tdir-wait-run-command\",\n"], [425, "                        \"arn:${data.aws_partition.current.partition}:logs:${data.aws_region.current.id}:${data.aws_caller_identity.current.id}:log-group:/aws/lambda/tdir-create-sidecar-volume-instance\",\n"], [426, "                        \"arn:${data.aws_partition.current.partition}:logs:${data.aws_region.current.id}:${data.aws_caller_identity.current.id}:log-group:/aws/lambda/tdir-run-command-stream-sidecar-volume-snapshot-to-ec2\",\n"], [427, "                        \"arn:${data.aws_partition.current.partition}:logs:${data.aws_region.current.id}:${data.aws_caller_identity.current.id}:log-group:/aws/lambda/tdir-prepare-and-attach-volume\",\n"], [428, "                        \"arn:${data.aws_partition.current.partition}:logs:${data.aws_region.current.id}:${data.aws_caller_identity.current.id}:log-group:/aws/lambda/tdir-run-command-stream-memory-capture-to-s3\"\n"], [429, "                    ],\n"], [430, "                    \"aws:SourceOrgID\": \"${data.aws_organizations_organization.current.id}\"\n"], [431, "                }\n"], [432, "            }\n"], [433, "        },\n"], [434, "        {\n"], [435, "            \"Sid\": \"ec2runinstances\",\n"], [436, "            \"Effect\": \"Allow\",\n"], [437, "            \"Principal\": {\n"], [438, "                \"AWS\": \"arn:${data.aws_partition.current.partition}:iam::${data.aws_caller_identity.current.id}:root\"\n"], [439, "            },\n"], [440, "            \"Action\": \"kms:GenerateDataKeyWithoutPlaintext\",\n"], [441, "            \"Resource\": \"*\",\n"], [442, "            \"Condition\": {\n"], [443, "                \"StringEquals\": {\n"], [444, "                    \"aws:PrincipalArn\": \"arn:${data.aws_partition.current.partition}:iam::${data.aws_caller_identity.current.id}:role/tdir-lambda\",\n"], [445, "                    \"kms:ViaService\": \"ec2.${data.aws_region.current.id}.amazonaws.com\"\n"], [446, "                }\n"], [447, "            }\n"], [448, "        },\n"], [449, "        {\n"], [450, "            \"Sid\": \"ec2ebsdecrypt\",\n"], [451, "            \"Effect\": \"Allow\",\n"], [452, "            \"Principal\": {\n"], [453, "                \"AWS\": \"arn:${data.aws_partition.current.partition}:iam::${data.aws_caller_identity.current.id}:root\"\n"], [454, "            },\n"], [455, "            \"Action\": \"kms:CreateGrant\",\n"], [456, "            \"Resource\": \"*\",\n"], [457, "            \"Condition\": {\n"], [458, "                \"StringEquals\": {\n"], [459, "                    \"kms:GrantConstraintType\": \"EncryptionContextSubset\",\n"], [460, "                    \"aws:PrincipalArn\": \"arn:${data.aws_partition.current.partition}:iam::${data.aws_caller_identity.current.id}:role/tdir-lambda\",\n"], [461, "                    \"kms:ViaService\": \"ec2.${data.aws_region.current.id}.amazonaws.com\"\n"], [462, "                },\n"], [463, "                \"StringLike\": {\n"], [464, "                    \"kms:EncryptionContext:${data.aws_partition.current.partition}:ebs:id\": \"vol-*\"\n"], [465, "                },\n"], [466, "                \"ForAllValues:StringEquals\": {\n"], [467, "                    \"kms:GrantOperations\": \"Decrypt\"\n"], [468, "                },\n"], [469, "                \"Bool\": {\n"], [470, "                    \"kms:GrantIsForAWSResource\": \"true\"\n"], [471, "                }\n"], [472, "            }\n"], [473, "        },\n"], [474, "        {\n"], [475, "            \"Sid\": \"AllowMacietoDecryptheKey\",\n"], [476, "            \"Effect\": \"Allow\",\n"], [477, "            \"Principal\": {\n"], [478, "                \"AWS\": \"arn:${data.aws_partition.current.partition}:iam::${data.aws_caller_identity.current.id}:root\"\n"], [479, "            },\n"], [480, "            \"Action\": [\n"], [481, "                \"kms:List*\",\n"], [482, "                \"kms:GetKeyRotationStatus\",\n"], [483, "                \"kms:GetKeyPolicy\",\n"], [484, "                \"kms:Describe*\",\n"], [485, "                \"kms:Decrypt\"\n"], [486, "            ],\n"], [487, "            \"Resource\": \"*\",\n"], [488, "            \"Condition\": {\n"], [489, "                \"StringEquals\": {\n"], [490, "                    \"aws:PrincipalArn\": \"arn:${data.aws_partition.current.partition}:iam::${data.aws_caller_identity.current.id}:role/aws-service-role/macie.amazonaws.com/AWSServiceRoleForAmazonMacie\"\n"], [491, "                }\n"], [492, "            }\n"], [493, "        },\n"], [494, "        {\n"], [495, "            \"Sid\": \"s3upload\",\n"], [496, "            \"Effect\": \"Allow\",\n"], [497, "            \"Principal\": {\n"], [498, "                \"AWS\": \"arn:${data.aws_partition.current.partition}:iam::${data.aws_caller_identity.current.id}:root\"\n"], [499, "            },\n"], [500, "            \"Action\": [\n"], [501, "                \"kms:GenerateDataKey\",\n"], [502, "                \"kms:Decrypt\"\n"], [503, "            ],\n"], [504, "            \"Resource\": \"*\",\n"], [505, "            \"Condition\": {\n"], [506, "                \"StringEquals\": {\n"], [507, "                    \"aws:PrincipalArn\": \"arn:${data.aws_partition.current.partition}:iam::${data.aws_caller_identity.current.id}:role/tdir-ec2-collection\",\n"], [508, "                    \"kms:EncryptionContext:${data.aws_partition.current.partition}:s3:arn\": \"arn:${data.aws_partition.current.partition}:s3:::tdir-${data.aws_caller_identity.current.id}-${data.aws_region.current.id}\",\n"], [509, "                    \"kms:ViaService\": \"s3.${data.aws_region.current.id}.amazonaws.com\"\n"], [510, "                }\n"], [511, "            }\n"], [512, "        },\n"], [513, "        {\n"], [514, "            \"Sid\": \"s3download\",\n"], [515, "            \"Effect\": \"Allow\",\n"], [516, "            \"Principal\": {\n"], [517, "                \"AWS\": \"arn:${data.aws_partition.current.partition}:iam::${data.aws_caller_identity.current.id}:root\"\n"], [518, "            },\n"], [519, "            \"Action\": \"kms:Decrypt\",\n"], [520, "            \"Resource\": \"*\",\n"], [521, "            \"Condition\": {\n"], [522, "                \"StringEquals\": {\n"], [523, "                    \"aws:PrincipalArn\": \"arn:${data.aws_partition.current.partition}:iam::${data.aws_caller_identity.current.id}:role/admin\",\n"], [524, "                    \"kms:EncryptionContext:${data.aws_partition.current.partition}:s3:arn\": \"arn:${data.aws_partition.current.partition}:s3:::tdir-${data.aws_caller_identity.current.id}-${data.aws_region.current.id}\",\n"], [525, "                    \"kms:ViaService\": \"s3.${data.aws_region.current.id}.amazonaws.com\"\n"], [526, "                }\n"], [527, "            }\n"], [528, "        },\n"], [529, "        {\n"], [530, "            \"Sid\": \"AllowConfigandAccessAnalyzertoReadKeyAttributes\",\n"], [531, "            \"Effect\": \"Allow\",\n"], [532, "            \"Principal\": {\n"], [533, "                \"AWS\": \"arn:${data.aws_partition.current.partition}:iam::${data.aws_caller_identity.current.id}:root\"\n"], [534, "            },\n"], [535, "            \"Action\": [\n"], [536, "                \"kms:List*\",\n"], [537, "                \"kms:GetKeyRotationStatus\",\n"], [538, "                \"kms:GetKeyPolicy\",\n"], [539, "                \"kms:Describe*\"\n"], [540, "            ],\n"], [541, "            \"Resource\": \"*\",\n"], [542, "            \"Condition\": {\n"], [543, "                \"StringEquals\": {\n"], [544, "                    \"aws:PrincipalArn\": [\n"], [545, "                        \"arn:${data.aws_partition.current.partition}:iam::${data.aws_caller_identity.current.id}:role/aws-service-role/access-analyzer.amazonaws.com/AWSServiceRoleForAccessAnalyzer\",\n"], [546, "                        \"arn:${data.aws_partition.current.partition}:iam::${data.aws_caller_identity.current.id}:role/aws-service-role/config.amazonaws.com/AWSServiceRoleForConfig\"\n"], [547, "                    ]\n"], [548, "                }\n"], [549, "            }\n"], [550, "        },\n"], [551, "        {\n"], [552, "            \"Sid\": \"DenyNonOrganizationalServiceEncryptionUse\",\n"], [553, "            \"Effect\": \"Deny\",\n"], [554, "            \"Principal\": {\n"], [555, "                \"AWS\": \"*\"\n"], [556, "            },\n"], [557, "            \"Action\": \"kms:*\",\n"], [558, "            \"Resource\": \"*\",\n"], [559, "            \"Condition\": {\n"], [560, "                \"StringNotEqualsIfExists\": {\n"], [561, "                    \"aws:SourceOrgID\": \"${data.aws_organizations_organization.current.id}\"\n"], [562, "                },\n"], [563, "                \"Null\": {\n"], [564, "                    \"aws:SourceOrgID\": \"false\"\n"], [565, "                },\n"], [566, "                \"BoolIfExists\": {\n"], [567, "                    \"aws:PrincipalIsAWSService\": \"true\"\n"], [568, "                }\n"], [569, "            }\n"], [570, "        },\n"], [571, "        {\n"], [572, "            \"Sid\": \"PreventNonOrganizationalAccess\",\n"], [573, "            \"Effect\": \"Deny\",\n"], [574, "            \"Principal\": {\n"], [575, "                \"AWS\": \"*\"\n"], [576, "            },\n"], [577, "            \"Action\": \"kms:*\",\n"], [578, "            \"Resource\": \"*\",\n"], [579, "            \"Condition\": {\n"], [580, "                \"StringNotEqualsIfExists\": {\n"], [581, "                    \"aws:PrincipalOrgID\": \"${data.aws_organizations_organization.current.id}\"\n"], [582, "                },\n"], [583, "                \"BoolIfExists\": {\n"], [584, "                    \"aws:PrincipalIsAWSService\": \"false\"\n"], [585, "                }\n"], [586, "            }\n"], [587, "        },\n"], [588, "        {\n"], [589, "            \"Sid\": \"MaxDeletionWindow\",\n"], [590, "            \"Effect\": \"Deny\",\n"], [591, "            \"Principal\": {\n"], [592, "                \"AWS\": \"*\"\n"], [593, "            },\n"], [594, "            \"Action\": \"kms:ScheduleKeyDeletion\",\n"], [595, "            \"Resource\": \"*\",\n"], [596, "            \"Condition\": {\n"], [597, "                \"NumericLessThan\": {\n"], [598, "                    \"kms:ScheduleKeyDeletionPendingWindowInDays\": \"30\"\n"], [599, "                }\n"], [600, "            }\n"], [601, "        },\n"], [602, "        {\n"], [603, "            \"Sid\": \"PreventSafetyLockoutBypass\",\n"], [604, "            \"Effect\": \"Deny\",\n"], [605, "            \"Principal\": {\n"], [606, "                \"AWS\": \"*\"\n"], [607, "            },\n"], [608, "            \"Action\": \"kms:PutKeyPolicy\",\n"], [609, "            \"Resource\": \"*\",\n"], [610, "            \"Condition\": {\n"], [611, "                \"Bool\": {\n"], [612, "                    \"kms:BypassPolicyLockoutSafetyCheck\": \"true\"\n"], [613, "                }\n"], [614, "            }\n"], [615, "        }\n"], [616, "    ]\n"], [617, "}\n"], [618, "EOF\n"], [619, "  enable_key_rotation     = true\n"], [620, "}\n"]], "file_path": "/kms.tf", "file_abs_path": "/github/workspace/kms.tf", "repo_file_path": "/kms.tf", "file_line_range": [251, 620], "resource": "aws_kms_key.fail3", "evaluations": null, "check_class": "checkov.common.graph.checks_infra.base_check", "fixed_definition": null, "entity_tags": {}, "caller_file_path": null, "caller_file_line_range": null, "resource_address": null, "severity": null, "bc_category": null, "benchmarks": {}, "description": null, "short_description": null, "vulnerability_details": null, "connected_node": null, "guideline": null, "details": [], "check_len": null, "definition_context_file_path": "/github/workspace/kms.tf"}, {"check_id": "CKV2_AWS_64", "bc_check_id": null, "check_name": "Ensure KMS key Policy is defined", "check_result": {"result": "PASSED", "entity": {"aws_kms_key": {"fail4": {"__end_line__": 633, "__start_line__": 622, "deletion_window_in_days": [30], "description": ["fail4"], "enable_key_rotation": [true], "policy": ["${templatefile(\"${path.module}/templates/kms-fail-4.json\",{'accountid': '${data.aws_caller_identity.current.id}', 'orgid': '${data.aws_caller_identity.current.id}', 'partition': '${data.aws_partition.current.partition}', 'principalarn': '${data.aws_iam_session_context.current.issuer_arn}', 'region': '${data.aws_iam_session_context.current.issuer_arn}'})}"], "__address__": "aws_kms_key.fail4"}}}, "evaluated_keys": ["policy", "resource_type"]}, "code_block": [[622, "resource \"aws_kms_key\" \"fail4\" {\n"], [623, "  description             = \"fail4\"\n"], [624, "  deletion_window_in_days = 30\n"], [625, "  policy = templatefile(\"${path.module}/templates/kms-fail-4.json\", {\n"], [626, "    \"accountid\"    = \"${data.aws_caller_identity.current.id}\",\n"], [627, "    \"orgid\"        = \"${data.aws_caller_identity.current.id}\",\n"], [628, "    \"partition\"    = \"${data.aws_partition.current.partition}\",\n"], [629, "    \"principalarn\" = \"${data.aws_iam_session_context.current.issuer_arn}\",\n"], [630, "    \"region\"       = \"${data.aws_iam_session_context.current.issuer_arn}\"\n"], [631, "  })\n"], [632, "  enable_key_rotation = true\n"], [633, "}\n"]], "file_path": "/kms.tf", "file_abs_path": "/github/workspace/kms.tf", "repo_file_path": "/kms.tf", "file_line_range": [622, 633], "resource": "aws_kms_key.fail4", "evaluations": null, "check_class": "checkov.common.graph.checks_infra.base_check", "fixed_definition": null, "entity_tags": {}, "caller_file_path": null, "caller_file_line_range": null, "resource_address": null, "severity": null, "bc_category": null, "benchmarks": {}, "description": null, "short_description": null, "vulnerability_details": null, "connected_node": null, "guideline": null, "details": [], "check_len": null, "definition_context_file_path": "/github/workspace/kms.tf"}, {"check_id": "CKV2_AWS_64", "bc_check_id": null, "check_name": "Ensure KMS key Policy is defined", "check_result": {"result": "PASSED", "entity": {"aws_kms_key": {"pass2": {"__end_line__": 58, "__start_line__": 56, "description": ["fail5"], "__address__": "aws_kms_key.pass2"}}}, "evaluated_keys": ["policy", "resource_type"]}, "code_block": [[56, "resource \"aws_kms_key\" \"pass2\" {\n"], [57, "  description = \"fail5\"\n"], [58, "}\n"]], "file_path": "/kms.tf", "file_abs_path": "/github/workspace/kms.tf", "repo_file_path": "/kms.tf", "file_line_range": [56, 58], "resource": "aws_kms_key.pass2", "evaluations": null, "check_class": "checkov.common.graph.checks_infra.base_check", "fixed_definition": null, "entity_tags": {}, "caller_file_path": null, "caller_file_line_range": null, "resource_address": null, "severity": null, "bc_category": null, "benchmarks": {}, "description": null, "short_description": null, "vulnerability_details": null, "connected_node": {"code_block": [[60, "resource \"aws_kms_key_policy\" \"pass2\" {\n"], [61, "  key_id = aws_kms_key.pass2.id\n"], [62, "  policy = jsonencode({\n"], [63, "    Version = \"2012-10-17\"\n"], [64, "    Id      = \"pass2\"\n"], [65, "    Statement = [\n"], [66, "      {\n"], [67, "        Sid = \"pass2\"\n"], [68, "        Principal = {\n"], [69, "          AWS = \"*\"\n"], [70, "        }\n"], [71, "        Effect   = \"Allow\"\n"], [72, "        Action   = \"kms:*\"\n"], [73, "        Resource = \"*\"\n"], [74, "        \"Condition\" : {\n"], [75, "          \"StringEquals\" : {\n"], [76, "            \"aws:PrincipalOrgID\" : \"${data.aws_organizations_organization.current.id}\",\n"], [77, "            \"aws:PrincipalArn\" : \"${data.aws_iam_session_context.current.issuer_arn}\"\n"], [78, "          }\n"], [79, "        }\n"], [80, "      },\n"], [81, "    ]\n"], [82, "  })\n"], [83, "}\n"]], "file_path": "/kms.tf", "file_line_range": [60, 83], "resource": "aws_kms_key_policy.pass2", "entity_tags": {}, "evaluations": null, "file_abs_path": "/github/workspace/kms.tf", "resource_address": null}, "guideline": null, "details": [], "check_len": null, "definition_context_file_path": "/github/workspace/kms.tf"}, {"check_id": "CKV2_AWS_64", "bc_check_id": null, "check_name": "Ensure KMS key Policy is defined", "check_result": {"result": "PASSED", "entity": {"aws_kms_key": {"fail5": {"__end_line__": 637, "__start_line__": 635, "description": ["fail5"], "__address__": "aws_kms_key.fail5"}}}, "evaluated_keys": ["policy", "resource_type"]}, "code_block": [[635, "resource \"aws_kms_key\" \"fail5\" {\n"], [636, "  description = \"fail5\"\n"], [637, "}\n"]], "file_path": "/kms.tf", "file_abs_path": "/github/workspace/kms.tf", "repo_file_path": "/kms.tf", "file_line_range": [635, 637], "resource": "aws_kms_key.fail5", "evaluations": null, "check_class": "checkov.common.graph.checks_infra.base_check", "fixed_definition": null, "entity_tags": {}, "caller_file_path": null, "caller_file_line_range": null, "resource_address": null, "severity": null, "bc_category": null, "benchmarks": {}, "description": null, "short_description": null, "vulnerability_details": null, "connected_node": {"code_block": [[639, "resource \"aws_kms_key_policy\" \"fail5\" {\n"], [640, "  key_id = aws_kms_key.fail5.id\n"], [641, "  policy = jsonencode({\n"], [642, "    Id = \"fail5\"\n"], [643, "    Statement = [\n"], [644, "      {\n"], [645, "        Action = \"kms:*\"\n"], [646, "        Effect = \"Allow\"\n"], [647, "        Principal = {\n"], [648, "          AWS = \"*\"\n"], [649, "        }\n"], [650, "        Resource = \"*\"\n"], [651, "        Sid      = \"Enable IAM User Permissions\"\n"], [652, "      },\n"], [653, "    ]\n"], [654, "    Version = \"2012-10-17\"\n"], [655, "  })\n"], [656, "}\n"]], "file_path": "/kms.tf", "file_line_range": [639, 656], "resource": "aws_kms_key_policy.fail5", "entity_tags": {}, "evaluations": null, "file_abs_path": "/github/workspace/kms.tf", "resource_address": null}, "guideline": null, "details": [], "check_len": null, "definition_context_file_path": "/github/workspace/kms.tf"}, {"check_id": "CKV2_AWS_40", "bc_check_id": null, "check_name": "Ensure AWS IAM policy does not allow full IAM privileges", "check_result": {"result": "PASSED", "entity": {"aws_iam_policy_document": {"pass1": {"__end_line__": 42, "__start_line__": 1, "statement": [{"actions": [["kms:CancelKeyDeletion", "kms:CreateAlias", "kms:DeleteAlias", "kms:Describe*", "kms:Disable*", "kms:Enable*", "kms:Get*", "kms:List*", "kms:PutKeyPolicy", "kms:ReplicateKey", "kms:ScheduleKeyDeletion", "kms:SynchronizeMultiRegionKey", "kms:TagResource", "kms:UntagResource", "kms:Update*"]], "condition": [{"test": ["StringEquals"], "values": [["data.aws_organizations_organization.current.id"]], "variable": ["aws:PrincipalOrgID"]}, {"test": ["StringEquals"], "values": [["data.aws_iam_session_context.current.issuer_arn"]], "variable": ["aws:PrincipalArn"]}], "effect": ["Allow"], "principals": [{"identifiers": [["*"]], "type": ["AWS"]}], "resources": [["*"]]}], "__address__": "aws_iam_policy_document.pass1"}}}, "evaluated_keys": ["policy/Statement[?(@/Effect == Allow)]/Action[*]", "inline_policy/Statement[?(@/Effect == Allow)]/Action[*]", "statement[?(@/effect == Allow)]/actions[*]"]}, "code_block": [[1, "data \"aws_iam_policy_document\" \"pass1\" {\n"], [2, "\n"], [3, "  statement {\n"], [4, "    principals {\n"], [5, "      type = \"AWS\"\n"], [6, "      identifiers = [\n"], [7, "        \"*\"\n"], [8, "      ]\n"], [9, "    }\n"], [10, "    effect = \"Allow\"\n"], [11, "    actions = [\n"], [12, "      \"kms:Update*\",\n"], [13, "      \"kms:UntagResource\",\n"], [14, "      \"kms:TagResource\",\n"], [15, "      \"kms:SynchronizeMultiRegionKey\",\n"], [16, "      \"kms:ScheduleKeyDeletion\",\n"], [17, "      \"kms:ReplicateKey\",\n"], [18, "      \"kms:PutKeyPolicy\",\n"], [19, "      \"kms:List*\",\n"], [20, "      \"kms:Get*\",\n"], [21, "      \"kms:Enable*\",\n"], [22, "      \"kms:Disable*\",\n"], [23, "      \"kms:Describe*\",\n"], [24, "      \"kms:DeleteAlias\",\n"], [25, "      \"kms:CreateAlias\",\n"], [26, "      \"kms:CancelKeyDeletion\"\n"], [27, "    ]\n"], [28, "    resources = [\n"], [29, "      \"*\",\n"], [30, "    ]\n"], [31, "    condition {\n"], [32, "      test     = \"StringEquals\"\n"], [33, "      variable = \"aws:PrincipalOrgID\"\n"], [34, "      values   = [\"${data.aws_organizations_organization.current.id}\"]\n"], [35, "    }\n"], [36, "    condition {\n"], [37, "      test     = \"StringEquals\"\n"], [38, "      variable = \"aws:PrincipalArn\"\n"], [39, "      values   = [\"${data.aws_iam_session_context.current.issuer_arn}\"]\n"], [40, "    }\n"], [41, "  }\n"], [42, "}\n"]], "file_path": "/kms.tf", "file_abs_path": "/github/workspace/kms.tf", "repo_file_path": "/kms.tf", "file_line_range": [1, 42], "resource": "aws_iam_policy_document.pass1", "evaluations": null, "check_class": "checkov.common.graph.checks_infra.base_check", "fixed_definition": null, "entity_tags": {}, "caller_file_path": null, "caller_file_line_range": null, "resource_address": null, "severity": null, "bc_category": null, "benchmarks": {}, "description": null, "short_description": null, "vulnerability_details": null, "connected_node": null, "guideline": null, "details": [], "check_len": null, "definition_context_file_path": "/github/workspace/kms.tf"}, {"check_id": "CKV2_AWS_40", "bc_check_id": null, "check_name": "Ensure AWS IAM policy does not allow full IAM privileges", "check_result": {"result": "PASSED", "entity": {"aws_iam_policy_document": {"fail1": {"__end_line__": 153, "__start_line__": 135, "statement": [{"actions": [["kms:*"]], "effect": ["Allow"], "principals": [{"identifiers": [["*"]], "type": ["AWS"]}], "resources": [["*"]]}], "__address__": "aws_iam_policy_document.fail1"}}}, "evaluated_keys": ["policy/Statement[?(@/Effect == Allow)]/Action[*]", "inline_policy/Statement[?(@/Effect == Allow)]/Action[*]", "statement[?(@/effect == Allow)]/actions[*]"]}, "code_block": [[135, "data \"aws_iam_policy_document\" \"fail1\" {\n"], [136, "\n"], [137, "  statement {\n"], [138, "    principals {\n"], [139, "      type = \"AWS\"\n"], [140, "      identifiers = [\n"], [141, "        \"*\"\n"], [142, "      ]\n"], [143, "    }\n"], [144, "    effect = \"Allow\"\n"], [145, "    actions = [\n"], [146, "      \"kms:*\"\n"], [147, "    ]\n"], [148, "    resources = [\n"], [149, "      \"*\",\n"], [150, "    ]\n"], [151, "  }\n"], [152, "\n"], [153, "}\n"]], "file_path": "/kms.tf", "file_abs_path": "/github/workspace/kms.tf", "repo_file_path": "/kms.tf", "file_line_range": [135, 153], "resource": "aws_iam_policy_document.fail1", "evaluations": null, "check_class": "checkov.common.graph.checks_infra.base_check", "fixed_definition": null, "entity_tags": {}, "caller_file_path": null, "caller_file_line_range": null, "resource_address": null, "severity": null, "bc_category": null, "benchmarks": {}, "description": null, "short_description": null, "vulnerability_details": null, "connected_node": null, "guideline": null, "details": [], "check_len": null, "definition_context_file_path": "/github/workspace/kms.tf"}], "failed_checks": [{"check_id": "CKV_AWS_7", "bc_check_id": null, "check_name": "Ensure rotation for customer created CMKs is enabled", "check_result": {"result": "FAILED", "evaluated_keys": ["enable_key_rotation"]}, "code_block": [[56, "resource \"aws_kms_key\" \"pass2\" {\n"], [57, "  description = \"fail5\"\n"], [58, "}\n"]], "file_path": "/kms.tf", "file_abs_path": "/github/workspace/kms.tf", "repo_file_path": "/kms.tf", "file_line_range": [56, 58], "resource": "aws_kms_key.pass2", "evaluations": null, "check_class": "checkov.terraform.checks.resource.aws.KMSRotation", "fixed_definition": null, "entity_tags": null, "caller_file_path": null, "caller_file_line_range": null, "resource_address": null, "severity": null, "bc_category": null, "benchmarks": {}, "description": null, "short_description": null, "vulnerability_details": null, "connected_node": null, "guideline": null, "details": [], "check_len": null, "definition_context_file_path": "/github/workspace/kms.tf"}, {"check_id": "CKV_AWS_227", "bc_check_id": null, "check_name": "Ensure KMS key is enabled", "check_result": {"result": "FAILED", "evaluated_keys": ["is_enabled"]}, "code_block": [[85, "resource \"aws_kms_key\" \"pass3\" {\n"], [86, "  description                        = \"pass3\"\n"], [87, "  deletion_window_in_days            = 7\n"], [88, "  key_usage                          = \"ENCRYPT_DECRYPT\"\n"], [89, "  customer_master_key_spec           = \"SYMMETRIC_DEFAULT\"\n"], [90, "  policy                             = <<POLICY\n"], [91, "{\n"], [92, "    \"Version\": \"2012-10-17\",\n"], [93, "    \"Statement\": [\n"], [94, "        {\n"], [95, "            \"Sid\": \"pass3\",\n"], [96, "            \"Effect\": \"Allow\",\n"], [97, "            \"Principal\": {\n"], [98, "                \"AWS\": \"*\"\n"], [99, "            },\n"], [100, "            \"Action\": [\n"], [101, "              \"kms:Update*\",\n"], [102, "              \"kms:UntagResource\",\n"], [103, "              \"kms:TagResource\",\n"], [104, "              \"kms:SynchronizeMultiRegionKey\",\n"], [105, "              \"kms:ScheduleKeyDeletion\",\n"], [106, "              \"kms:ReplicateKey\",\n"], [107, "              \"kms:PutKeyPolicy\",\n"], [108, "              \"kms:List*\",\n"], [109, "              \"kms:Get*\",\n"], [110, "              \"kms:Enable*\",\n"], [111, "              \"kms:Disable*\",\n"], [112, "              \"kms:Describe*\",\n"], [113, "              \"kms:DeleteAlias\",\n"], [114, "              \"kms:CreateAlias\",\n"], [115, "              \"kms:CancelKeyDeletion\"\n"], [116, "            ],\n"], [117, "            \"Resource\": \"*\",\n"], [118, "            \"Condition\": {\n"], [119, "                \"StringEquals\": {\n"], [120, "                    \"aws:PrincipalArn\": [\n"], [121, "                        \"${data.aws_iam_session_context.current.issuer_arn}\"\n"], [122, "                    ]\n"], [123, "                }\n"], [124, "            }\n"], [125, "        }\n"], [126, "    ]\n"], [127, "}\n"], [128, "POLICY\n"], [129, "  bypass_policy_lockout_safety_check = false\n"], [130, "  is_enabled                         = false\n"], [131, "  enable_key_rotation                = true\n"], [132, "\n"], [133, "}\n"]], "file_path": "/kms.tf", "file_abs_path": "/github/workspace/kms.tf", "repo_file_path": "/kms.tf", "file_line_range": [85, 133], "resource": "aws_kms_key.pass3", "evaluations": null, "check_class": "checkov.terraform.checks.resource.aws.KMSKeyIsEnabled", "fixed_definition": null, "entity_tags": null, "caller_file_path": null, "caller_file_line_range": null, "resource_address": null, "severity": null, "bc_category": null, "benchmarks": {}, "description": null, "short_description": null, "vulnerability_details": null, "connected_node": null, "guideline": null, "details": [], "check_len": null, "definition_context_file_path": "/github/workspace/kms.tf"}, {"check_id": "CKV_AWS_33", "bc_check_id": null, "check_name": "Ensure KMS key policy does not contain wildcard (*) principal", "check_result": {"result": "FAILED", "evaluated_keys": ["policy/[0]/Statement/[0]/Principal/AWS"]}, "code_block": [[85, "resource \"aws_kms_key\" \"pass3\" {\n"], [86, "  description                        = \"pass3\"\n"], [87, "  deletion_window_in_days            = 7\n"], [88, "  key_usage                          = \"ENCRYPT_DECRYPT\"\n"], [89, "  customer_master_key_spec           = \"SYMMETRIC_DEFAULT\"\n"], [90, "  policy                             = <<POLICY\n"], [91, "{\n"], [92, "    \"Version\": \"2012-10-17\",\n"], [93, "    \"Statement\": [\n"], [94, "        {\n"], [95, "            \"Sid\": \"pass3\",\n"], [96, "            \"Effect\": \"Allow\",\n"], [97, "            \"Principal\": {\n"], [98, "                \"AWS\": \"*\"\n"], [99, "            },\n"], [100, "            \"Action\": [\n"], [101, "              \"kms:Update*\",\n"], [102, "              \"kms:UntagResource\",\n"], [103, "              \"kms:TagResource\",\n"], [104, "              \"kms:SynchronizeMultiRegionKey\",\n"], [105, "              \"kms:ScheduleKeyDeletion\",\n"], [106, "              \"kms:ReplicateKey\",\n"], [107, "              \"kms:PutKeyPolicy\",\n"], [108, "              \"kms:List*\",\n"], [109, "              \"kms:Get*\",\n"], [110, "              \"kms:Enable*\",\n"], [111, "              \"kms:Disable*\",\n"], [112, "              \"kms:Describe*\",\n"], [113, "              \"kms:DeleteAlias\",\n"], [114, "              \"kms:CreateAlias\",\n"], [115, "              \"kms:CancelKeyDeletion\"\n"], [116, "            ],\n"], [117, "            \"Resource\": \"*\",\n"], [118, "            \"Condition\": {\n"], [119, "                \"StringEquals\": {\n"], [120, "                    \"aws:PrincipalArn\": [\n"], [121, "                        \"${data.aws_iam_session_context.current.issuer_arn}\"\n"], [122, "                    ]\n"], [123, "                }\n"], [124, "            }\n"], [125, "        }\n"], [126, "    ]\n"], [127, "}\n"], [128, "POLICY\n"], [129, "  bypass_policy_lockout_safety_check = false\n"], [130, "  is_enabled                         = false\n"], [131, "  enable_key_rotation                = true\n"], [132, "\n"], [133, "}\n"]], "file_path": "/kms.tf", "file_abs_path": "/github/workspace/kms.tf", "repo_file_path": "/kms.tf", "file_line_range": [85, 133], "resource": "aws_kms_key.pass3", "evaluations": null, "check_class": "checkov.terraform.checks.resource.aws.KMSKeyWildcardPrincipal", "fixed_definition": null, "entity_tags": null, "caller_file_path": null, "caller_file_line_range": null, "resource_address": null, "severity": null, "bc_category": null, "benchmarks": {}, "description": null, "short_description": null, "vulnerability_details": null, "connected_node": null, "guideline": null, "details": [], "check_len": null, "definition_context_file_path": "/github/workspace/kms.tf"}, {"check_id": "CKV_AWS_7", "bc_check_id": null, "check_name": "Ensure rotation for customer created CMKs is enabled", "check_result": {"result": "FAILED", "evaluated_keys": ["enable_key_rotation"]}, "code_block": [[166, "resource \"aws_kms_key\" \"fail2\" {\n"], [167, "  description                        = \"fail2\"\n"], [168, "  deletion_window_in_days            = 7\n"], [169, "  key_usage                          = \"ENCRYPT_DECRYPT\"\n"], [170, "  customer_master_key_spec           = \"SYMMETRIC_DEFAULT\"\n"], [171, "  policy                             = <<POLICY\n"], [172, "{\n"], [173, "    \"Version\": \"2012-10-17\",\n"], [174, "    \"Statement\": [\n"], [175, "        {\n"], [176, "            \"Sid\": \"ABasicBadPolicyExampleTest\",\n"], [177, "            \"Effect\": \"Allow\",\n"], [178, "            \"Principal\": {\n"], [179, "                \"AWS\": \"*\"\n"], [180, "            },\n"], [181, "            \"Action\": [\n"], [182, "                \"kms:Update*\",\n"], [183, "                \"kms:UntagResource\",\n"], [184, "                \"kms:TagResource\",\n"], [185, "                \"kms:SynchronizeMultiRegionKey\",\n"], [186, "                \"kms:ScheduleKeyDeletion\",\n"], [187, "                \"kms:ReplicateKey\",\n"], [188, "                \"kms:PutKeyPolicy\",\n"], [189, "                \"kms:List*\",\n"], [190, "                \"kms:Get*\",\n"], [191, "                \"kms:Enable*\",\n"], [192, "                \"kms:Disable*\",\n"], [193, "                \"kms:Describe*\",\n"], [194, "                \"kms:DeleteAlias\",\n"], [195, "                \"kms:CreateAlias\",\n"], [196, "                \"kms:CancelKeyDeletion\"\n"], [197, "            ],\n"], [198, "            \"Resource\": \"*\"\n"], [199, "        },\n"], [200, "        {\n"], [201, "            \"Sid\": \"AllowMacietoDecryptheKey\",\n"], [202, "            \"Effect\": \"Allow\",\n"], [203, "            \"Principal\": {\n"], [204, "                \"AWS\": \"arn:aws:iam::398930073421:root\"\n"], [205, "            },\n"], [206, "            \"Action\": [\n"], [207, "                \"kms:List*\",\n"], [208, "                \"kms:GetKeyRotationStatus\",\n"], [209, "                \"kms:GetKeyPolicy\",\n"], [210, "                \"kms:Describe*\",\n"], [211, "                \"kms:Decrypt\"\n"], [212, "            ],\n"], [213, "            \"Resource\": \"*\",\n"], [214, "            \"Condition\": {\n"], [215, "                \"StringEquals\": {\n"], [216, "                    \"aws:PrincipalArn\": \"arn:aws:iam::398930073421:role/aws-service-role/macie.amazonaws.com/AWSServiceRoleForAmazonMacie\"\n"], [217, "                }\n"], [218, "            }\n"], [219, "        },\n"], [220, "        {\n"], [221, "            \"Sid\": \"AllowConfigandAccessAnalyzertoReadKeyAttributes\",\n"], [222, "            \"Effect\": \"Allow\",\n"], [223, "            \"Principal\": {\n"], [224, "                \"AWS\": \"arn:aws:iam::398930073421:root\"\n"], [225, "            },\n"], [226, "            \"Action\": [\n"], [227, "                \"kms:List*\",\n"], [228, "                \"kms:GetKeyRotationStatus\",\n"], [229, "                \"kms:GetKeyPolicy\",\n"], [230, "                \"kms:Describe*\"\n"], [231, "            ],\n"], [232, "            \"Resource\": \"*\",\n"], [233, "            \"Condition\": {\n"], [234, "                \"StringEquals\": {\n"], [235, "                    \"aws:PrincipalArn\": [\n"], [236, "                        \"arn:aws:iam::398930073421:role/aws-service-role/access-analyzer.amazonaws.com/AWSServiceRoleForAccessAnalyzer\",\n"], [237, "                        \"arn:aws:iam::398930073421:role/aws-service-role/config.amazonaws.com/AWSServiceRoleForConfig\"\n"], [238, "                    ]\n"], [239, "                }\n"], [240, "            }\n"], [241, "        }\n"], [242, "    ]\n"], [243, "}\n"], [244, "POLICY\n"], [245, "  bypass_policy_lockout_safety_check = false\n"], [246, "  is_enabled                         = false\n"], [247, "  enable_key_rotation                = false\n"], [248, "\n"], [249, "}\n"]], "file_path": "/kms.tf", "file_abs_path": "/github/workspace/kms.tf", "repo_file_path": "/kms.tf", "file_line_range": [166, 249], "resource": "aws_kms_key.fail2", "evaluations": null, "check_class": "checkov.terraform.checks.resource.aws.KMSRotation", "fixed_definition": null, "entity_tags": null, "caller_file_path": null, "caller_file_line_range": null, "resource_address": null, "severity": null, "bc_category": null, "benchmarks": {}, "description": null, "short_description": null, "vulnerability_details": null, "connected_node": null, "guideline": null, "details": [], "check_len": null, "definition_context_file_path": "/github/workspace/kms.tf"}, {"check_id": "CKV_AWS_227", "bc_check_id": null, "check_name": "Ensure KMS key is enabled", "check_result": {"result": "FAILED", "evaluated_keys": ["is_enabled"]}, "code_block": [[166, "resource \"aws_kms_key\" \"fail2\" {\n"], [167, "  description                        = \"fail2\"\n"], [168, "  deletion_window_in_days            = 7\n"], [169, "  key_usage                          = \"ENCRYPT_DECRYPT\"\n"], [170, "  customer_master_key_spec           = \"SYMMETRIC_DEFAULT\"\n"], [171, "  policy                             = <<POLICY\n"], [172, "{\n"], [173, "    \"Version\": \"2012-10-17\",\n"], [174, "    \"Statement\": [\n"], [175, "        {\n"], [176, "            \"Sid\": \"ABasicBadPolicyExampleTest\",\n"], [177, "            \"Effect\": \"Allow\",\n"], [178, "            \"Principal\": {\n"], [179, "                \"AWS\": \"*\"\n"], [180, "            },\n"], [181, "            \"Action\": [\n"], [182, "                \"kms:Update*\",\n"], [183, "                \"kms:UntagResource\",\n"], [184, "                \"kms:TagResource\",\n"], [185, "                \"kms:SynchronizeMultiRegionKey\",\n"], [186, "                \"kms:ScheduleKeyDeletion\",\n"], [187, "                \"kms:ReplicateKey\",\n"], [188, "                \"kms:PutKeyPolicy\",\n"], [189, "                \"kms:List*\",\n"], [190, "                \"kms:Get*\",\n"], [191, "                \"kms:Enable*\",\n"], [192, "                \"kms:Disable*\",\n"], [193, "                \"kms:Describe*\",\n"], [194, "                \"kms:DeleteAlias\",\n"], [195, "                \"kms:CreateAlias\",\n"], [196, "                \"kms:CancelKeyDeletion\"\n"], [197, "            ],\n"], [198, "            \"Resource\": \"*\"\n"], [199, "        },\n"], [200, "        {\n"], [201, "            \"Sid\": \"AllowMacietoDecryptheKey\",\n"], [202, "            \"Effect\": \"Allow\",\n"], [203, "            \"Principal\": {\n"], [204, "                \"AWS\": \"arn:aws:iam::398930073421:root\"\n"], [205, "            },\n"], [206, "            \"Action\": [\n"], [207, "                \"kms:List*\",\n"], [208, "                \"kms:GetKeyRotationStatus\",\n"], [209, "                \"kms:GetKeyPolicy\",\n"], [210, "                \"kms:Describe*\",\n"], [211, "                \"kms:Decrypt\"\n"], [212, "            ],\n"], [213, "            \"Resource\": \"*\",\n"], [214, "            \"Condition\": {\n"], [215, "                \"StringEquals\": {\n"], [216, "                    \"aws:PrincipalArn\": \"arn:aws:iam::398930073421:role/aws-service-role/macie.amazonaws.com/AWSServiceRoleForAmazonMacie\"\n"], [217, "                }\n"], [218, "            }\n"], [219, "        },\n"], [220, "        {\n"], [221, "            \"Sid\": \"AllowConfigandAccessAnalyzertoReadKeyAttributes\",\n"], [222, "            \"Effect\": \"Allow\",\n"], [223, "            \"Principal\": {\n"], [224, "                \"AWS\": \"arn:aws:iam::398930073421:root\"\n"], [225, "            },\n"], [226, "            \"Action\": [\n"], [227, "                \"kms:List*\",\n"], [228, "                \"kms:GetKeyRotationStatus\",\n"], [229, "                \"kms:GetKeyPolicy\",\n"], [230, "                \"kms:Describe*\"\n"], [231, "            ],\n"], [232, "            \"Resource\": \"*\",\n"], [233, "            \"Condition\": {\n"], [234, "                \"StringEquals\": {\n"], [235, "                    \"aws:PrincipalArn\": [\n"], [236, "                        \"arn:aws:iam::398930073421:role/aws-service-role/access-analyzer.amazonaws.com/AWSServiceRoleForAccessAnalyzer\",\n"], [237, "                        \"arn:aws:iam::398930073421:role/aws-service-role/config.amazonaws.com/AWSServiceRoleForConfig\"\n"], [238, "                    ]\n"], [239, "                }\n"], [240, "            }\n"], [241, "        }\n"], [242, "    ]\n"], [243, "}\n"], [244, "POLICY\n"], [245, "  bypass_policy_lockout_safety_check = false\n"], [246, "  is_enabled                         = false\n"], [247, "  enable_key_rotation                = false\n"], [248, "\n"], [249, "}\n"]], "file_path": "/kms.tf", "file_abs_path": "/github/workspace/kms.tf", "repo_file_path": "/kms.tf", "file_line_range": [166, 249], "resource": "aws_kms_key.fail2", "evaluations": null, "check_class": "checkov.terraform.checks.resource.aws.KMSKeyIsEnabled", "fixed_definition": null, "entity_tags": null, "caller_file_path": null, "caller_file_line_range": null, "resource_address": null, "severity": null, "bc_category": null, "benchmarks": {}, "description": null, "short_description": null, "vulnerability_details": null, "connected_node": null, "guideline": null, "details": [], "check_len": null, "definition_context_file_path": "/github/workspace/kms.tf"}, {"check_id": "CKV_AWS_33", "bc_check_id": null, "check_name": "Ensure KMS key policy does not contain wildcard (*) principal", "check_result": {"result": "FAILED", "evaluated_keys": ["policy/[0]/Statement/[0]/Principal/AWS"]}, "code_block": [[166, "resource \"aws_kms_key\" \"fail2\" {\n"], [167, "  description                        = \"fail2\"\n"], [168, "  deletion_window_in_days            = 7\n"], [169, "  key_usage                          = \"ENCRYPT_DECRYPT\"\n"], [170, "  customer_master_key_spec           = \"SYMMETRIC_DEFAULT\"\n"], [171, "  policy                             = <<POLICY\n"], [172, "{\n"], [173, "    \"Version\": \"2012-10-17\",\n"], [174, "    \"Statement\": [\n"], [175, "        {\n"], [176, "            \"Sid\": \"ABasicBadPolicyExampleTest\",\n"], [177, "            \"Effect\": \"Allow\",\n"], [178, "            \"Principal\": {\n"], [179, "                \"AWS\": \"*\"\n"], [180, "            },\n"], [181, "            \"Action\": [\n"], [182, "                \"kms:Update*\",\n"], [183, "                \"kms:UntagResource\",\n"], [184, "                \"kms:TagResource\",\n"], [185, "                \"kms:SynchronizeMultiRegionKey\",\n"], [186, "                \"kms:ScheduleKeyDeletion\",\n"], [187, "                \"kms:ReplicateKey\",\n"], [188, "                \"kms:PutKeyPolicy\",\n"], [189, "                \"kms:List*\",\n"], [190, "                \"kms:Get*\",\n"], [191, "                \"kms:Enable*\",\n"], [192, "                \"kms:Disable*\",\n"], [193, "                \"kms:Describe*\",\n"], [194, "                \"kms:DeleteAlias\",\n"], [195, "                \"kms:CreateAlias\",\n"], [196, "                \"kms:CancelKeyDeletion\"\n"], [197, "            ],\n"], [198, "            \"Resource\": \"*\"\n"], [199, "        },\n"], [200, "        {\n"], [201, "            \"Sid\": \"AllowMacietoDecryptheKey\",\n"], [202, "            \"Effect\": \"Allow\",\n"], [203, "            \"Principal\": {\n"], [204, "                \"AWS\": \"arn:aws:iam::398930073421:root\"\n"], [205, "            },\n"], [206, "            \"Action\": [\n"], [207, "                \"kms:List*\",\n"], [208, "                \"kms:GetKeyRotationStatus\",\n"], [209, "                \"kms:GetKeyPolicy\",\n"], [210, "                \"kms:Describe*\",\n"], [211, "                \"kms:Decrypt\"\n"], [212, "            ],\n"], [213, "            \"Resource\": \"*\",\n"], [214, "            \"Condition\": {\n"], [215, "                \"StringEquals\": {\n"], [216, "                    \"aws:PrincipalArn\": \"arn:aws:iam::398930073421:role/aws-service-role/macie.amazonaws.com/AWSServiceRoleForAmazonMacie\"\n"], [217, "                }\n"], [218, "            }\n"], [219, "        },\n"], [220, "        {\n"], [221, "            \"Sid\": \"AllowConfigandAccessAnalyzertoReadKeyAttributes\",\n"], [222, "            \"Effect\": \"Allow\",\n"], [223, "            \"Principal\": {\n"], [224, "                \"AWS\": \"arn:aws:iam::398930073421:root\"\n"], [225, "            },\n"], [226, "            \"Action\": [\n"], [227, "                \"kms:List*\",\n"], [228, "                \"kms:GetKeyRotationStatus\",\n"], [229, "                \"kms:GetKeyPolicy\",\n"], [230, "                \"kms:Describe*\"\n"], [231, "            ],\n"], [232, "            \"Resource\": \"*\",\n"], [233, "            \"Condition\": {\n"], [234, "                \"StringEquals\": {\n"], [235, "                    \"aws:PrincipalArn\": [\n"], [236, "                        \"arn:aws:iam::398930073421:role/aws-service-role/access-analyzer.amazonaws.com/AWSServiceRoleForAccessAnalyzer\",\n"], [237, "                        \"arn:aws:iam::398930073421:role/aws-service-role/config.amazonaws.com/AWSServiceRoleForConfig\"\n"], [238, "                    ]\n"], [239, "                }\n"], [240, "            }\n"], [241, "        }\n"], [242, "    ]\n"], [243, "}\n"], [244, "POLICY\n"], [245, "  bypass_policy_lockout_safety_check = false\n"], [246, "  is_enabled                         = false\n"], [247, "  enable_key_rotation                = false\n"], [248, "\n"], [249, "}\n"]], "file_path": "/kms.tf", "file_abs_path": "/github/workspace/kms.tf", "repo_file_path": "/kms.tf", "file_line_range": [166, 249], "resource": "aws_kms_key.fail2", "evaluations": null, "check_class": "checkov.terraform.checks.resource.aws.KMSKeyWildcardPrincipal", "fixed_definition": null, "entity_tags": null, "caller_file_path": null, "caller_file_line_range": null, "resource_address": null, "severity": null, "bc_category": null, "benchmarks": {}, "description": null, "short_description": null, "vulnerability_details": null, "connected_node": null, "guideline": null, "details": [], "check_len": null, "definition_context_file_path": "/github/workspace/kms.tf"}, {"check_id": "CKV_AWS_7", "bc_check_id": null, "check_name": "Ensure rotation for customer created CMKs is enabled", "check_result": {"result": "FAILED", "evaluated_keys": ["enable_key_rotation"]}, "code_block": [[635, "resource \"aws_kms_key\" \"fail5\" {\n"], [636, "  description = \"fail5\"\n"], [637, "}\n"]], "file_path": "/kms.tf", "file_abs_path": "/github/workspace/kms.tf", "repo_file_path": "/kms.tf", "file_line_range": [635, 637], "resource": "aws_kms_key.fail5", "evaluations": null, "check_class": "checkov.terraform.checks.resource.aws.KMSRotation", "fixed_definition": null, "entity_tags": null, "caller_file_path": null, "caller_file_line_range": null, "resource_address": null, "severity": null, "bc_category": null, "benchmarks": {}, "description": null, "short_description": null, "vulnerability_details": null, "connected_node": null, "guideline": null, "details": [], "check_len": null, "definition_context_file_path": "/github/workspace/kms.tf"}, {"check_id": "CKV_AWS_109", "bc_check_id": null, "check_name": "Ensure IAM policies does not allow permissions management / resource exposure without constraints", "check_result": {"result": "FAILED", "evaluated_keys": []}, "code_block": [[135, "data \"aws_iam_policy_document\" \"fail1\" {\n"], [136, "\n"], [137, "  statement {\n"], [138, "    principals {\n"], [139, "      type = \"AWS\"\n"], [140, "      identifiers = [\n"], [141, "        \"*\"\n"], [142, "      ]\n"], [143, "    }\n"], [144, "    effect = \"Allow\"\n"], [145, "    actions = [\n"], [146, "      \"kms:*\"\n"], [147, "    ]\n"], [148, "    resources = [\n"], [149, "      \"*\",\n"], [150, "    ]\n"], [151, "  }\n"], [152, "\n"], [153, "}\n"]], "file_path": "/kms.tf", "file_abs_path": "/github/workspace/kms.tf", "repo_file_path": "/kms.tf", "file_line_range": [135, 153], "resource": "aws_iam_policy_document.fail1", "evaluations": null, "check_class": "checkov.terraform.checks.data.aws.IAMPermissionsManagement", "fixed_definition": null, "entity_tags": null, "caller_file_path": null, "caller_file_line_range": null, "resource_address": null, "severity": null, "bc_category": null, "benchmarks": {}, "description": null, "short_description": null, "vulnerability_details": null, "connected_node": null, "guideline": null, "details": [], "check_len": null, "definition_context_file_path": "/github/workspace/kms.tf"}, {"check_id": "CKV_AWS_283", "bc_check_id": null, "check_name": "Ensure no IAM policies documents allow ALL or any AWS principal permissions to the resource", "check_result": {"result": "FAILED", "evaluated_keys": []}, "code_block": [[135, "data \"aws_iam_policy_document\" \"fail1\" {\n"], [136, "\n"], [137, "  statement {\n"], [138, "    principals {\n"], [139, "      type = \"AWS\"\n"], [140, "      identifiers = [\n"], [141, "        \"*\"\n"], [142, "      ]\n"], [143, "    }\n"], [144, "    effect = \"Allow\"\n"], [145, "    actions = [\n"], [146, "      \"kms:*\"\n"], [147, "    ]\n"], [148, "    resources = [\n"], [149, "      \"*\",\n"], [150, "    ]\n"], [151, "  }\n"], [152, "\n"], [153, "}\n"]], "file_path": "/kms.tf", "file_abs_path": "/github/workspace/kms.tf", "repo_file_path": "/kms.tf", "file_line_range": [135, 153], "resource": "aws_iam_policy_document.fail1", "evaluations": null, "check_class": "checkov.terraform.checks.data.aws.IAMPublicActionsPolicy", "fixed_definition": null, "entity_tags": null, "caller_file_path": null, "caller_file_line_range": null, "resource_address": null, "severity": null, "bc_category": null, "benchmarks": {}, "description": null, "short_description": null, "vulnerability_details": null, "connected_node": null, "guideline": null, "details": [], "check_len": null, "definition_context_file_path": "/github/workspace/kms.tf"}, {"check_id": "CKV_AWS_356", "bc_check_id": null, "check_name": "Ensure no IAM policies documents allow \"*\" as a statement's resource for restrictable actions", "check_result": {"result": "FAILED", "evaluated_keys": []}, "code_block": [[135, "data \"aws_iam_policy_document\" \"fail1\" {\n"], [136, "\n"], [137, "  statement {\n"], [138, "    principals {\n"], [139, "      type = \"AWS\"\n"], [140, "      identifiers = [\n"], [141, "        \"*\"\n"], [142, "      ]\n"], [143, "    }\n"], [144, "    effect = \"Allow\"\n"], [145, "    actions = [\n"], [146, "      \"kms:*\"\n"], [147, "    ]\n"], [148, "    resources = [\n"], [149, "      \"*\",\n"], [150, "    ]\n"], [151, "  }\n"], [152, "\n"], [153, "}\n"]], "file_path": "/kms.tf", "file_abs_path": "/github/workspace/kms.tf", "repo_file_path": "/kms.tf", "file_line_range": [135, 153], "resource": "aws_iam_policy_document.fail1", "evaluations": null, "check_class": "checkov.terraform.checks.data.aws.ResourcePolicyDocument", "fixed_definition": null, "entity_tags": null, "caller_file_path": null, "caller_file_line_range": null, "resource_address": null, "severity": null, "bc_category": null, "benchmarks": {}, "description": null, "short_description": null, "vulnerability_details": null, "connected_node": null, "guideline": null, "details": [], "check_len": null, "definition_context_file_path": "/github/workspace/kms.tf"}, {"check_id": "CKV_AWS_111", "bc_check_id": null, "check_name": "Ensure IAM policies does not allow write access without constraints", "check_result": {"result": "FAILED", "evaluated_keys": []}, "code_block": [[135, "data \"aws_iam_policy_document\" \"fail1\" {\n"], [136, "\n"], [137, "  statement {\n"], [138, "    principals {\n"], [139, "      type = \"AWS\"\n"], [140, "      identifiers = [\n"], [141, "        \"*\"\n"], [142, "      ]\n"], [143, "    }\n"], [144, "    effect = \"Allow\"\n"], [145, "    actions = [\n"], [146, "      \"kms:*\"\n"], [147, "    ]\n"], [148, "    resources = [\n"], [149, "      \"*\",\n"], [150, "    ]\n"], [151, "  }\n"], [152, "\n"], [153, "}\n"]], "file_path": "/kms.tf", "file_abs_path": "/github/workspace/kms.tf", "repo_file_path": "/kms.tf", "file_line_range": [135, 153], "resource": "aws_iam_policy_document.fail1", "evaluations": null, "check_class": "checkov.terraform.checks.data.aws.IAMWriteAccess", "fixed_definition": null, "entity_tags": null, "caller_file_path": null, "caller_file_line_range": null, "resource_address": null, "severity": null, "bc_category": null, "benchmarks": {}, "description": null, "short_description": null, "vulnerability_details": null, "connected_node": null, "guideline": null, "details": [], "check_len": null, "definition_context_file_path": "/github/workspace/kms.tf"}], "skipped_checks": [], "parsing_errors": []}, "summary": {"passed": 44, "failed": 11, "skipped": 0, "parsing_errors": 0, "resource_count": 10, "checkov_version": "3.2.31"}, "url": "Add an api key '--bc-api-key <api-key>' to see more detailed insights via https://bridgecrew.cloud"}